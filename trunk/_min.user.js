// ==UserScript==
// @name           Castle Age Autoplayer
// @namespace      caap
// @description    Auto player for Castle Age
// @version        !version!
// @dev            !dev!
// @require        http://castle-age-auto-player.googlecode.com/files/jquery-latest.min.js
// @require        http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js
// @require        http://castle-age-auto-player.googlecode.com/files/farbtastic.min.js
// @require        http://castle-age-auto-player.googlecode.com/files/json2.js
// @include        http*://apps.*facebook.com/castle_age/*
// @include        http*://*.facebook.com/common/error.html
// @include        http*://apps.facebook.com/reqs.php#confirm_46755028429_0
// @include        http*://apps.facebook.com/*filter=app_46755028429*
// @license        GPL version 3 or any later version; http://www.gnu.org/copyleft/gpl.html
// @compatability  Firefox 3.0+, Google Chrome 4+, Chromium 4+, Flock 2.0+
// ==/UserScript==
var caapVersion="140.23.51",devVersion="38",hiddenVar=true,image64={},utility={},config={},state={},css={},gm={},nHtml={},sort={},schedule={},general={},monster={},battle={},town={},gifting={},caap={};String.prototype.ucFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)};String.prototype.stripHTML=function(){return this.replace(RegExp("<[^>]+>","g"),"").replace(/&nbsp;/g,"")};
String.prototype.regex=function(b){b=this.match(b);var a;if(b){b.shift();for(a=0;a<b.length;a+=1)if(b[a]&&b[a].search(/^[\-+]?[0-9]*\.?[0-9]*$/)>=0)b[a]=parseFloat(b[a]);if(b.length===1)return b[0]}return b};
image64={header:"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",marker:"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAK3RFWHRDcmVhdGlvbiBUaW1lAHZyIDE0IGp1bCAyMDA2IDEzOjMxOjIzICswMTAwHvJDZwAAAAd0SU1FB9YHDgsgJYiZ4bUAAAAJcEhZcwAALiIAAC4iAari3ZIAAAAEZ0FNQQAAsY8L/GEFAAAB5ElEQVR42q2Tz0sqURTH72Qq4mASSAoSIfSDdCEI8qJFLXSjLYSQNoGLINrI8/0ZD9q0KnDlKkIMebmP9xZRCEEiLQLBiMiNJDYq/Zg573vpCkM6CdGBD3Pn3OvXe77nDGPfENKwJBHx/CxYAtNAAVfgXJKk7khVCCyCP6ALVKAJXkEdbINxw5tgM4HHPphSFEUql8usXq8zWZZZKBRiPp+PH3sBx2Br4FbiBg+aplGxWKRgMPiMH1+YTKZDq9V64na7G+l0mprNJo7RG/g94IEoQSsUCuRyue6QToIJYAJWMA/Bo2QySZ1Ohws9gZBeZI570Gq1yO/395BKGJg+ZbFYznK5HAmf9vQiKW5iqVQim832Fyn5E+83Y7EYieAdY2Nig7dRqtVqrNfr3YiWGsVltVrtr2f0IrwEZrfbGeqWhQ9GMeFwOPprRS9SAWo4HGZOp/MH1l4DAS6+HolE+u9Xek9kcK+qKqVSKUL/s0hPDhFY83g8j5VKhcQg7nxs80/w0mg0KB6Pa2az+RTpDbDA3sd/lwvk8/l+Z7iS/FHEAor8H9rtNmWzWYpGo+T1eikQCFAmkyFxAy7AJ255aMHYcIID8d1oNBi8hGuwwkYFDq0CPlG3YsTb4B/4BRwjBb4S/wGzT16tu5THiAAAAABJRU5ErkJggg==",
mask:"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",
wheel:"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"};
utility={is_chrome:navigator.userAgent.toLowerCase().indexOf("chrome")!==-1?true:false,is_firefox:navigator.userAgent.toLowerCase().indexOf("firefox")!==-1?true:false,is_html5_storage:"localStorage"in window&&window.localStorage!==null,waitMilliSecs:5E3,VisitUrl:function(b,a){try{this.waitMilliSecs=a?a:5E3;window.location.href=b;return true}catch(c){this.error("ERROR in utility.VisitUrl: "+c);return false}},Click:function(b,a){try{if(!b)throw"Null object passed to Click";if(caap.waitingForDomLoad===
false){schedule.setItem("clickedOnSomething",0);caap.waitingForDomLoad=true}this.waitMilliSecs=a?a:5E3;var c=document.createEvent("MouseEvents");c.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);return!b.dispatchEvent(c)}catch(d){this.error("ERROR in utility.Click: "+d)}},ClickAjax:function(b,a){try{if(!b)throw"No link passed to Click Ajax";if(state.getItem("clickUrl","").indexOf(b)<0){state.setItem("clickUrl","http://apps.facebook.com/castle_age/"+b);caap.waitingForDomLoad=
false}return this.VisitUrl("javascript:void(a46755028429_ajaxLinkSend('globalContainer', '"+b+"'))",a)}catch(c){this.error("ERROR in utility.ClickAjax: "+c)}},oneMinuteUpdate:function(b){try{if(!state.getItem("reset"+b)&&!schedule.check(b+"Timer"))return false;schedule.setItem(b+"Timer",60);state.setItem("reset"+b,false);return true}catch(a){this.error("ERROR in utility.oneMinuteUpdate: "+a)}},NavigateTo:function(b,a){try{var c=document.getElementById("content"),d=[],e=0,g=null,f="",j=null,i=null;
if(!c){this.warn("No content to Navigate to",a,b);return false}if(a&&this.CheckForImage(a))return false;d=b.split(",");for(e=d.length-1;e>=0;e-=1){if(g=nHtml.FindByAttrXPath(c,"a","contains(@href,'/"+d[e]+".php') and not(contains(@href,'"+d[e]+".php?'))")){this.log(1,"Go to",d[e]);this.Click(g);return true}f=d[e];if(f.indexOf(".")===-1)f+=".";if(j=nHtml.FindByAttrContains(document.body,"input","src",f)){this.log(2,"Click on image",j.src.match(/[\w.]+$/));this.Click(j);return true}if(i=nHtml.FindByAttrContains(document.body,
"img","src",f)){this.log(2,"Click on image",i.src.match(/[\w.]+$/));this.Click(i);return true}}this.warn("Unable to Navigate to",a,b);return false}catch(k){this.error("ERROR in utility.NavigateTo: "+k,a,b)}},CheckForImage:function(b,a,c,d){try{var e="",g=null;a||(a=c?c.body:document.body);e=d?":eq("+d+")":":first";g=$(a).find("input[src*='"+b+"']"+e);if(!g.length){g=$(a).find("img[src*='"+b+"']"+e);g.length||(g=$(a).find("div[style*='"+b+"']"+e))}return g.length?g.get(0):null}catch(f){this.error("ERROR in utility.CheckForImage: "+
f)}},NumberOnly:function(b){try{return parseFloat(b.toString().replace(RegExp("[^0-9\\.]","g"),""))}catch(a){this.error("ERROR in utility.NumberOnly: "+a,arguments.callee.caller)}},RemoveHtmlJunk:function(b){try{return b.replace(RegExp("\\&[^;]+;","g"),"")}catch(a){this.error("ERROR in utility.RemoveHtmlJunk: "+a)}},typeOf:function(b){try{var a=typeof b;if(a==="object")if(b){if(b instanceof Array)a="array"}else a="null";return a}catch(c){this.error("ERROR in utility.typeOf: "+c)}},isEmpty:function(b){try{var a,
c,d=true;if(this.typeOf(b)==="object")for(a in b)if(b.hasOwnProperty(a)){c=b[a];if(c!==undefined&&this.typeOf(c)!=="function"){d=false;break}}return d}catch(e){this.error("ERROR in utility.isEmpty: "+e)}},isNum:function(b){try{return!isNaN(b)&&typeof b==="number"}catch(a){this.error("ERROR in utility.isNum: "+a)}},isInt:function(b){try{var a=parseInt(b,10);if(isNaN(a))return false;return b===a&&b.toString()===a.toString()}catch(c){this.error("ERROR in utility.isInt: "+c)}},alert_id:0,alert:function(b){try{this.alert_id+=
1;var a=this.alert_id;$('<div id="alert_'+a+'" title="Alert!"><p>'+b+"</p></div>").appendTo(document.body);$("#alert_"+a).dialog({buttons:{Ok:function(){$(this).dialog("close")}}});return true}catch(c){this.error("ERROR in utility.alert: "+c);return false}},logLevel:1,log:function(b,a){if(console.log!==undefined)if(this.logLevel&&!isNaN(b)&&this.logLevel>=b){var c="v"+caapVersion+" ("+(new Date).toLocaleTimeString()+") : "+a;arguments.length>2?console.log(c,Array.prototype.slice.call(arguments,2)):
console.log(c)}},warn:function(b){if(console.warn!==undefined){var a="v"+caapVersion+" ("+(new Date).toLocaleTimeString()+") : "+b;arguments.length>1?console.warn(a,Array.prototype.slice.call(arguments,1)):console.warn(a)}else arguments.length>1?this.log(1,b,Array.prototype.slice.call(arguments,1)):this.log(1,b)},error:function(b){if(console.error!==undefined){var a="v"+caapVersion+" ("+(new Date).toLocaleTimeString()+") : "+b;arguments.length>1?console.error(a,Array.prototype.slice.call(arguments,
1)):console.error(a)}else arguments.length>1?this.log(1,b,Array.prototype.slice.call(arguments,1)):this.log(1,b)},timeouts:{},setTimeout:function(b,a){try{var c=window.setTimeout(function(){b();utility.timeouts[c]=undefined},a);this.timeouts[c]=1;return true}catch(d){this.error("ERROR in utility.setTimeout: "+d);return false}},clearTimeouts:function(){try{for(var b in this.timeouts)this.timeouts.hasOwnProperty(b)&&window.clearTimeout(b);this.timeouts={};return true}catch(a){this.error("ERROR in utility.clearTimeouts: "+
a);return false}},getHTMLPredicate:function(b){try{for(var a=b.length;a>1;a-=1)if(b.substr(a,1)==="/")return b.substr(a+1);return b}catch(c){this.error("ERROR in utility.getHTMLPredicate: "+c)}},TextToArray:function(b){try{var a=[],c=[],d=0;if(typeof b==="string"&&b!==""){b=b.replace(/,/g,"\n").replace(/ /g,"");if((c=b.split("\n"))&&c.length)for(d=0;d<c.length;d+=1)if(c[d]!=="")a.push(isNaN(c[d])?c[d]:parseFloat(c[d]))}this.log(2,"theArray",a);return a}catch(e){utility.error("ERROR in utility.TextToArray: "+
e)}},lpad:function(b,a,c){try{for(;b.length<c;)b=a+b;return b}catch(d){utility.error("ERROR in utility.lpad: "+d)}},rpad:function(b,a,c){try{for(;b.length<c;)b+=a;return b}catch(d){utility.error("ERROR in utility.rpad: "+d)}},SHA1:function(b){try{if(!b||typeof b!=="string"){utility.warn("msg",b);throw"Invalid msg!";}var a=function(x,A){return x<<A|x>>>32-A},c=function(x){var A="",z,B;for(z=7;z>=0;z-=1){B=x>>>z*4&15;A+=B.toString(16)}return A},d,e,g,f=[80],j=1732584193,i=4023233417,k=2562383102,l=
271733878,p=3285377520,o=null,h=null,m=null,t=null,s=null,n=null,r=0,w=[];b=function(x){x=x.replace(/\r\n/g,"\n");var A="",z=0,B="";for(z=0;z<x.length;z+=1){B=x.charCodeAt(z);if(B<128)A+=String.fromCharCode(B);else{if(B>127&&B<2048)A+=String.fromCharCode(B>>6|192);else{A+=String.fromCharCode(B>>12|224);A+=String.fromCharCode(B>>6&63|128)}A+=String.fromCharCode(B&63|128)}}return A}(b);r=b.length;for(e=0;e<r-3;e+=4){g=b.charCodeAt(e)<<24|b.charCodeAt(e+1)<<16|b.charCodeAt(e+2)<<8|b.charCodeAt(e+3);
w.push(g)}switch(r%4){case 0:e=2147483648;break;case 1:e=b.charCodeAt(r-1)<<24|8388608;break;case 2:e=b.charCodeAt(r-2)<<24|b.charCodeAt(r-1)<<16|32768;break;case 3:e=b.charCodeAt(r-3)<<24|b.charCodeAt(r-2)<<16|b.charCodeAt(r-1)<<8|128;break;default:}for(w.push(e);w.length%16!==14;)w.push(0);w.push(r>>>29);w.push(r<<3&4294967295);for(d=0;d<w.length;d+=16){for(e=0;e<16;e+=1)f[e]=w[d+e];for(e=16;e<=79;e+=1)f[e]=a(f[e-3]^f[e-8]^f[e-14]^f[e-16],1);o=j;h=i;m=k;t=l;s=p;for(e=0;e<=19;e+=1){n=a(o,5)+(h&m|
~h&t)+s+f[e]+1518500249&4294967295;s=t;t=m;m=a(h,30);h=o;o=n}for(e=20;e<=39;e+=1){n=a(o,5)+(h^m^t)+s+f[e]+1859775393&4294967295;s=t;t=m;m=a(h,30);h=o;o=n}for(e=40;e<=59;e+=1){n=a(o,5)+(h&m|h&t|m&t)+s+f[e]+2400959708&4294967295;s=t;t=m;m=a(h,30);h=o;o=n}for(e=60;e<=79;e+=1){n=a(o,5)+(h^m^t)+s+f[e]+3395469782&4294967295;s=t;t=m;m=a(h,30);h=o;o=n}j=j+o&4294967295;i=i+h&4294967295;k=k+m&4294967295;l=l+t&4294967295;p=p+s&4294967295}n=c(j)+c(i)+c(k)+c(l)+c(p);return n.toLowerCase()}catch(D){utility.error("ERROR in utility.SHA1: "+
D)}}};
config={options:{},log:function(b,a){try{var c={};if(utility.logLevel>=b){$.extend(c,this.options);utility.log(b,a,c)}return true}catch(d){utility.error("ERROR in config.log: "+d);return false}},load:function(){try{if(gm.getItem("config.options","default")==="default")gm.setItem("config.options",this.options);else this.options=gm.getItem("config.options",this.options);if(utility.typeOf(this.options)!=="object"){utility.warn("Invalid options object! Resetting!");gm.deleteItem("config.options");this.options=
{}}this.log(2,"config.load");return true}catch(b){utility.error("ERROR in config.load: "+b);return false}},save:function(){try{gm.setItem("config.options",this.options);this.log(2,"config.save");return true}catch(b){utility.error("ERROR in config.save: "+b);return false}},setItem:function(b,a){try{if(typeof b!=="string"||b==="")throw"Invalid identifying name!";if(a===undefined||a===null)throw"Value supplied is 'undefined' or 'null'!";this.options[b]=a;this.save();return a}catch(c){utility.error("ERROR in config.setItem: "+
c)}},getItem:function(b,a){try{var c;if(typeof b!=="string"||b==="")throw"Invalid identifying name!";c=this.options[b];if((c===undefined||c===null)&&a!==undefined&&a!==null)c=a;if(c===undefined||c===null)utility.warn("config.getItem returned 'undefined' or 'null' for",b);return c}catch(d){utility.error("ERROR in config.getItem: "+d)}},deleteItem:function(b){try{if(typeof b!=="string"||b==="")throw"Invalid identifying name!";if(this.options[b]===undefined||this.options[b]===null)utility.warn("config.deleteItem - Invalid or non-existant flag: ",
b);delete this.options[b];return true}catch(a){utility.error("ERROR in config.deleteItem: "+a);return false}}};
state={flags:{},log:function(b,a){try{var c={};if(utility.logLevel>=b){$.extend(c,this.flags);utility.log(b,a,c)}return true}catch(d){utility.error("ERROR in state.log: "+d);return false}},load:function(){try{if(gm.getItem("state.flags","default")==="default")gm.setItem("state.flags",this.flags);else this.flags=gm.getItem("state.flags",this.flags);if(utility.typeOf(this.flags)!=="object"){utility.warn("Invalid flags object! Resetting!");gm.deleteItem("state.flags");this.flags={}}this.log(2,"state.load");
return true}catch(b){utility.error("ERROR in state.load: "+b);return false}},save:function(b){try{if(!b)if(!schedule.check("StateSave"))return false;gm.setItem("state.flags",this.flags);this.log(2,"state.save");schedule.setItem("StateSave",1);return true}catch(a){utility.error("ERROR in state.save: "+a);return false}},setItem:function(b,a){try{if(typeof b!=="string"||b==="")throw"Invalid identifying name!";if(a===undefined||a===null)throw"Value supplied is 'undefined' or 'null'!";this.flags[b]=a;
this.save();return a}catch(c){utility.error("ERROR in state.setItem: "+c)}},getItem:function(b,a){try{var c;if(typeof b!=="string"||b==="")throw"Invalid identifying name!";c=this.flags[b];if((c===undefined||c===null)&&a!==undefined&&a!==null)c=a;if(c===undefined||c===null)utility.warn("state.getItem returned 'undefined' or 'null' for",b);return c}catch(d){utility.error("ERROR in state.getItem: "+d)}},deleteItem:function(b){try{if(typeof b!=="string"||b==="")throw"Invalid identifying name!";if(this.flags[b]===
undefined||this.flags[b]===null)utility.warn("state.deleteItem - Invalid or non-existant flag: ",b);delete this.flags[b];return true}catch(a){utility.error("ERROR in state.deleteItem: "+a);return false}}};
css={AddCSS:function(){try{var b=window.location.href;if(b.indexOf("apps.facebook.com/castle_age")>=0){$('link[href*="jquery-ui-1.8.1.custom.css"').length||$("<link>").appendTo("head").attr({rel:"stylesheet",type:"text/css",href:"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/themes/smoothness/jquery-ui.css"});$("<style type='text/css'>"+this.farbtastic+"</style>").appendTo("head")}if(gm.getItem("fbFilter",false,hiddenVar)&&(b.indexOf("apps.facebook.com/reqs.php")>=0||b.indexOf("apps.facebook.com/home.php")>=
0||b.indexOf("filter=app_46755028429")>=0))$("<style type='text/css'>#contentArea div[id^='div_story_']:not([class*='46755028429']) {\ndisplay:none !important;\n}</style>").appendTo("head");return true}catch(a){this.error("ERROR in AddCSS: "+a);return false}},farbtastic:".farbtastic {  position: relative;}.farbtastic * {  position: absolute;  cursor: crosshair;}.farbtastic, .farbtastic .wheel {  width: 195px;  height: 195px;}.farbtastic .color, .farbtastic .overlay {  top: 47px;  left: 47px;  width: 101px;  height: 101px;}.farbtastic .wheel {  background: url(data:image/png;base64,"+
image64.wheel+") no-repeat;  width: 195px;  height: 195px;}.farbtastic .overlay {  background: url(data:image/png;base64,"+image64.mask+") no-repeat;}.farbtastic .marker {  width: 17px;  height: 17px;  margin: -8px 0 0 -8px;  overflow: hidden;  background: url(data:image/png;base64,"+image64.marker+") no-repeat;}"};
gm={namespace:"caap",fireFoxUseGM:false,setItem:function(b,a){try{var c;if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(a===undefined||a===null)throw"Value supplied is 'undefined' or 'null'! ("+a+")";c=JSON.stringify(a);if(c===undefined||c===null)throw"JSON.stringify returned 'undefined' or 'null'! ("+c+")";utility.is_html5_storage&&!this.fireFoxUseGM?localStorage.setItem(this.namespace+"."+caap.stats.FBID+"."+b,c):GM_setValue(this.namespace+"."+caap.stats.FBID+"."+b,c);
return a}catch(d){utility.error("ERROR in gm.setItem: "+d,arguments.callee.caller)}},getItem:function(b,a,c){try{var d;if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";d=utility.is_html5_storage&&!this.fireFoxUseGM?$.parseJSON(localStorage.getItem(this.namespace+"."+caap.stats.FBID+"."+b)):$.parseJSON(GM_getValue(this.namespace+"."+caap.stats.FBID+"."+b));if(d===undefined||d===null){c||utility.warn("gm.getItem parseJSON returned 'undefined' or 'null' for ",b);if(a!==undefined&&
a!==null){c||utility.warn("gm.getItem using default value ",a);d=a}else throw"No default value supplied! ("+a+")";}return d}catch(e){utility.error("ERROR in gm.getItem: "+e,arguments.callee.caller)}},deleteItem:function(b){try{if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";utility.is_html5_storage&&!this.fireFoxUseGM?localStorage.removeItem(this.namespace+"."+caap.stats.FBID+"."+b):GM_deleteValue(this.namespace+"."+caap.stats.FBID+"."+b);return true}catch(a){utility.error("ERROR in gm.deleteItem: "+
a,arguments.callee.caller);return false}},clear:function(){try{if(utility.is_html5_storage&&!this.fireFoxUseGM)localStorage.clear();else{var b=[],a=0;b=GM_listValues();for(a=0;a<b.length;a+=1)b[a].match(RegExp(this.namespace+"."+caap.stats.FBID))&&GM_deleteValue(b[a])}return true}catch(c){utility.error("ERROR in gm.clear: "+c,arguments.callee.caller);return false}},length:function(b){try{if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";return this.getItem(b,[]).length}catch(a){utility.error("ERROR in gm.length: "+
a,arguments.callee.caller)}},splice:function(b,a,c){try{var d=[],e=null,g=0;if(arguments.length<3)throw"Must provide name, index & howmany!";if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(!utility.isNum(a)||a<0)throw"Invalid index! ("+a+")";if(!utility.isNum(c)||c<0)throw"Invalid howmany! ("+c+")";d=this.getItem(b,[]);if(arguments.length>=4){e=d.splice(a,c);for(g=3;g<arguments.length;g+=1)d.splice(a+g-2,0,arguments[g])}else e=d.splice(a,c);this.setItem(b,d);return e}catch(f){utility.error("ERROR in gm.splice: "+
f,arguments.callee.caller)}},unshift:function(b){try{var a=[],c=0,d=0;if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(arguments.length<2)throw"Must provide element(s)!";a=this.getItem(b,[]);for(d=1;d<arguments.length;d+=1)c=a.unshift(arguments[d]);this.setItem(b,a);return c}catch(e){utility.error("ERROR in gm.unshift: "+e,arguments.callee.caller)}},shift:function(b){try{var a=[],c=null;if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";a=this.getItem(b,
[]);c=a.shift();this.setItem(b,a);return c}catch(d){utility.error("ERROR in gm.shift: "+d,arguments.callee.caller)}},push:function(b){try{var a=[],c=0,d=0;if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(arguments.length<2)throw"Must provide element(s)!";a=this.getItem(b,[]);for(d=1;d<arguments.length;d+=1)c=a.push(arguments[d]);this.setItem(b,a);return c}catch(e){utility.error("ERROR in gm.push: "+e,arguments.callee.caller)}},pop:function(b){try{var a=[],c=null;if(typeof b!==
"string"||b==="")throw"Invalid identifying name! ("+b+")";a=this.getItem(b,[]);c=a.pop();this.setItem(b,a);return c}catch(d){utility.error("ERROR in gm.pop: "+d,arguments.callee.caller)}}};
nHtml={xpath:{string:XPathResult.STRING_TYPE,unordered:XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,first:XPathResult.FIRST_ORDERED_NODE_TYPE},FindByAttrContains:function(b,a,c,d,e,g){var f=null;f=null;if(c==="className")c="class";e||(e=document);if(g){if(f=e.evaluate(".//"+a+"[contains(translate(@"+c+",'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'),'"+d.toLowerCase()+"')]",b,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null))if(g<f.snapshotLength)return f.snapshotItem(g);else if(g>=f.snapshotLength)return f.snapshotItem(f.snapshotLength-
1)}else if((f=e.evaluate(".//"+a+"[contains(translate(@"+c+",'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'),'"+d.toLowerCase()+"')]",b,null,this.xpath.first,null))&&f.singleNodeValue)return f.singleNodeValue;return null},FindByAttrXPath:function(b,a,c,d){var e=null;a=".//"+a+"["+c+"]";try{if(b===null){utility.warn("Trying to find xpath with null obj:"+a);return null}d||(d=document);e=d.evaluate(a,b,null,this.xpath.first,null)}catch(g){utility.error("XPath Failed:"+g,a)}if(e&&e.singleNodeValue)return e.singleNodeValue;
return null},spaceTags:{td:1,br:1,hr:1,span:1,table:1},GetText:function(b){var a=" ",c=0,d=null;if(b.tagName!==undefined&&this.spaceTags[b.tagName.toLowerCase()])a+=" ";if(b.nodeName==="#text")return a+b.textContent;for(c=0;c<b.childNodes.length;c+=1){d=b.childNodes[c];a+=this.GetText(d)}return a},getX:function(b,a,c){var d=null;switch(c){case this.xpath.string:d=document.evaluate(b,a,null,c,null).stringValue;break;case this.xpath.first:d=document.evaluate(b,a,null,c,null).singleNodeValue;break;case this.xpath.unordered:d=
document.evaluate(b,a,null,c,null);break;default:}return d}};
sort={name:function(b,a){var c=b.name.toLowerCase(),d=a.name.toLowerCase();if(c<d)return-1;if(c>d)return 1;return 0},lvl:function(b,a){var c=b.lvl,d=a.lvl;if(c>d)return-1;if(c<d)return 1;return 0},atk:function(b,a){var c=b.atk,d=a.atk;if(c>d)return-1;if(c<d)return 1;return 0},def:function(b,a){var c=b.def,d=a.def;if(c>d)return-1;if(c<d)return 1;return 0},api:function(b,a){var c=b.api,d=a.api;if(c>d)return-1;if(c<d)return 1;return 0},dpi:function(b,a){var c=b.dpi,d=a.dpi;if(c>d)return-1;if(c<d)return 1;
return 0},mpi:function(b,a){var c=b.mpi,d=a.mpi;if(c>d)return-1;if(c<d)return 1;return 0},eatk:function(b,a){var c=b.eatk,d=a.eatk;if(c>d)return-1;if(c<d)return 1;return 0},edef:function(b,a){var c=b.edef,d=a.edef;if(c>d)return-1;if(c<d)return 1;return 0},eapi:function(b,a){var c=b.eapi,d=a.eapi;if(c>d)return-1;if(c<d)return 1;return 0},edpi:function(b,a){var c=b.edpi,d=a.edpi;if(c>d)return-1;if(c<d)return 1;return 0},empi:function(b,a){var c=b.empi,d=a.empi;if(c>d)return-1;if(c<d)return 1;return 0},
owned:function(b,a){var c=b.owned,d=a.owned;if(c>d)return-1;if(c<d)return 1;return 0},cost:function(b,a){var c=b.cost,d=a.cost;if(c>d)return-1;if(c<d)return 1;return 0},upkeep:function(b,a){var c=b.upkeep,d=a.upkeep;if(c>d)return-1;if(c<d)return 1;return 0},hourly:function(b,a){var c=b.hourly,d=a.hourly;if(c>d)return-1;if(c<d)return 1;return 0}};
schedule={timers:{},log:function(b,a){try{var c={};if(utility.logLevel>=b){$.extend(c,this.timers);utility.log(b,a,c)}return true}catch(d){utility.error("ERROR in schedule.log: "+d);return false}},load:function(){try{if(gm.getItem("schedule.timers","default")==="default")gm.setItem("schedule.timers",this.timers);else this.timers=gm.getItem("schedule.timers",this.timers);if(utility.typeOf(this.timers)!=="object"){utility.warn("Invalid timers object! Resetting!");gm.deleteItem("schedule.timers");this.timers=
{}}this.log(2,"schedule.load");return true}catch(b){utility.error("ERROR in schedule.load: "+b);return false}},save:function(){try{gm.setItem("schedule.timers",this.timers);this.log(2,"schedule.save");return true}catch(b){utility.error("ERROR in schedule.save: "+b);return false}},setItem:function(b,a,c){try{var d;if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(!utility.isNum(a)||a<0)throw"Invalid number of seconds supplied for ("+b+") ("+a+")";if(!utility.isNum(c)||c<0)c=
0;d=(new Date).getTime();this.timers[b]={last:d,next:d+a*1E3+Math.floor(Math.random()*c)*1E3};this.save();return this.timers[b]}catch(e){utility.error("ERROR in schedule.setItem: "+e)}},getItem:function(b){try{if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(utility.typeOf(this.timers[b])!=="object")throw"Invalid or non-existant timer! "+b;return this.timers[b]}catch(a){utility.error("ERROR in schedule.getItem: "+a)}},deleteItem:function(b){try{if(typeof b!=="string"||b===
"")throw"Invalid identifying name! ("+b+")";utility.typeOf(this.timers[b])!=="object"&&utility.warn("schedule.deleteItem - Invalid or non-existant timer: ",b);delete this.timers[b];return true}catch(a){utility.error("ERROR in schedule.deleteItem: "+a);return false}},check:function(b){try{var a=false;if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(utility.typeOf(this.timers[b])!=="object"){utility.logLevel>2&&utility.warn("Invalid or non-existant timer!",b);a=true}else if(this.timers[b].next<
(new Date).getTime())a=true;return a}catch(c){utility.error("ERROR in schedule.check: "+c);return false}},since:function(b,a){try{var c=0;if(isNaN(b)){if(typeof b!=="string"||b==="")throw"Invalid identifying name! ("+b+")";if(utility.typeOf(this.timers[b])!=="object")utility.logLevel>2&&utility.warn("Invalid or non-existant timer!",b);else c=this.timers[b].last}else c=b;return c<(new Date).getTime()-1E3*a}catch(d){utility.error("ERROR in schedule.since: "+d,arguments.callee.caller);return false}},
FormatTime:function(b){try{var a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],c=b.getDay(),d=b.getHours(),e=b.getMinutes();b="PM";if(config.getItem("use24hr",true)){d+="";if(d&&d.length===1)d="0"+d;e+="";if(e&&e.length===1)e="0"+e;return a[c]+" "+d+":"+e}else{if(d<12)b="AM";if(d===0)d=12;if(d>12)d-=12;e+="";if(e&&e.length===1)e="0"+e;return a[c]+" "+d+":"+e+" "+b}}catch(g){utility.error("ERROR in FormatTime: "+g);return"Time Err"}},display:function(b){try{var a="";if(typeof b!=="string"||b==="")throw"Invalid identifying name!";
if(utility.typeOf(this.timers[b])!=="object"){utility.logLevel>2&&utility.warn("Invalid or non-existant timer!",b);a=this.FormatTime(new Date)}else a=this.FormatTime(new Date(this.timers[b].next));return a}catch(c){utility.error("ERROR in schedule.display: "+c);return false}}};
general={records:[],recordsSortable:[],record:function(){this.data={name:"",img:"",lvl:0,last:(new Date).getTime()-864E5,special:"",atk:0,def:0,api:0,dpi:0,mpi:0,eatk:0,edef:0,eapi:0,edpi:0,empi:0,energyMax:0,staminaMax:0,healthMax:0}},log:function(b,a){try{var c=[];if(utility.logLevel>=b){$.merge(c,this.records);utility.log(b,a,c)}return true}catch(d){utility.error("ERROR in general.log: "+d);return false}},copy2sortable:function(){try{this.recordsSortable=[];$.merge(this.recordsSortable,this.records);
return true}catch(b){utility.error("ERROR in general.copy2sortable: "+b);return false}},load:function(){try{this.records=gm.getItem("general.records","default");if(this.records==="default"){this.records=[];gm.setItem("general.records",this.records)}this.copy2sortable();this.BuildlLists();state.setItem("GeneralsDashUpdate",true);this.log(2,"general.load");return true}catch(b){utility.error("ERROR in general.load: "+b);return false}},save:function(){try{gm.setItem("general.records",this.records);state.setItem("GeneralsDashUpdate",
true);this.log(2,"general.save");return true}catch(b){utility.error("ERROR in general.save: "+b);return false}},find:function(b){try{var a=0;for(a=0;a<this.records.length;a+=1)if(this.records[a].name===b)break;if(a>=this.records.length){utility.warn("Unable to find 'General' record");return false}return this.records[a]}catch(c){utility.error("ERROR in general.find: "+c);return false}},GetNames:function(){try{var b=0,a=[];for(b=0;b<this.records.length;b+=1)a.push(this.records[b].name);return a.sort()}catch(c){utility.error("ERROR in general.GetNames: "+
c);return false}},GetImage:function(b){try{var a=this.find(b);if(a===false){utility.warn("Unable to find 'General' image");a=""}else a=a.img;return a}catch(c){utility.error("ERROR in general.GetImage: "+c);return false}},GetStaminaMax:function(b){try{var a=this.find(b);if(a===false){utility.warn("Unable to find 'General' stamina");a=0}else a=a.staminaMax;return a}catch(c){utility.error("ERROR in general.GetStaminaMax: "+c);return false}},GetEnergyMax:function(b){try{var a=this.find(b);if(a===false){utility.warn("Unable to find 'General' energy");
a=0}else a=a.energyMax;return a}catch(c){utility.error("ERROR in general.GetEnergyMax: "+c);return false}},GetHealthMax:function(b){try{var a=this.find(b);if(a===false){utility.warn("Unable to find 'General' health");a=0}else a=a.healthMax;return a}catch(c){utility.error("ERROR in general.GetHealthMax: "+c);return false}},GetLevelUpNames:function(){try{var b=0,a=[];for(b=0;b<this.records.length;b+=1)this.records[b].lvl<4&&a.push(this.records[b].name);return a}catch(c){utility.error("ERROR in general.GetLevelUpNames: "+
c);return false}},List:[],BuyList:[],IncomeList:[],BankingList:[],CollectList:[],StandardList:["Idle","Monster","Fortify","Battle","Duel","War","SubQuest"],BuildlLists:function(){try{utility.log(1,"Building Generals Lists");this.List=["Use Current","Under Level 4"].concat(this.GetNames());var b=function(c){return general.List.indexOf(c)>=0};this.BuyList=["Use Current","Darius","Lucius","Garlan","Penelope"].filter(b);this.IncomeList=["Use Current","Scarlett","Mercedes","Cid"].filter(b);this.BankingList=
["Use Current","Aeris"].filter(b);this.CollectList=["Use Current","Angelica","Morrigan"].filter(b);return true}catch(a){utility.error("ERROR in BuildlLists: "+a);return false}},GetCurrent:function(){try{var b="",a=null;if(a=$("#app46755028429_equippedGeneralContainer .general_name_div3"))b=$.trim(a.text()).replace(/[\t\r\n]/g,"").replace("**","");if(!b){utility.warn("Couldn't get current 'General'. Will use current 'General'",b);return"Use Current"}utility.log(8,"Current General",b);return b}catch(c){utility.error("ERROR in GetCurrent: "+
c);return"Use Current"}},GetGenerals:function(){try{var b=null,a=false,c=false,d=null;b=$(".generalSmallContainer2");if(b.length){b.each(function(g){var f=new general.record,j="",i="",k=0,l=0,p=0,o="",h=$(this),m=0;if((d=h.find(".general_name_div3"))&&d.length)j=d.text().replace(/[\t\r\n]/g,"").replace("**","");else utility.warn("Unable to find 'name' container",g);if((d=h.find(".imgButton"))&&d.length)i=utility.getHTMLPredicate(d.attr("src"));else utility.warn("Unable to find 'image' container",
g);if((d=h.children().eq(3))&&d.length)k=parseInt(d.text().replace(/Level /gi,"").replace(/[\t\r\n]/g,""),10);else utility.warn("Unable to find 'level' container",g);if((d=h.children().eq(4))&&d.length)o=$.trim($(d.html().replace(/<br>/g," ")).text());else utility.warn("Unable to find 'special' container",g);if((d=h.find(".generals_indv_stats_padding div"))&&d.length===2){l=parseInt(d.eq(0).text(),10);p=parseInt(d.eq(1).text(),10)}else utility.warn("Unable to find 'attack and defence' containers",
g);if(j&&i&&k&&utility.isNum(l)&&utility.isNum(p)&&o){for(m=0;m<general.records.length;m+=1)if(general.records[m].name===j){f.data=general.records[m];break}f.data.name=j;f.data.img=i;f.data.lvl=k;f.data.atk=l;f.data.def=p;f.data.api=l+p*0.7;f.data.dpi=p+l*0.7;f.data.mpi=(f.data.api+f.data.dpi)/2;f.data.special=o;if(m<general.records.length)general.records[m]=f.data;else{utility.log(1,"Adding new 'General'",f.data.name);general.records.push(f.data);a=true}c=true}else utility.warn("Missing required 'General' attribute",
g)});if(c){caap.stats.generals.total=this.records.length;caap.stats.generals.invade=Math.min((caap.stats.army.actual/5).toFixed(0),this.records.length);this.save();caap.SaveStats();this.copy2sortable();a&&this.UpdateDropDowns()}utility.log(2,"All Generals",this.records)}return true}catch(e){utility.error("ERROR in GetGenerals: "+e);return false}},UpdateDropDowns:function(){try{this.BuildlLists();utility.log(1,"Updating 'General' Drop Down Lists");for(var b in this.StandardList)this.StandardList.hasOwnProperty(b)&&
caap.ChangeDropDownList(this.StandardList[b]+"General",this.List,config.getItem(this.StandardList[b]+"General","Use Current"));caap.ChangeDropDownList("BuyGeneral",this.BuyList,config.getItem("BuyGeneral","Use Current"));caap.ChangeDropDownList("IncomeGeneral",this.IncomeList,config.getItem("IncomeGeneral","Use Current"));caap.ChangeDropDownList("BankingGeneral",this.BankingList,config.getItem("BankingGeneral","Use Current"));caap.ChangeDropDownList("CollectGeneral",this.CollectList,config.getItem("CollectGeneral",
"Use Current"));caap.ChangeDropDownList("LevelUpGeneral",this.List,config.getItem("LevelUpGeneral","Use Current"));return true}catch(a){utility.error("ERROR in UpdateDropDowns: "+a);return false}},Clear:function(b){try{utility.log(1,"Setting "+b+' to "Use Current"');config.setItem(b,"Use Current");this.UpdateDropDowns();return true}catch(a){utility.error("ERROR in Clear: "+a);return false}},LevelUpCheck:function(b){try{var a="",c=false,d=false;if((caap.stats.staminaT.num>caap.stats.stamina.max||caap.stats.energyT.num>
caap.stats.energy.max)&&state.getItem("KeepLevelUpGeneral",false)){utility.log(1,"Keep Level Up General");d=true}else if(state.getItem("KeepLevelUpGeneral",false)){utility.log(1,"Clearing Keep Level Up General flag");state.setItem("KeepLevelUpGeneral",false)}a=$.trim(b.replace(/General/i,""));if(config.getItem("LevelUpGeneral","Use Current")!=="Use Current"&&(this.StandardList.indexOf(a)>=0||a==="Quest"))if(d||config.getItem(a+"LevelUpGeneral",false)&&caap.stats.exp.dif&&caap.stats.exp.dif<=config.getItem("LevelUpGeneralExp",
0))c=true;return c}catch(e){utility.error("ERROR in LevelUpCheck: "+e)}},Select:function(b){try{var a="",c="",d="",e="";if(this.LevelUpCheck(b)){b="LevelUpGeneral";utility.log(1,"Using level up general")}a=config.getItem(b,"Use Current");if(!a||/use current/i.test(a))return false;if(/under level 4/i.test(a)){if(!this.GetLevelUpNames().length)return this.Clear(b);a=config.getItem("ReverseLevelUpGenerals")?this.GetLevelUpNames().reverse().pop():this.GetLevelUpNames().pop()}(c=this.GetCurrent())||caap.ReloadCastleAge();
d=c;if(a.indexOf(d)>=0)return false;utility.log(1,"Changing from "+d+" to "+a);if(utility.NavigateTo("mercenary,generals","tab_generals_on.gif"))return true;e=this.GetImage(a);if(utility.CheckForImage(e))return utility.NavigateTo(e);caap.SetDivContent("Could not find "+a);utility.warn("Could not find",a,e);return config.getItem("ignoreGeneralImage",true)?false:this.Clear(b)}catch(g){utility.error("ERROR in Select: "+g);return false}},quickSwitch:false,GetEquippedStats:function(){try{var b="",a=0,
c=null,d=null,e=false;b=this.GetCurrent();if(b==="Use Current")return false;utility.log(1,"Equipped 'General'",b);for(a=0;a<this.records.length;a+=1)if(this.records[a].name===b)break;if(a>=this.records.length){utility.warn("Unable to find 'General' record");return false}if((c=$("#app46755028429_equippedGeneralContainer .generals_indv_stats div"))&&c.length===2){if((d=c.eq(0))&&d.length){this.records[a].eatk=parseInt(d.text(),10);if((d=c.eq(1))&&d.length){this.records[a].edef=parseInt(d.text(),10);
e=true}else utility.warn("Unable to get 'General' defense object")}else utility.warn("Unable to get 'General' attack object");if(e){this.records[a].eapi=this.records[a].eatk+this.records[a].edef*0.7;this.records[a].edpi=this.records[a].edef+this.records[a].eatk*0.7;this.records[a].empi=(this.records[a].eapi+this.records[a].edpi)/2;this.records[a].energyMax=caap.stats.energyT.max;this.records[a].staminaMax=caap.stats.staminaT.max;this.records[a].healthMax=caap.stats.healthT.max;this.records[a].last=
(new Date).getTime();this.save();this.copy2sortable();utility.log(2,"Got 'General' stats",this.records[a])}else utility.warn("Unable to get 'General' stats")}else utility.warn("Unable to get equipped 'General' divs",c);return this.records[a]}catch(g){utility.error("ERROR in GetAllStats: "+g);return false}},GetAllStats:function(){try{if(!schedule.check("allGenerals"))return false;var b="",a=0,c="";for(a=0;a<this.records.length;a+=1)if(schedule.since(this.records[a].last,gm.getItem("GeneralLastReviewed",
24,hiddenVar)*3600))break;if(a>=this.records.length){schedule.setItem("allGenerals",gm.getItem("GetAllGenerals",168,hiddenVar)*3600,300);utility.log(2,"Finished visiting all Generals for their stats");c=config.getItem("IdleGeneral","Use Current");if(c!=="Use Current"){utility.log(1,"Changing to idle general");return this.Select("IdleGeneral")}return false}if(utility.NavigateTo("mercenary,generals","tab_generals_on.gif")){utility.log(1,"Visiting generals to get 'General' stats");return true}b=this.GetImage(this.records[a].name);
if(utility.CheckForImage(b))if(this.GetCurrent()!==this.records[a].name){utility.log(1,"Visiting 'General'",this.records[a].name);return utility.NavigateTo(b)}return true}catch(d){utility.error("ERROR in GetAllStats: "+d);return false}}};
monster={records:[],record:function(){this.data={name:"",attacked:-1,defended:-1,damage:-1,life:-1,fortify:-1,timeLeft:"",t2k:-1,phase:"",link:"",rix:-1,over:"",page:"",color:"",review:-1,type:"",conditions:"",charClass:"",strength:-1,stun:-1,stunTime:-1,stunDo:false,stunType:"",tip:""}},engageButtons:{},completeButton:{battle_monster:{name:undefined,button:undefined},raid:{name:undefined,button:undefined}},info:{Deathrune:{duration:96,defense:true,hp:1E8,ach:1E6,siege:5,siegeClicks:[30,60,90,120,
200],siegeDam:[66E5,825E4,99E5,132E5,165E5],siege_img:["/graphics/death_siege_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],reqAtkButton:"attack_monster_button.jpg",v:"attack_monster_button2.jpg",defButton:"button_dispel.gif",defense_img:"bar_dispel.gif"},"Ice Elemental":{duration:168,defense:true,hp:1E8,ach:1E6,siege:5,siegeClicks:[30,60,90,120,200],siegeDam:[726E4,9075E3,1089E4,1452E4,1815E4],siege_img:["/graphics/water_siege_small"],fort:true,staUse:5,
staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],reqAtkButton:"attack_monster_button.jpg",pwrAtkButton:"attack_monster_button2.jpg",defButton:"button_dispel.gif",defense_img:"bar_dispel.gif"},"Earth Elemental":{duration:168,defense:true,hp:1E8,ach:1E6,siege:5,siegeClicks:[30,60,90,120,200],siegeDam:[66E5,825E4,99E5,132E5,165E5],siege_img:["/graphics/earth_siege_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],reqAtkButton:"attack_monster_button.jpg",
pwrAtkButton:"attack_monster_button2.jpg",defButton:"attack_monster_button3.jpg",defense_img:"seamonster_ship_health.jpg",repair_img:"repair_bar_grey.jpg"},Hydra:{duration:168,hp:1E8,ach:5E5,siege:6,siegeClicks:[10,20,50,100,200,300],siegeDam:[134E4,268E4,536E4,147E5,282E5,3752E4],siege_img:["/graphics/monster_siege_small"],staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50]},Legion:{duration:168,hp:1E5,ach:1E3,siege:6,siegeClicks:[10,20,40,80,150,300],siegeDam:[3E3,4500,6E3,9E3,12E3,15E3],siege_img:["/graphics/castle_siege_small"],
fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],defense_img:"seamonster_ship_health.jpg",repair_img:"repair_bar_grey.jpg"},"Emerald Dragon":{duration:72,ach:1E5,siege:0},"Frost Dragon":{duration:72,ach:1E5,siege:0},"Gold Dragon":{duration:72,ach:1E5,siege:0},"Red Dragon":{duration:72,ach:1E5,siege:0},King:{duration:72,ach:15E3,siege:0},Terra:{duration:72,ach:2E4,siege:0},Queen:{duration:48,ach:5E4,siege:1,siegeClicks:[11],siegeDam:[5E5],siege_img:["/graphics/boss_sylvanas_drain_icon.gif"]},
Ravenmoore:{duration:48,ach:5E5,siege:0},Knight:{duration:48,ach:3E4,siege:0,reqAtkButton:"event_attack1.gif",pwrAtkButton:"event_attack2.gif",defButton:null},Serpent:{duration:72,defense:true,ach:25E4,siege:0,fort:true,defense_img:"seamonster_ship_health.jpg"},"Raid I":{duration:88,raid:true,ach:50,siege:2,siegeClicks:[30,50],siegeDam:[200,500],siege_img:["/graphics/monster_siege_"],staUse:1},"Raid II":{duration:144,raid:true,ach:50,siege:2,siegeClicks:[80,100],siegeDam:[300,1500],siege_img:["/graphics/monster_siege_"],
staUse:1},Mephistopheles:{duration:48,ach:2E5,siege:0},Plains:{alpha:true,duration:168,hp:35E7,ach:1E4,siege:7,siegeClicks:[30,60,90,120,200,250,300],siegeDam:[1375E4,175E5,205E5,23375E3,265E5,295E5,3425E4],siege_img:["/graphics/water_siege_small","/graphics/alpha_bahamut_siege_blizzard_small","/graphics/azriel_siege_inferno_small","/graphics/war_siege_holy_smite_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],defense_img:"nm_green.jpg"},"Volcanic Dragon":{alpha:true,
duration:168,hp:13E7,ach:4E6,siege:5,siegeClicks:[30,60,90,120,200],siegeDam:[7896E3,9982500,11979E3,15972E3,19965E3],siege_img:["/graphics/water_siege_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],defense_img:"nm_green.jpg"},"Alpha Volcanic Dragon":{alpha:true,duration:168,hp:62E7,ach:8E6,siege:7,siegeClicks:[30,60,90,120,200,250,300],siegeDam:[2225E4,275E5,325E5,375E5,425E5,475E5,55E6],siege_img:["/graphics/water_siege_small","/graphics/alpha_bahamut_siege_blizzard_small",
"/graphics/azriel_siege_inferno_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],defense_img:"nm_green.jpg"},Wrath:{alpha:true,duration:168,hp:6E8,ach:8E6,siege:7,siegeClicks:[30,60,90,120,200,250,300],siegeDam:[2225E4,275E5,325E5,375E5,425E5,475E5,55E6],siege_img:["/graphics/water_siege_small","/graphics/alpha_bahamut_siege_blizzard_small","/graphics/azriel_siege_inferno_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,
40,100],defense_img:"nm_green.jpg"},"Alpha Mephistopheles":{alpha:true,duration:168,hp:6E8,ach:12E6,siege:10,siegeClicks:[15,30,45,60,75,100,150,200,250,300],siegeDam:[1905E4,2286E4,2667E4,3048E4,3429E4,381E5,4572E4,4953E4,5334E4,6096E4],siege_img:["/graphics/earth_siege_small","/graphics/castle_siege_small","/graphics/death_siege_small","/graphics/skaar_siege_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],defense_img:"nm_green.jpg"},"Fire Elemental":{alpha:true,
duration:168,hp:35E7,ach:6E6,siege:7,siegeClicks:[30,60,90,120,200,250,300],siegeDam:[1475E4,185E5,21E6,2425E4,27E6,3E7,35E6],siege_img:["/graphics/water_siege_small","/graphics/alpha_bahamut_siege_blizzard_small","/graphics/azriel_siege_inferno_small","/graphics/war_siege_holy_smite_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],defense_img:"nm_green.jpg"},"Lion's Rebellion":{alpha:true,duration:168,hp:35E7,ach:2E4,siege:7,siegeClicks:[30,60,90,120,200,
250,300],siegeDam:[1525E4,19E6,215E5,2475E4,275E5,305E5,355E5],siege_img:["/graphics/water_siege_small","/graphics/alpha_bahamut_siege_blizzard_small","/graphics/azriel_siege_inferno_small","/graphics/war_siege_holy_smite_small"],fort:true,staUse:5,staLvl:[0,100,200,500],staMax:[5,10,20,50],nrgMax:[10,20,40,100],defense_img:"nm_green.jpg"}},log:function(b,a){try{var c=[];if(utility.logLevel>=b){$.merge(c,this.records);utility.log(b,a,c)}return true}catch(d){utility.error("ERROR in monster.log: "+
d);return false}},load:function(){try{this.records=gm.getItem("monster.records","default");if(this.records==="default"){this.records=[];gm.setItem("monster.records",this.records)}state.setItem("MonsterDashUpdate",true);this.log(2,"monster.load");return true}catch(b){utility.error("ERROR in monster.load: "+b);return false}},save:function(){try{gm.setItem("monster.records",this.records);state.setItem("MonsterDashUpdate",true);this.log(2,"monster.save");return true}catch(b){utility.error("ERROR in monster.save: "+
b);return false}},parseCondition:function(b,a){try{if(!a||a.toLowerCase().indexOf(":"+b)<0)return false;var c="",d=0,e=false,g=false;c=a.substring(a.indexOf(":"+b)+b.length+1).replace(/:.+/,"");d=parseFloat(c);if(/k$/i.test(c)||/m$/i.test(c)){e=/\d+k/i.test(c);g=/\d+m/i.test(c);d=d*1E3*(e+g*1E3)}return d}catch(f){utility.error("ERROR in monster.parseCondition: "+f);return false}},type:function(b){try{var a=[],c=0;if(typeof b!=="string"){utility.warn("name",b);throw"Invalid identifying name!";}if(b===
"")return"";a=b.split(" ");utility.log(2,"Words",a);c=a.length-1;if(c>=4)if(a[c-4]==="Alpha"&&a[c-1]==="Volcanic"&&a[c]==="Dragon")return a[c-4]+" "+a[c-1]+" "+a[c];if(a[c]==="Elemental"||a[c]==="Dragon"||a[c-1]==="Alpha"&&a[c]==="Mephistopheles"||a[c-1]==="Lion's"&&a[c]==="Rebellion"||a[c-1]==="Fire"&&a[c]==="Elemental")return a[c-1]+" "+a[c];return a[c]}catch(d){utility.error("ERROR in monster.type: "+d,arguments.callee.caller);return false}},getItem:function(b){try{var a=0,c=false,d=null;if(typeof b!==
"string"){utility.warn("name",b);throw"Invalid identifying name!";}if(b==="")return"";for(a=0;a<this.records.length;a+=1)if(this.records[a].name===b){c=true;break}if(c){utility.log(3,"Got monster record",b,this.records[a]);return this.records[a]}else{d=new this.record;d.data.name=b;utility.log(3,"New monster record",b,d.data);return d.data}}catch(e){utility.error("ERROR in monster.getItem: "+e,arguments.callee.caller);return false}},setItem:function(b){try{if(!b||utility.typeOf(b)!=="object")throw"Not passed a record";
if(typeof b.name!=="string"||b.name===""){utility.warn("name",b.name);throw"Invalid identifying name!";}var a=0,c=false;for(a=0;a<this.records.length;a+=1)if(this.records[a].name===b.name){c=true;break}if(c){this.records[a]=b;utility.log(3,"Updated monster record",b,this.records)}else{this.records.push(b);utility.log(3,"Added monster record",b,this.records)}this.save();return true}catch(d){utility.error("ERROR in monster.setItem: "+d);return false}},deleteItem:function(b){try{var a=0,c=false;if(typeof b!==
"string"||b===""){utility.warn("name",b);throw"Invalid identifying name!";}for(a=0;a<this.records.length;a+=1)if(this.records[a].name===b){c=true;break}if(c){this.records.splice(a,1);this.save();utility.log(2,"Deleted monster record",b,this.records);return true}else{utility.warn("Unable to delete monster record",b,this.records);return false}}catch(d){utility.error("ERROR in monster.deleteItem: "+d);return false}},clear:function(){try{this.records=state.setItem("monster.records",[]);return true}catch(b){utility.error("ERROR in monster.clear: "+
b);return false}},t2kCalc:function(b,a,c,d,e){try{var g="",f=0,j=0,i=0,k=0,l=0,p=0,o=0,h=0,m=0,t=0,s=0,n=0,r=0;f=parseInt(a[0],10)+parseInt(a[1],10)*0.0166;j=b.duration-f;if(!b.siege||!b.hp)return c*j/(100-c);g=(d-1).toString();k=(100-c)/100*b.hp;l=b.hp-k;for(n in b.siegeClicks)if(b.siegeClicks.hasOwnProperty(n)){utility.log(9,"s ",n," T2K ",i," hpLeft ",l);if(n<g||e===0){p+=b.siegeDam[n];o+=b.siegeClicks[n]}if(n===g){h=(k-p)/j;m=(o+b.siegeClicks[n]-e)/j;utility.log(9,"Attack Damage Per Hour: ",h);
utility.log(9,"Damage Done: ",k);utility.log(9,"Total Siege Damage: ",p);utility.log(9,"Time Used: ",j);utility.log(9,"Clicks Per Hour: ",m)}if(n>=g){t=n===g?e:b.siegeClicks[n];s=b.siegeDam[n]+t/m*h;if(l<=s||e===0){i+=l/h;break}i+=t/m;l-=s}}r=c/(100-c)*f;utility.log(2,"T2K based on siege: ",i.toFixed(2));utility.log(2,"T2K estimate without calculating siege impacts: ",r.toFixed(2));return i}catch(w){utility.error("ERROR in monster.t2kCalc: "+w);return 0}},characterClass:{Warrior:["Strengthen","Heal"],
Rogue:["Cripple"],Mage:["Deflect"],Cleric:["Heal"],Warlock:["Heal","Deflect"],Ranger:["Strengthen","Cripple"]},flagReview:function(){try{schedule.setItem("monsterReview",0);state.setItem("monsterReviewCounter",-3);return true}catch(b){utility.error("ERROR in monster.flagReview: "+b);return false}},flagFullReview:function(){try{this.clear();this.flagReview();schedule.setItem("NotargetFrombattle_monster",0);state.setItem("ReleaseControl",true);caap.UpdateDashboard(true);return true}catch(b){utility.error("ERROR in monster.flagFullReview: "+
b);return false}},select:function(b){try{if(!(b||utility.oneMinuteUpdate("selectMonster"))||caap.stats.level<7)return false;utility.log(1,"Selecting monster");state.setItem("targetFrombattle_monster","");state.setItem("targetFromfortify","");state.setItem("targetFromraid","");b={battle_monster:[],raid:[],any:[]};var a=0,c=0,d=[],e=0,g=0,f="",j="",i="",k="",l="",p="",o="",h={},m="",t="",s=0,n=0,r=[];for(a=0;a<this.records.length;a+=1){if(this.records[a].type==="")this.records[a].type=this.type(this.records[a].name);
if(this.info[this.records[a].type]&&this.info[this.records[a].type].alpha)if(this.records[a].damage!==-1&&this.records[a].color!=="grey"&&schedule.since(this.records[a].stunTime,0)){utility.log(1,"Review monster due to class timer",this.records[a].name);this.records[a].review=0;schedule.setItem("monsterReview",0);state.setItem("monsterReviewCounter",-3)}this.records[a].conditions="none";if(gm.getItem("SerializeRaidsAndMonsters",false,hiddenVar))b.any.push(this.records[a].name);else if(this.records[a].page===
"raid"||this.records[a].page==="battle_monster")b[this.records[a].page].push(this.records[a].name)}this.save();d=gm.getItem("SerializeRaidsAndMonsters",false,hiddenVar)?["any"]:["battle_monster","raid"];utility.log(3,"records/monsterList/selectTypes",this.records,b,d);for(c in d)if(d.hasOwnProperty(c))if(b[d[c]].length){p=l=k=i=j=f="";if(d[c]==="any"){r=utility.TextToArray(config.getItem("orderbattle_monster",""));$.merge(r,utility.TextToArray(config.getItem("orderraid","")).concat("your","'"))}else r=
utility.TextToArray(config.getItem("order"+d[c],"")).concat("your","'");utility.log(9,"attackOrderList",r);for(s in r)if(r.hasOwnProperty(s))if($.trim(r[s])){m=$.trim(r[s].replace(/^[^:]+/,"").toString());for(n in b[d[c]])if(b[d[c]].hasOwnProperty(n))if(b[d[c]][n]){e=0;h=this.getItem(b[d[c]][n]);if(h.conditions==="none")if(!(b[d[c]][n].toLowerCase().indexOf($.trim(r[s].match(/^[^:]+/).toString()).toLowerCase())<0||d[c]!=="any"&&h.page!==d[c])){h.conditions=m;this.setItem(h);if(h.color!=="grey"){utility.log(3,
"Current monster being checked",h);if(!j&&h.color!=="purple")if(h.over==="ach"){if(!f){f=b[d[c]][n];utility.log(3,"firstOverAch",f)}}else if(h.over!=="max"){j=b[d[c]][n];utility.log(3,"firstUnderMax",j)}if((t=this.type(b[d[c]][n]))&&this.info[t]){if(!this.info[t].alpha||this.info[t].alpha&&this.characterClass[h.charClass]&&this.characterClass[h.charClass].indexOf("Heal")>=0){e=this.parseCondition("f%",m)!==false?this.parseCondition("f%",m):config.getItem("MaxToFortify",0);if(this.info[t].fort&&!k&&
h.fortify<e)if(h.over==="ach"){if(!i){i=b[d[c]][n];utility.log(3,"firstFortOverAch",i)}}else if(h.over!=="max"){k=b[d[c]][n];utility.log(3,"firstFortUnderMax",k)}}if(this.info[t].alpha)if(!p&&h.stunDo)if(h.over==="ach"){if(!l){l=b[d[c]][n];utility.log(3,"firstStunOverAch",l)}}else if(h.over!=="max"){p=b[d[c]][n];utility.log(3,"firstStunUnderMax",p)}}}}}}if(d[c]!=="raid"){state.setItem("targetFromfortify",k)||state.setItem("targetFromfortify",i);utility.log(3,"fort under max ",k);utility.log(3,"fort over Ach ",
i);utility.log(3,"fort target ",state.getItem("targetFromfortify",""));state.setItem("targetFromStun",p)||state.setItem("targetFromStun",l);utility.log(3,"stun under max ",p);utility.log(3,"stun over Ach ",l);utility.log(3,"stun target ",state.getItem("targetFromStun",""));if(state.getItem("targetFromStun","")){state.setItem("targetFromfortify",state.getItem("targetFromStun",""));utility.log(1,"Stun target replaces fortify ",state.getItem("targetFromfortify",""))}}(o=j)||(o=f);utility.log(3,"monster",
o);if(o){h=this.getItem(o);state.setItem("targetFrom"+h.page,o);if(h.page==="battle_monster"){g=0;if(!caap.InLevelUpMode()&&this.info[h.type]&&this.info[h.type].staLvl)for(g=this.info[h.type].staLvl.length-1;g>=0;g-=1){utility.log(9,"stamina.max:nodeNum:staLvl",caap.stats.stamina.max,g,this.info[h.type].staLvl[g]);if(caap.stats.stamina.max>=this.info[h.type].staLvl[g])break}utility.log(8,"MonsterStaminaReq:Info",h.type,g,this.info[h.type]);if(!caap.InLevelUpMode()&&this.info[h.type]&&this.info[h.type].staMax&&
config.getItem("PowerAttack",false)&&config.getItem("PowerAttackMax",false)){utility.log(7,"MonsterStaminaReq:PowerAttackMax",this.info[h.type].staMax[g]);state.setItem("MonsterStaminaReq",this.info[h.type].staMax[g])}else if(this.info[h.type]&&this.info[h.type].staUse){utility.log(7,"MonsterStaminaReq:staUse",this.info[h.type].staUse);state.setItem("MonsterStaminaReq",this.info[h.type].staUse)}else if(caap.InLevelUpMode()&&caap.stats.stamina.num>=10||h.conditions.match(/:pa/i)){utility.log(7,"MonsterStaminaReq:pa",
5);state.setItem("MonsterStaminaReq",5)}else if(h.conditions.match(/:sa/i)){utility.log(7,"MonsterStaminaReq:sa",1);state.setItem("MonsterStaminaReq",1)}else if(caap.InLevelUpMode()&&caap.stats.stamina.num>=10||config.getItem("PowerAttack",true)){utility.log(7,"MonsterStaminaReq:PowerAttack",5);state.setItem("MonsterStaminaReq",5)}else{utility.log(7,"MonsterStaminaReq:default",1);state.setItem("MonsterStaminaReq",1)}utility.log(2,"MonsterStaminaReq:MonsterGeneral",config.getItem("MonsterGeneral",
"Use Current"));if(config.getItem("MonsterGeneral","Use Current")==="Orc King"){utility.log(2,"MonsterStaminaReq:Orc King",state.getItem("MonsterStaminaReq",1)*5);state.setItem("MonsterStaminaReq",state.getItem("MonsterStaminaReq",1)*5)}if(config.getItem("MonsterGeneral","Use Current")==="Barbarus"){utility.log(2,"MonsterStaminaReq:Barbarus",state.getItem("MonsterStaminaReq",1)*3);state.setItem("MonsterStaminaReq",state.getItem("MonsterStaminaReq",1)*3)}}else{utility.log(8,"RaidStaminaReq:Info",h.type,
this.info[h.type]);if(gm.getItem("RaidPowerAttack",false,hiddenVar)||h.conditions.match(/:pa/i)){utility.log(7,"RaidStaminaReq:pa",5);state.setItem("RaidStaminaReq",5)}else if(this.info[h.type]&&this.info[h.type].staUse){utility.log(7,"RaidStaminaReq:staUse",this.info[h.type].staUse);state.setItem("RaidStaminaReq",this.info[h.type].staUse)}else{utility.log(7,"RaidStaminaReq:default",1);state.setItem("RaidStaminaReq",1)}}}}caap.UpdateDashboard(true);return true}catch(w){utility.error("ERROR in monster.select: "+
w);return false}},ConfirmRightPage:function(b){try{var a=null,c=null,d="";if((a=$("div[style*='dragon_title_owner']"))&&a.length)d=$.trim(a.children(":eq(2)").text());else if((a=$("div[style*='nm_top']"))&&a.length){d=$.trim(a.children(":eq(0)").children(":eq(0)").text());if((c=$("div[style*='nm_bars']"))&&c.length)d+=" "+$.trim(c.children(":eq(0)").children(":eq(0)").children(":eq(0)").siblings(":last").children(":eq(0)").text()).replace("'s Life","");else{utility.warn("Problem finding nm_bars");
return false}}else{utility.warn("Problem finding dragon_title_owner and nm_top");return false}if(a.find("img[uid='"+caap.stats.FBID+"']").length){utility.log(2,"monster name found");d=d.replace(/.+'s /,"Your ")}if(b!==d){utility.log(1,"Looking for "+b+" but on "+d+". Going back to select screen");return utility.NavigateTo("keep,"+this.getItem(b).page)}return false}catch(e){utility.error("ERROR in monster.ConfirmRightPage: "+e);return false}}};
battle={records:[],record:function(){this.data={userId:0,nameStr:"",rankStr:"",rankNum:0,warRankStr:"",warRankNum:0,levelNum:0,armyNum:0,deityNum:0,deityStr:"",invadewinsNum:0,invadelossesNum:0,duelwinsNum:0,duellossesNum:0,warwinsNum:0,warlossesNum:0,defendwinsNum:0,defendlossesNum:0,statswinsNum:0,statslossesNum:0,goldNum:0,chainCount:0,invadeLostTime:(new Date(2009,0,1)).getTime(),duelLostTime:(new Date(2009,0,1)).getTime(),warLostTime:(new Date(2009,0,1)).getTime(),deadTime:(new Date(2009,0,1)).getTime(),
chainTime:(new Date(2009,0,1)).getTime(),ignoreTime:(new Date(2009,0,1)).getTime(),aliveTime:(new Date(2009,0,1)).getTime(),attackTime:(new Date(2009,0,1)).getTime(),selectTime:(new Date(2009,0,1)).getTime()}},battleRankTable:{0:"Acolyte",1:"Scout",2:"Soldier",3:"Elite Soldier",4:"Squire",5:"Knight",6:"First Knight",7:"Legionnaire",8:"Centurion",9:"Champion",10:"Lieutenant Commander",11:"Commander",12:"High Commander",13:"Lieutenant General",14:"General",15:"High General",16:"Baron",17:"Earl",18:"Duke",
19:"Prince",20:"King",21:"High King"},warRankTable:{0:"No Rank",1:"Reserve",2:"Footman",3:"Corporal",4:"Lieutenant",5:"Captain",6:"First Captain",7:"Blackguard",8:"Warguard",9:"Master Warguard",10:"Lieutenant Colonel",11:"Colonel",12:"First Colonel"},log:function(b,a){try{var c=[];if(utility.logLevel>=b){$.merge(c,this.records);utility.log(b,a,c)}return true}catch(d){utility.error("ERROR in battle.log: "+d);return false}},load:function(){try{this.records=gm.getItem("battle.records","default");if(this.records===
"default"){this.records=[];gm.setItem("battle.records",this.records)}state.setItem("BattleDashUpdate",true);this.log(2,"battle.load");return true}catch(b){utility.error("ERROR in battle.load: "+b);return false}},save:function(){try{gm.setItem("battle.records",this.records);state.setItem("BattleDashUpdate",true);this.log(2,"battle.save");return true}catch(b){utility.error("ERROR in battle.save: "+b);return false}},clear:function(){try{this.records=gm.setItem("battle.records",[]);state.setItem("BattleDashUpdate",
true);return true}catch(b){utility.error("ERROR in battle.clear: "+b);return false}},getItem:function(b){try{var a=0,c=false,d=null;if(!utility.isNum(b)||b<1){utility.warn("userId",b);throw"Invalid identifying userId!";}for(a=0;a<this.records.length;a+=1)if(this.records[a].userId===b){c=true;break}if(c){utility.log(2,"Got battle record",b,this.records[a]);return this.records[a]}else{d=new this.record;d.data.userId=b;utility.log(2,"New battle record",b,d.data);return d.data}}catch(e){utility.error("ERROR in battle.getItem: "+
e,arguments.callee.caller);return false}},setItem:function(b){try{if(!b||utility.typeOf(b)!=="object")throw"Not passed a record";if(!utility.isNum(b.userId)||b.userId<1){utility.warn("userId",b.userId);throw"Invalid identifying userId!";}var a=0,c=false;for(a=0;a<this.records.length;a+=1)if(this.records[a].userId===b.userId){c=true;break}if(c){this.records[a]=b;utility.log(2,"Updated battle record",b,this.records)}else{this.records.push(b);utility.log(2,"Added battle record",b,this.records)}this.save();
return true}catch(d){utility.error("ERROR in battle.setItem: "+d,b);return false}},deleteItem:function(b){try{var a=0,c=false;if(!utility.isNum(b)||b<1){utility.warn("userId",b);throw"Invalid identifying userId!";}for(a=0;a<this.records.length;a+=1)if(this.records[a].userId===b){c=true;break}if(c){this.records.splice(a,1);this.save();utility.log(2,"Deleted battle record",b,this.records);return true}else{utility.warn("Unable to delete battle record",b,this.records);return false}}catch(d){utility.error("ERROR in battle.deleteItem: "+
d);return false}},hashCheck:function(b){try{var a="",c=["f503b318ea6e780c03f39ed9fdc0dd47a688729c"];if(!c.length||!gm.getItem("AllowProtected",true,hiddenVar))return false;if(!utility.isNum(b)||b<1){utility.warn("userId",b);throw"Invalid identifying userId!";}a=utility.SHA1(b.toString());return c.indexOf(a)>=0}catch(d){utility.error("ERROR in battle.hashCheck: "+d);return false}},getResult:function(){try{var b=null,a=null,c="",d=[],e={},g="",f={userId:0,userName:"",battleType:"",points:0,gold:0,win:false};
if(utility.CheckForImage("battle_victory.gif")){g="war_win_left.jpg";f.win=true}else if(utility.CheckForImage("battle_defeat.gif"))g="war_lose_left.jpg";else throw"Unable to determine won or lost!";if(utility.CheckForImage("war_button_war_council.gif")){f.battleType="War";if((b=$("#app46755028429_results_main_wrapper div[class='result']"))&&b.length){if((a=b.find("img[src*='war_rank_small_icon']:first"))&&a.length)if(c=$.trim(a.parent().text()))f.points=/\d+\s+War Points/i.test(c)?utility.NumberOnly(c.match(/\d+\s+War Points/i)):
0;else utility.warn("Unable to find war points text in",a.parent());else utility.warn("Unable to find war_rank_small_icon in",b);if((a=b.find("b[class*='gold']:first"))&&a.length)if(c=$.trim(a.text()))f.gold=utility.NumberOnly(c);else utility.warn("Unable to find gold text in",a);else utility.warn("Unable to find gold element in",b);if((a=b.find("input[name='target_id']:first"))&&a.length)if(c=a.attr("value"))f.userId=parseInt(c,10);else{utility.warn("No value in",a);throw"Unable to get userId!";
}else{utility.warn("Unable to find target_id in",b);throw"Unable to get userId!";}if((a=$("div[style*='"+g+"']"))&&a.length)if(c=$.trim(a.text()))f.userName=c.replace("'s Defense","");else utility.warn("Unable to match user's name in",c);else utility.warn("Unable to find "+g)}else{utility.warn("Unable to find result div");throw"Unable to get userId!";}}else{if(utility.CheckForImage("battle_invade_again.gif"))f.battleType="Invade";else if(utility.CheckForImage("battle_duel_again.gif"))f.battleType=
"Duel";if(f.battleType)if((b=$("#app46755028429_results_main_wrapper div[class='result']"))&&b.length){if((a=b.find("img[src*='battle_rank_small_icon']:first"))&&a.length)if(c=$.trim(a.parent().text()))f.points=/\d+\s+Battle Points/i.test(c)?utility.NumberOnly(c.match(/\d+\s+Battle Points/i)):0;else utility.warn("Unable to find battle points text in",a.parent());else utility.warn("Unable to find battle_rank_small_icon in",b);if((a=b.find("b[class*='gold']:first"))&&a.length)if(c=$.trim(a.text()))f.gold=
utility.NumberOnly(c);else utility.warn("Unable to find gold text in",a);else utility.warn("Unable to find gold element in",b);if((a=b.find("a[href*='keep.php?casuser=']:first"))&&a.length)if(c=a.attr("href")){if((d=c.match(/user=(\d+)/i))&&d.length===2)f.userId=parseInt(d[1],10);else{utility.warn("Unable to match user's id in",c);throw"Unable to get userId!";}if(c=$.trim(a.text()))f.userName=c;else utility.warn("Unable to match user's name in",c)}else{utility.warn("No href text in",a);throw"Unable to get userId!";
}else{utility.warn("Unable to find keep.php?casuser= in",b);throw"Unable to get userId!";}}else{utility.warn("Unable to find result div");throw"Unable to get userId!";}else{utility.warn("Unable to determine battle type");throw"Unable to get userId!";}}e=this.getItem(f.userId);e.attackTime=(new Date).getTime();if(f.userName&&f.userName!==e.nameStr){utility.log(1,"Updating battle record user name, from/to",e.nameStr,f.userName);e.nameStr=f.userName}if(f.win)e.statswinsNum+=1;else e.statslossesNum+=
1;switch(f.battleType){case "Invade":if(f.win)e.invadewinsNum+=1;else{e.invadelossesNum+=1;e.invadeLostTime=(new Date).getTime()}break;case "Duel":if(f.win)e.duelwinsNum+=1;else{e.duellossesNum+=1;e.duelLostTime=(new Date).getTime()}break;case "War":if(f.win)e.warwinsNum+=1;else{e.warlossesNum+=1;e.warLostTime=(new Date).getTime()}break;default:utility.warn("Battle type unknown!",f.battleType)}this.setItem(e);return f}catch(j){utility.error("ERROR in battle.getResult: "+j);return false}},deadCheck:function(){try{var b=
null,a="",c={},d=false;if((b=$("div[class='results']"))&&b.length)if(a=$.trim(b.text())){if(a.match(/Your opponent is dead or too weak to battle/)){utility.log(1,"This opponent is dead or hiding: ",state.getItem("lastBattleID",0));if(state.getItem("lastBattleID",0)){c=battle.getItem(state.getItem("lastBattleID",0));c.deadTime=(new Date).getTime();battle.setItem(c)}d=true}}else{utility.warn("Unable to find results text in",b);throw"Unable to determine if user is dead!";}else throw"Unable to find any results!";
return d}catch(e){utility.error("ERROR in battle.deadCheck: "+e)}}};
town={soldiers:[],soldiersSortable:[],item:[],itemSortable:[],magic:[],magicSortable:[],record:function(){this.data={name:"",upkeep:0,hourly:0,atk:0,def:0,owned:0,cost:0,api:0,dpi:0,mpi:0}},types:["soldiers","item","magic"],log:function(b,a,c){try{if(typeof b!=="string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to load: ",b);throw"Invalid type value!";}var d={};if(utility.logLevel>=a){$.extend(d,this[b]);utility.log(a,c,b,d)}return true}catch(e){utility.error("ERROR in town.log: "+
e);return false}},load:function(b){try{if(typeof b!=="string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to load: ",b);throw"Invalid type value!";}this[b]=gm.getItem(b+".records","default");if(this[b]==="default"){this[b]=[];gm.setItem(b+".records",this[b])}this[b+"Sortable"]=[];$.merge(this[b+"Sortable"],this[b]);state.setItem(b.ucFirst()+"DashUpdate",true);this.log(b,2,"town.load");return true}catch(a){utility.error("ERROR in town.load: "+a);return false}},save:function(b){try{if(typeof b!==
"string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to load: ",b);throw"Invalid type value!";}gm.setItem(b+".records",this[b]);state.setItem(b.ucFirst()+"DashUpdate",true);this.log(b,2,"town.save");return true}catch(a){utility.error("ERROR in town.save: "+a);return false}},GetItems:function(b){try{var a=null,c=null,d={},e=true,g=false;if(typeof b!=="string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to load: ",b);throw"Invalid type value!";}this[b]=[];this[b+"Sortable"]=
[];(a=$("td[class*='eq_buy_row']"))&&a.length&&a.each(function(){d=new town.record;if((c=$(this).find("div[class='eq_buy_txt_int'] strong"))&&c.length===1)d.data.name=$.trim(c.text());else{utility.warn("Unable to get '"+b+"' name!");e=false}if(e){if((c=$(this).find("div[class='eq_buy_txt_int'] span[class='negative']"))&&c.length===1)d.data.upkeep=utility.NumberOnly(c.text());else utility.log(2,"No upkeep found for '"+b+"' '"+d.data.name+"'");if((c=$(this).find("div[class='eq_buy_stats_int'] div"))&&
c.length===2){d.data.atk=utility.NumberOnly(c.eq(0).text());d.data.def=utility.NumberOnly(c.eq(1).text());d.data.api=d.data.atk+d.data.def*0.7;d.data.dpi=d.data.def+d.data.atk*0.7;d.data.mpi=(d.data.api+d.data.dpi)/2}else utility.warn("No atk/def found for '"+b+"' '"+d.data.name+"'");if((c=$(this).find("div[class='eq_buy_costs_int'] strong[class='gold']"))&&c.length===1)d.data.cost=utility.NumberOnly(c.text());else utility.log(2,"No cost found for '"+b+"' '"+d.data.name+"'");if((c=$(this).find("div[class='eq_buy_costs_int'] tr:last td:first"))&&
c.length===1){d.data.owned=utility.NumberOnly(c.text());d.data.hourly=d.data.owned*d.data.upkeep}else utility.warn("No number owned found for '"+b+"' '"+d.data.name+"'");town[b].push(d.data);g=true}});if(g){$.merge(this[b+"Sortable"],this[b]);this.save(b)}else utility.log(1,"Nothing to save for '"+b+"'");return true}catch(f){utility.error("ERROR in town.GetItems: "+f);return false}}};
gifting={types:["gifts","queue","history"],log:function(b,a,c){try{if(typeof b!=="string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to load: ",b);throw"Invalid type value!";}var d={};if(utility.logLevel>=a){$.extend(d,this[b].records);utility.log(a,c,b,d)}return true}catch(e){utility.error("ERROR in gifting.log: "+e);return false}},load:function(b){try{if(typeof b!=="string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to load: ",b);throw"Invalid type value!";}this[b].records=
gm.getItem("gifting."+b,"default");if(this[b].records==="default"){this[b].records=[];gm.setItem("gifting."+b,this[b].records)}this.log(b,2,"gifting.load "+b);state.setItem("Gift"+b.ucFirst()+"DashUpdate",true);return true}catch(a){utility.error("ERROR in gifting.load: "+a);return false}},save:function(b){try{if(typeof b!=="string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to load: ",b);throw"Invalid type value!";}gm.setItem("gifting."+b,this[b].records);this.log(b,2,"gifting.save "+
b);state.setItem("Gift"+b.ucFirst()+"DashUpdate",true);return true}catch(a){utility.error("ERROR in gifting.save: "+a);return false}},clear:function(b){try{if(typeof b!=="string"||b===""||this.types.indexOf(b)<0){utility.warn("Type passed to clear: ",b);throw"Invalid type value!";}this[b].records=gm.setItem("gifting."+b,[]);state.setItem("Gift"+b.ucFirst()+"DashUpdate",true);return true}catch(a){utility.error("ERROR in gifting.clear: "+a);return false}},init:function(){try{var b=true;gifting.load("gifts")||
(b=false);gifting.load("queue")||(b=false);gifting.load("history")||(b=false);return b}catch(a){utility.error("ERROR in gifting.init: "+a)}},accept:function(){try{var b=null,a="",c=0,d={};if((b=$("div[class='messages']:first img:first"))&&b.length){c=parseInt(b.attr("uid"),10);if(c>0){d=(new this.queue.record).data;d.userId=c;if(a=$.trim(b.attr("title")))d.name=a;else{utility.warn("No name found in",b);d.name="Unknown"}}else utility.warn("No uid found in",b)}else utility.warn("No gift messages found!");
return!utility.isEmpty(gm.setItem("GiftEntry",d))}catch(e){utility.error("ERROR in gifting.accept: "+e)}},getCurrent:function(){try{return gm.getItem("GiftEntry",{})}catch(b){utility.error("ERROR in gifting.getCurrent: "+b)}},setCurrent:function(b){try{if(!b||utility.typeOf(b)!=="object")throw"Not passed a record";if(!utility.isNum(b.userId)||b.userId<1){utility.warn("userId",b.userId);throw"Invalid identifying userId!";}return gm.setItem("GiftEntry",b)}catch(a){utility.error("ERROR in gifting.setCurrent: "+
a)}},clearCurrent:function(){try{return gm.setItem("GiftEntry",{})}catch(b){utility.error("ERROR in gifting.clearCurrent: "+b)}},collecting:function(){try{!utility.isEmpty(this.getCurrent())&&this.getCurrent().checked&&this.collected(true);if(utility.isEmpty(this.getCurrent())&&state.getItem("HaveGift",false)){if(utility.NavigateTo("army","invite_on.gif"))return true;if(!this.accept()){state.setItem("HaveGift",false);return false}schedule.setItem("ClickedFacebookURL",30);state.setItem("clickUrl",
"http://apps.facebook.com/reqs.php#confirm_46755028429_0");utility.VisitUrl("http://apps.facebook.com/reqs.php#confirm_46755028429_0");return true}return null}catch(b){utility.error("ERROR in gifting.collecting: "+b);return false}},collect:function(){try{var b=false,a=null,c=null,d=[],e=0,g=null,f="",j=[],i="";if(window.location.href.indexOf("apps.facebook.com/reqs.php")<0)return false;b=this.getCurrent();if(utility.isEmpty(b))return false;if(!b.checked){utility.log(1,"On FB page with gift ready to go");
(a=$("div[id*='app_46755028429']"))&&a.length?a.each(function(){if((c=$(this).find("input[name*='/castle/tracker.php']"))&&c.length){d=c.attr("name").match(/uid%3D(\d+)/i);if(!d||d.length!==2)return true;e=utility.NumberOnly(d[1]);if(b.userId!==e)return true;g=$(this).find("div[class='pts requestBody']");f="";j=[];i="";if(g&&g.length){f=$.trim(g.text());if((j=g.text().match(/(.*) has sent you a (.*) in Castle Age!.*/))&&j.length===3)i=j[2]}else utility.warn("No requestBody in ",$(this));if(i===""||
gifting.gifts.list().indexOf(i)<0){utility.log(1,"Unknown gift type",i,gifting.gifts.list());i="Unknown Gift"}b.gift=i;b.found=true;b.checked=true;gifting.setCurrent(b);schedule.setItem("ClickedFacebookURL",30);utility.Click(c.get(0));return false}else utility.warn("No input found in ",$(this));return true}):utility.warn("No gifts found for CA");b.checked=true;this.setCurrent(b)}if(!schedule.check("ClickedFacebookURL"))return false;if(b.found)utility.log(1,"Gift click timed out");else{b.gift="Unknown Gift";
this.setCurrent(b);utility.log(1,"Unable to find gift",b)}state.setItem("clickUrl","http://apps.facebook.com/castle_age/army.php?act=acpt&uid="+b.userId);utility.VisitUrl("http://apps.facebook.com/castle_age/army.php?act=acpt&uid="+b.userId);return true}catch(k){utility.error("ERROR in gifting.collect: "+k);return false}},collected:function(b){try{var a=this.getCurrent();if(!utility.isEmpty(a)){if(b||utility.CheckForImage("gift_yes.gif")){gifting.queue.collectOnly()||this.queue.setItem(a);this.history.received(a)}this.clearCurrent()}schedule.setItem("NoGiftDelay",
0);return true}catch(c){utility.error("ERROR in gifting.collected: "+c);return false}},popCheck:function(){try{var b=null,a=null,c="",d=true;if((b=$("#pop_content"))&&b.length){if((a=b.find("input[name='sendit']"))&&a.length){utility.log(1,"Sending gifts to Facebook");utility.Click(a.get(0));return true}if((a=b.find("input[name='skip_ci_btn']"))&&a.length){utility.log(1,"Denying Email Nag For Gift Send");utility.Click(a.get(0));return true}if((a=b.find("input[name='ok']"))&&a.length){if(c=a.parent().parent().prev().text())if(/you have run out of requests/.test(c)){utility.log(1,
"Out of requests: ",c);schedule.setItem("MaxGiftsExceeded",10800,300);d=false}else utility.warn("Popup message: ",c);else utility.warn("Popup message but no text found",a);utility.Click(a.get(0));return d}if(c=b.text())if(/Loading/.test(c)){utility.log(1,"Popup is loading ...");return true}else{utility.warn("Unknown popup!",b.text());return false}else{utility.warn("Popup message but no text found",b);return false}}if(this.waitingForDomLoad)return true;return null}catch(e){utility.error("ERROR in gifting.popCheck: "+
e)}},gifts:{options:["Same Gift As Received","Random Gift","Collect Only"],records:[],record:function(){this.data={name:"",image:""}},getItem:function(b){try{var a=0,c=false;if(typeof b!=="string"||b===""){utility.warn("name",b);throw"Invalid identifying name!";}for(a=0;a<this.records.length;a+=1)if(this.records[a].name===b)break;if(a<this.records.length)c=this.records[a];return c}catch(d){utility.error("ERROR in gifting.gifts.getItem: "+d)}},getImg:function(b){try{var a=0,c="";if(typeof b!=="string"||
b===""){utility.warn("name",b);throw"Invalid identifying name!";}if(b!=="Unknown Gift"){for(a=0;a<this.records.length;a+=1)if(this.records[a].name===b){c=this.records[a].image;break}a>=this.records.length&&utility.warn("Gift not in list! ",b)}return c}catch(d){utility.error("ERROR in gifting.gifts.getImg: "+d)}},populate:function(){try{var b=null,a={},c=null,d="",e=[],g=false;if((b=$("#app46755028429_giftContainer div[id*='app46755028429_gift']"))&&b.length){gifting.clear("gifts");b.each(function(){a=
(new gifting.gifts.record).data;if((c=$(this).children(":first"))&&c.length)if(d=$.trim(c.text()).replace("!",""))a.name=d;else{utility.warn("Unable to get gift name! No text in ",c);return true}else{utility.warn("Unable to get gift name! No child!");return true}if((c=$(this).find("img[class*='imgButton']"))&&c.length)if(d=utility.getHTMLPredicate(c.attr("src")))a.image=d;else{utility.warn("Unable to get gift image! No src in ",c);return true}else{utility.warn("Unable to get gift image! No img!");
return true}if(gifting.gifts.getItem(a.name)){a.name+=" #2";utility.log(1,"Gift exists, no auto return for ",a.name)}gifting.gifts.records.push(a);return g=true})}if(g){e=this.list();d=config.getItem("GiftChoice",this.options[0]);if(e.indexOf(d)<0){utility.log(1,"Gift choice invalid, changing from/to ",d,this.options[0]);d=config.setItem("GiftChoice",this.options[0])}caap.ChangeDropDownList("GiftChoice",e,d);gifting.save("gifts")}return g}catch(f){utility.error("ERROR in gifting.gifts.populate: "+
f)}},list:function(){try{var b=0,a=[];for(b=0;b<this.records.length;b+=1)a.push(this.records[b].name);return $.merge($.merge([],this.options),a)}catch(c){utility.error("ERROR in gifting.gifts.list: "+c)}},length:function(){try{return this.records.length}catch(b){utility.error("ERROR in gifting.gifts.length: "+b)}},random:function(){try{return this.records[Math.floor(Math.random()*this.records.length)].name}catch(b){utility.error("ERROR in gifting.gifts.random: "+b)}}},queue:{records:[],record:function(){this.data=
{userId:0,name:"",gift:"",checked:false,found:false,chosen:false,sent:false,last:(new Date(2009,0,1)).getTime()}},fix:function(){try{var b=0,a=false;for(b=this.records.length-1;b>=0;b-=1)if(!utility.isNum(this.records[b].userId)||this.records[b].userId<1||this.records[b].sent===true){utility.warn("gifting.queue.fix - delete",this.records[b]);this.records.splice(b,1);a=true}a&&gifting.save("queue");return this.save}catch(c){utility.error("ERROR in gifting.queue.fix: "+c)}},setItem:function(b){try{if(!b||
utility.typeOf(b)!=="object")throw"Not passed a record";if(!utility.isNum(b.userId)||b.userId<1){utility.warn("userId",b.userId);throw"Invalid identifying userId!";}var a=0,c=false,d=false;if(config.getItem("UniqueGiftQueue",true))for(a=0;a<this.records.length;a+=1)if(this.records[a].userId===b.userId){if(this.records[a].name!==b.name){this.records[a].name=b.name;d=true;utility.log(1,"Updated users name",b,this.records)}c=true;break}if(!c){this.records.push(b);d=true;utility.log(1,"Added gift to queue",
b,this.records)}d&&gifting.save("queue");return true}catch(e){utility.error("ERROR in gifting.queue.setItem: "+e,b);return false}},deleteIndex:function(b){try{if(!utility.isNum(b)||b<0||b>=this.records.length)throw"Invalid index! ("+b+")";this.records.splice(b,1);gifting.save("queue");return true}catch(a){utility.error("ERROR in gifting.queue.deleteIndex: "+a,b);return false}},length:function(){try{return this.records.length}catch(b){utility.error("ERROR in gifting.queue.length: "+b)}},collectOnly:function(){try{return config.getItem("GiftChoice",
gifting.gifts.options[0])!==gifting.gifts.options[2]?false:true}catch(b){utility.error("ERROR in gifting.queue.collectOnly: "+b)}},randomImg:"",chooseGift:function(){try{var b=0,a="",c="";c=config.getItem("GiftChoice",gifting.gifts.options[0]);for(b=0;b<this.records.length;b+=1)if(schedule.since(this.records[b].last||0,43200))if(!this.records[b].sent){switch(c){case gifting.gifts.options[0]:a=this.records[b].gift;break;case gifting.gifts.options[1]:if(this.randomImg)a=this.randomImg;else this.randomImg=
a=gifting.gifts.random();break;default:a=c}break}a||schedule.setItem("NoGiftDelay",1800,300);return a}catch(d){utility.error("ERROR in gifting.queue.chooseGift: "+d)}},chooseFriend:function(b){try{var a=0,c="",d="",e=null,g=null,f=true,j=0,i=true;if(!utility.isNum(b)||b<1)throw"Invalid howmany! ("+b+")";if(config.getItem("GiftChoice",gifting.gifts.options[0])!==gifting.gifts.options[0])i=false;for(a=0;a<this.records.length;a+=1){this.records[a].chosen=false;if(!(j>=b))if(schedule.since(this.records[a].last||
0,3600))if(!this.records[a].sent){if(f){c=this.records[a].gift;f=false}if(this.records[a].gift===c||!i){if((e=$("div[class='unselected_list'] input[value='"+this.records[a].userId+"']"))&&e.length)if(/none/.test(e.parent().attr("style")))d="Unselected id is none:";else{utility.Click(e.get(0));if((g=$("div[class='selected_list'] input[value='"+this.records[a].userId+"']").parent())&&g.length)if(/none/.test(g.attr("style")))d="Selected id is none:";else{utility.log(1,"User Chosen: ",this.records[a].userId,
this.records[a]);this.records[a].chosen=true;j+=1;continue}else d="Selected id not found:"}else d="Id not found, perhaps gift pending:";utility.log(1,d,this.records[a].userId,this.records[a]);this.records[a].last=(new Date).getTime()}}}caap.waitingForDomLoad=false;gifting.save("queue");return j}catch(k){utility.error("ERROR in gifting.queue.chooseFriend: "+k)}},sent:function(){try{var b=0,a=null,c="",d=false;if(window.location.href.indexOf("act=create")>=0){if((a=$("#app46755028429_results_main_wrapper"))&&
a.length)if(c=a.text())if(/You have sent \d+ gift/.test(c)){for(b=this.records.length-1;b>=0;b-=1)if(this.records[b].chosen){this.records[b].sent=true;gifting.history.sent(this.records[b]);this.records.splice(b,1)}utility.log(1,"Confirmed gifts sent out.");d=true}else if(/You have exceed the max gift limit for the day/.test(c)){utility.log(1,"Exceeded daily gift limit.");schedule.setItem("MaxGiftsExceeded",10800,300)}else utility.log(1,"Result message",c);else utility.log(1,"No result message")}else utility.log(1,
"Not a gift create request");return d}catch(e){utility.error("ERROR in gifting.queue.sent: "+e)}}},history:{records:[],record:function(){this.data={userId:0,name:"",sent:0,received:0}},received:function(b){try{if(!b||utility.typeOf(b)!=="object")throw"Not passed a record";if(!utility.isNum(b.userId)||b.userId<1){utility.warn("userId",b.userId);throw"Invalid identifying userId!";}var a=0,c=false,d={};for(a=0;a<this.records.length;a+=1)if(this.records[a].userId===b.userId){if(this.records[a].name!==
b.name)this.records[a].name=b.name;this.records[a].received+=1;c=true;break}if(c)utility.log(1,"Updated gifting.history record",this.records[a],this.records);else{d=(new this.record).data;d.userId=b.userId;d.name=b.name;d.received=1;this.records.push(d);utility.log(1,"Added gifting.history record",d,this.records)}gifting.save("history");return true}catch(e){utility.error("ERROR in gifting.history.received: "+e,b);return false}},sent:function(b){try{if(!b||utility.typeOf(b)!=="object")throw"Not passed a record";
if(!utility.isNum(b.userId)||b.userId<1){utility.warn("userId",b.userId);throw"Invalid identifying userId!";}var a=0,c=false,d={};for(a=0;a<this.records.length;a+=1)if(this.records[a].userId===b.userId){if(this.records[a].name!==b.name)this.records[a].name=b.name;this.records[a].sent+=1;c=true;break}if(c)utility.log(1,"Updated gifting.history record",this.records[a],this.records);else{d=(new this.record).data;d.userId=b.userId;d.name=b.name;d.sent=1;this.records.push(d);utility.log(1,"Added gifting.history record",
d,this.records)}gifting.save("history");return true}catch(e){utility.error("ERROR in gifting.history.sent: "+e,b);return false}},length:function(){try{return this.records.length}catch(b){utility.error("ERROR in gifting.history.length: "+b)}}}};
caap={lastReload:new Date,waitingForDomLoad:false,pageLoadOK:false,caapDivObject:null,caapTopObject:null,documentTitle:document.title,newVersionAvailable:false,releaseUpdate:function(){try{if(state.getItem("SUC_remote_version",0)>caapVersion)this.newVersionAvailable=true;var b=function(c){if(c||schedule.check("SUC_last_update"))try{GM_xmlhttpRequest({method:"GET",url:"http://castle-age-auto-player.googlecode.com/files/Castle-Age-Autoplayer.user.js",headers:{"Cache-Control":"no-cache"},onload:function(e){var g=
e.responseText.match(/@version\s*(.*?)\s*$/m)[1];e=e.responseText.match(/@name\s*(.*?)\s*$/m)[1];schedule.setItem("SUC_last_update",864E5);state.setItem("SUC_target_script_name",e);state.setItem("SUC_remote_version",g);utility.log(1,"remote version ",g);if(g>caapVersion){caap.newVersionAvailable=true;c&&confirm('There is an update available for the Greasemonkey script "'+e+'."\nWould you like to go to the install page now?')&&GM_openInTab("http://senses.ws/caap/index.php?topic=771.msg3582#msg3582")}else c&&
alert('No update is available for "'+e+'."')}})}catch(d){c&&alert("An error occurred while checking for updates:\n"+d)}};GM_registerMenuCommand(state.getItem("SUC_target_script_name","???")+" - Manual Update Check",function(){b(true)});b(false)}catch(a){utility.error("ERROR in release updater: "+a)}},devUpdate:function(){try{if(state.getItem("SUC_remote_version",0)>caapVersion||state.getItem("SUC_remote_version",0)>=caapVersion&&state.getItem("DEV_remote_version",0)>devVersion)this.newVersionAvailable=
true;var b=function(c){if(c||schedule.check("SUC_last_update"))try{GM_xmlhttpRequest({method:"GET",url:"http://castle-age-auto-player.googlecode.com/svn/trunk/Castle-Age-Autoplayer.user.js",headers:{"Cache-Control":"no-cache"},onload:function(e){var g=e.responseText.match(/@version\s*(.*?)\s*$/m)[1],f=e.responseText.match(/@dev\s*(.*?)\s*$/m)[1];e=e.responseText.match(/@name\s*(.*?)\s*$/m)[1];schedule.setItem("SUC_last_update",864E5);state.setItem("SUC_target_script_name",e);state.setItem("SUC_remote_version",
g);state.setItem("DEV_remote_version",f);utility.log(1,"remote version ",g,f);if(g>caapVersion||g>=caapVersion&&f>devVersion){caap.newVersionAvailable=true;c&&confirm('There is an update available for the Greasemonkey script "'+e+'."\nWould you like to go to the install page now?')&&GM_openInTab("http://code.google.com/p/castle-age-auto-player/updates/list")}else c&&alert('No update is available for "'+e+'."')}})}catch(d){c&&alert("An error occurred while checking for updates:\n"+d)}};GM_registerMenuCommand(state.getItem("SUC_target_script_name",
"???")+" - Manual Update Check",function(){b(true)});b(false)}catch(a){utility.error("ERROR in development updater: "+a)}},init:function(){try{state.setItem(this.friendListType.gifta.name+"Requested",false);state.setItem(this.friendListType.giftc.name+"Requested",false);state.setItem(this.friendListType.facebook.name+"Requested",false);config.getItem("HideAds",false)&&$(".UIStandardFrame_SidebarAds").css("display","none");config.getItem("HideAdsIframe",false)&&$("iframe[name*='fb_iframe']:first").parent().css("display",
"none");config.getItem("HideFBChat",false)&&window.setTimeout(function(){$("div[class*='fbDockWrapper fbDockWrapperBottom fbDockWrapperRight']").css("display","none")},100);var b=gm.getItem("ShiftDown","",hiddenVar);b&&$(this.controlXY.selector).css("padding-top",b);general.load();monster.load();battle.load();this.LoadDemi();this.LoadRecon();town.load("soldiers");town.load("item");town.load("magic");this.AddControl();this.AddColorWheels();this.AddDashboard();this.AddListeners();this.AddDBListener();
this.CheckResults();this.AutoStatCheck();return true}catch(a){utility.error("ERROR in init: "+a);return false}},defaultDropDownOption:"<option disabled='disabled' value='not selected'>Choose one</option>",MakeDropDown:function(b,a,c,d,e){try{var g=config.getItem(b,"defaultValue"),f=0,j=0,i="",k=0;if(g==="defaultValue")g=e?config.setItem(b,e):config.setItem(b,a[0]);for(j in a)if(a.hasOwnProperty(j)){if(g===a[j])break;f+=1}i="<select id='caap_"+b+"' "+(c[f]?" title='"+c[f]+"' ":"")+d+">";i+=this.defaultDropDownOption;
for(k in a)if(a.hasOwnProperty(k))i+=c?"<option value='"+a[k]+"'"+(g===a[k]?" selected='selected'":"")+(c[k]?" title='"+c[k]+"'":"")+">"+a[k]+"</option>":"<option value='"+a[k]+"'"+(g===a[k]?" selected='selected'":"")+">"+a[k]+"</option>";i+="</select>";return i}catch(l){utility.error("ERROR in MakeDropDown: "+l);return""}},DBDropDown:function(b,a,c,d){try{var e=config.getItem(b,"defaultValue"),g="",f=0;if(e==="defaultValue")e=config.setItem(b,a[0]);g=" <select id='caap_"+b+"' "+d+"'><option>"+e;
for(f in a)if(a.hasOwnProperty(f))if(e!==a[f])g+=c?"<option value='"+a[f]+"' "+(c[f]?" title='"+c[f]+"'":"")+">"+a[f]:"<option value='"+a[f]+"'>"+a[f];g+="</select>";return g}catch(j){utility.error("ERROR in DBDropDown: "+j);return""}},MakeCheckBox:function(b,a,c,d,e){try{var g="";config.getItem(b,"defaultValue")==="defaultValue"&&config.setItem(b,a);g="<input type='checkbox' id='caap_"+b+"' title=\""+d+'"'+(c?" class='"+c+"'":"")+(config.getItem(b)?"checked":"")+" />";if(c){g+=e?"</td></tr></table>":
"<br />";g+=this.AddCollapsingDiv(b,c)}return g}catch(f){utility.error("ERROR in MakeCheckBox: "+f);return""}},MakeNumberForm:function(b,a,c,d,e){try{e||(e="number");e==="number"&&isNaN(c)&&c!==""&&utility.warn("MakeNumberForm - default value is not a number!",b,c);c||(c="");config.getItem(b,"defaultValue")==="defaultValue"&&config.setItem(b,c);d||(d="size='4'");return" <input type='text' data-subtype='"+e+"' id='caap_"+b+"' "+d+' title="'+a+"\" value='"+config.getItem(b)+"' />"}catch(g){utility.error("ERROR in MakeNumberForm: "+
g);return""}},MakeCheckTR:function(b,a,c,d,e,g){try{var f="<tr><td style='width: 90%'>"+b+"</td><td style='width: 10%; text-align: right'>"+this.MakeCheckBox(a,c,d,e,g);g||(f+="</td></tr>");return f}catch(j){utility.error("ERROR in MakeCheckTR: "+j);return""}},AddCollapsingDiv:function(b,a){try{return"<div id='caap_"+a+"' style='display: "+(config.getItem(b,false)?"block":"none")+"'>"}catch(c){utility.error("ERROR in AddCollapsingDiv: "+c);return""}},ToggleControl:function(b,a){try{var c=state.getItem("Control_"+
b,"none"),d="-",e="";if(c==="none")d="+";return e='<a style="font-weight: bold;" id="caap_Switch_'+b+'" href="javascript:;" style="text-decoration: none;"> '+d+" "+a+"</a><br /><div id='caap_"+b+"' style='display: "+c+"'>"}catch(g){utility.error("ERROR in ToggleControl: "+g);return""}},MakeTextBox:function(b,a,c,d){try{c||(c="");config.getItem(b,"defaultValue")==="defaultValue"&&config.setItem(b,c);if(d==="")d=utility.is_chrome?" rows='3' cols='25'":" rows='3' cols='21'";return'<textarea title="'+
a+"\" type='text' id='caap_"+b+"' "+d+">"+config.getItem(b)+"</textarea>"}catch(e){utility.error("ERROR in MakeTextBox: "+e);return""}},SaveBoxText:function(b){try{var a=$("#caap_"+b).val();if(typeof a!=="string")throw"Value of the textarea id='caap_"+b+"' is not a string: "+a;config.setItem(b,a);return true}catch(c){utility.error("ERROR in SaveBoxText: "+c);return false}},SetDivContent:function(b,a){try{if(config.getItem("SetTitle",false)&&config.getItem("SetTitleAction",false)&&b==="activity_mess"){var c=
a.replace("Activity: ","")+" - ";if(config.getItem("SetTitleName",false))c+=this.stats.PlayerName+" - ";document.title=c+this.documentTitle}$("#caap_"+b).html(a)}catch(d){utility.error("ERROR in SetDivContent: "+d)}},questWhenList:["Energy Available","At Max Energy","At X Energy","Not Fortifying","Never"],questWhenInst:["Energy Available - will quest whenever you have enough energy.","At Max Energy - will quest when energy is at max and will burn down all energy when able to level up.","At X Energy - allows you to set maximum and minimum energy values to start and stop questing. Will burn down all energy when able to level up.",
"Not Fortifying - will quest only when your fortify settings are matched.","Never - disables questing."],questAreaList:["Quest","Demi Quests","Atlantis"],landQuestList:["Land of Fire","Land of Earth","Land of Mist","Land of Water","Demon Realm","Undead Realm","Underworld","Kingdom of Heaven","Ivory City","Earth II"],demiQuestList:["Ambrosia","Malekus","Corvintheus","Aurora","Azeron"],atlantisQuestList:["Atlantis"],questForList:["Advancement","Max Influence","Max Gold","Max Experience","Manual"],SelectDropOption:function(b,
a){try{$("#caap_"+b+" option").removeAttr("selected");$("#caap_"+b+" option[value='"+a+"']").attr("selected","selected");return true}catch(c){utility.error("ERROR in SelectDropOption: "+c);return false}},autoQuest:function(){this.data={name:"",energy:0,general:"none",expRatio:0}},newAutoQuest:function(){return(new this.autoQuest).data},updateAutoQuest:function(b,a){try{var c=state.getItem("AutoQuest",this.newAutoQuest());if(typeof b!=="string"||b==="")throw"No valid id supplied!";if(a===undefined||
a===null)throw"No value supplied!";c[b]=a;state.setItem("AutoQuest",c);return true}catch(d){utility.error("ERROR in updateAutoQuest: "+d);return false}},ShowAutoQuest:function(){try{$("#stopAutoQuest").text("Stop auto quest: "+state.getItem("AutoQuest",this.newAutoQuest()).name+" (energy: "+state.getItem("AutoQuest",this.newAutoQuest()).energy+")");$("#stopAutoQuest").css("display","block");return true}catch(b){utility.error("ERROR in ShowAutoQuest: "+b);return false}},ClearAutoQuest:function(){try{$("#stopAutoQuest").text("");
$("#stopAutoQuest").css("display","none");return true}catch(b){utility.error("ERROR in ClearAutoQuest: "+b);return false}},ManualAutoQuest:function(b){try{b||(b=this.newAutoQuest());state.setItem("AutoQuest",b);config.setItem("WhyQuest","Manual");this.SelectDropOption("WhyQuest","Manual");this.ClearAutoQuest();utility.log(5,"ManualAutoQuest",state.getItem("AutoQuest"));return true}catch(a){utility.error("ERROR in ManualAutoQuest: "+a);return false}},ChangeDropDownList:function(b,a,c){try{$("#caap_"+
b+" option").remove();$("#caap_"+b).append(this.defaultDropDownOption);for(var d in a)if(a.hasOwnProperty(d)){if(d==="0"&&!c){config.setItem(b,a[d]);utility.log(1,"Saved: "+b+"  Value: "+a[d])}$("#caap_"+b).append("<option value='"+a[d]+"'>"+a[d]+"</option>")}c?$("#caap_"+b+" option[value='"+c+"']").attr("selected","selected"):$("#caap_"+b+" option:eq(1)").attr("selected","selected");return true}catch(e){utility.error("ERROR in ChangeDropDownList: "+e);return false}},divList:["banner","activity_mess",
"idle_mess","quest_mess","battle_mess","monster_mess","fortify_mess","heal_mess","demipoint_mess","demibless_mess","level_mess","exp_mess","debug1_mess","debug2_mess","control"],controlXY:{selector:".UIStandardFrame_Content",x:0,y:0},GetControlXY:function(b){try{var a=0,c=0;a=b?$(this.controlXY.selector).offset().top:this.controlXY.y;c=this.controlXY.x===""||b?$(this.controlXY.selector).offset().left+$(this.controlXY.selector).width()+10:$(this.controlXY.selector).offset().left+this.controlXY.x;return{x:c,
y:a}}catch(d){utility.error("ERROR in GetControlXY: "+d);return{x:0,y:0}}},SaveControlXY:function(){try{var b=$(this.controlXY.selector).offset();state.setItem("caap_div_menuTop",caap.caapDivObject.offset().top);state.setItem("caap_div_menuLeft",caap.caapDivObject.offset().left-b.left);state.setItem("caap_top_zIndex","1");state.setItem("caap_div_zIndex","2")}catch(a){utility.error("ERROR in SaveControlXY: "+a)}},dashboardXY:{selector:"#app46755028429_app_body_container",x:0,y:0},GetDashboardXY:function(b){try{var a=
0,c=0;a=b?$(this.dashboardXY.selector).offset().top-10:this.dashboardXY.y;c=this.dashboardXY.x===""||b?$(this.dashboardXY.selector).offset().left:$(this.dashboardXY.selector).offset().left+this.dashboardXY.x;return{x:c,y:a}}catch(d){utility.error("ERROR in GetDashboardXY: "+d);return{x:0,y:0}}},SaveDashboardXY:function(){try{var b=$(this.dashboardXY.selector).offset();state.setItem("caap_top_menuTop",this.caapTopObject.offset().top);state.setItem("caap_top_menuLeft",this.caapTopObject.offset().left-
b.left);state.setItem("caap_div_zIndex","1");state.setItem("caap_top_zIndex","2")}catch(a){utility.error("ERROR in SaveDashboardXY: "+a)}},AddControl:function(){try{var b="<div id='caap_div'>",a=0,c={x:0,y:0},d="",e="";for(a in this.divList)if(this.divList.hasOwnProperty(a))b+="<div id='caap_"+this.divList[a]+"'></div>";b+="</div>";this.controlXY.x=state.getItem("caap_div_menuLeft","");this.controlXY.y=state.getItem("caap_div_menuTop",$(this.controlXY.selector).offset().top);c=this.GetControlXY();
$(b).css({width:"180px",background:config.getItem("StyleBackgroundLight","#E0C691"),opacity:config.getItem("StyleOpacityLight",1),color:"#000",padding:"4px",border:"2px solid #444",top:c.y+"px",left:c.x+"px",zIndex:state.getItem("caap_div_zIndex","2"),position:"absolute","-moz-border-radius":"5px","-webkit-border-radius":"5px"}).appendTo(document.body);this.caapDivObject=$("#caap_div");e+="<div id='caap_BannerHide' style='display: "+(config.getItem("BannerDisplay",true)?"block":"none")+"'>";e+="<img src='data:image/png;base64,"+
image64.header+"' alt='Castle Age Auto Player' /><br /><hr /></div>";this.SetDivContent("banner",e);d+=this.AddPauseMenu();d+=this.AddDisableMenu();d+=this.AddCashHealthMenu();d+=this.AddQuestMenu();d+=this.AddBattleMenu();d+=this.AddMonsterMenu();d+=this.AddReconMenu();d+=this.AddGeneralsMenu();d+=this.AddSkillPointsMenu();d+=this.AddEliteGuardOptionsMenu();d+=this.AddGiftingOptionsMenu();d+=this.AddAutoOptionsMenu();d+=this.AddOtherOptionsMenu();d+=this.AddFooterMenu();this.SetDivContent("control",
d);this.CheckLastAction(state.getItem("LastAction","none"));$("#caap_resetElite").button();$("#caap_StartedColourSelect").button();$("#caap_StopedColourSelect").button();$("#caap_FillArmy").button();$("#caap_ResetMenuLocation").button();return true}catch(g){utility.error("ERROR in AddControl: "+g);return false}},AddPauseMenu:function(){try{return"<div id='caapPaused' style='font-weight: bold; display: "+state.getItem("caapPause","block")+"'>Paused on mouse click.<br /><a href='javascript:;' id='caapRestart' >Click here to restart</a></div><hr />"}catch(b){utility.error("ERROR in AddPauseMenu: "+
b);return"<div id='caapPaused' style='font-weight: bold; display: block'>Paused on mouse click.<br /><a href='javascript:;' id='caapRestart' >Click here to restart</a></div><hr />"}},AddDisableMenu:function(){try{var b="";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Disable Autoplayer","Disabled",false,"","Disable auto running of CAAP. Stays persistent even on page reload and the autoplayer will not autoplay.")+"</table><hr />";return b}catch(a){utility.error("ERROR in AddDisableMenu: "+
a);return""}},AddCashHealthMenu:function(){try{var b="";b+=this.ToggleControl("CashandHealth","CASH and HEALTH");b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Bank Immediately","BankImmed",false,"","Bank as soon as possible. May interrupt player and monster battles.");b+=this.MakeCheckTR("Auto Buy Lands","autoBuyLand",false,"","Automatically buy lands in groups of 10 based on best Return On Investment value.");b+=this.MakeCheckTR("Auto Sell Excess Lands","SellLands",
false,"","Automatically sell off any excess lands above your level allowance.")+"</table>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td>Keep In Bank</td><td style='text-align: right'>$"+this.MakeNumberForm("minInStore","Minimum cash to keep in the bank. Press tab to save",1E5,"size='12' style='font-size: 10px; text-align: right'")+"</td></tr></table>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td>Bank Above</td><td style='text-align: right'>$"+
this.MakeNumberForm("MaxInCash","Maximum cash to have on hand, bank anything above this, press tab to save (leave blank to disable).","","size='7' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>But Keep On Hand</td><td style='text-align: right'>$"+this.MakeNumberForm("MinInCash","Minimum cash to have on hand, press tab to save","","size='7' style='font-size: 10px; text-align: right'")+"</td></tr></table>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";
b+="<tr><td>Heal If Health Below</td><td style='text-align: right'>"+this.MakeNumberForm("MinToHeal","Minimum health to have before healing, press tab to save (leave blank to disable).","","size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>But Not If Stamina Below</td><td style='text-align: right'>"+this.MakeNumberForm("MinStamToHeal","Minimum Stamina to have before healing, press tab to save (leave blank to disable).","","size='2' style='font-size: 10px; text-align: right'")+
"</td></tr></table>";b+="<hr/></div>";return b}catch(a){utility.error("ERROR in AddCashHealthMenu: "+a);return""}},AddQuestMenu:function(){try{var b=state.getItem("AutoQuest",this.newAutoQuest()).name,a="";a+=this.ToggleControl("Quests","QUEST");a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+="<tr><td width=80>Quest When</td><td style='text-align: right; width: 60%'>"+this.MakeDropDown("WhenQuest",this.questWhenList,this.questWhenInst,"style='font-size: 10px; width: 100%'","Never")+
"</td></tr></table>";a+="<div id='caap_WhenQuestHide' style='display: "+(config.getItem("WhenQuest","Never")!=="Never"?"block":"none")+"'>";a+="<div id='caap_WhenQuestXEnergy' style='display: "+(config.getItem("WhenQuest","Never")!=="At X Energy"?"none":"block")+"'>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+="<tr><td>Start At Or Above Energy</td><td style='text-align: right'>"+this.MakeNumberForm("XQuestEnergy","Start questing when energy is at or above this value.",1,"size='3' style='font-size: 10px; text-align: right'")+
"</td></tr>";a+="<tr><td style='padding-left: 10px'>Stop At Or Below Energy</td><td style='text-align: right'>"+this.MakeNumberForm("XMinQuestEnergy","Stop quest when energy is at or below this value.",0,"size='3' style='font-size: 10px; text-align: right'")+"</td></tr></table>";a+="</div>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+="<tr><td>Quest Area</td><td style='text-align: right; width: 60%'>"+this.MakeDropDown("QuestArea",this.questAreaList,"","style='font-size: 10px; width: 100%'")+
"</td></tr>";switch(config.getItem("QuestArea",this.questAreaList[0])){case "Quest":a+="<tr id='trQuestSubArea' style='display: table-row'><td>Sub Area</td><td style='text-align: right; width: 60%'>"+this.MakeDropDown("QuestSubArea",this.landQuestList,"","style='font-size: 10px; width: 100%'")+"</td></tr>";break;case "Demi Quests":a+="<tr id='trQuestSubArea' style='display: table-row'><td>Sub Area</td><td style='text-align: right; width: 60%'>"+this.MakeDropDown("QuestSubArea",this.demiQuestList,
"","style='font-size: 10px; width: 100%'")+"</td></tr>";break;default:a+="<tr id='trQuestSubArea' style='display: table-row'><td>Sub Area</td><td style='text-align: right; width: 60%'>"+this.MakeDropDown("QuestSubArea",this.atlantisQuestList,"","style='font-size: 10px; width: 100%'")+"</td></tr>";break}a+="<tr><td>Quest For</td><td style='text-align: right; width: 60%'>"+this.MakeDropDown("WhyQuest",this.questForList,"","style='font-size: 10px; width: 100%'")+"</td></tr></table>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";
a+=this.MakeCheckTR("Switch Quest Area","switchQuestArea",true,"","Allows switching quest area after Advancement or Max Influence");a+=this.MakeCheckTR("Use Only Subquest General","ForceSubGeneral",false,"","Always do a quest with the Subquest General you selected under the Generals section. NOTE: This will keep the script from automatically switching to the required general for experience of primary quests.");a+=this.MakeCheckTR("Quest For Orbs","GetOrbs",false,"","Perform the Boss quest in the selected land for orbs you do not have.")+
"</table>";a+="</div>";a+=b?"<a id='stopAutoQuest' style='display: block' href='javascript:;'>Stop auto quest: "+b+" (energy: "+state.getItem("AutoQuest",this.newAutoQuest()).energy+")</a>":"<a id='stopAutoQuest' style='display: none' href='javascript:;'></a>";a+="<hr/></div>";return a}catch(c){utility.error("ERROR in AddQuestMenu: "+c);return""}},AddBattleMenu:function(){try{var b="";b+=this.ToggleControl("Battling","BATTLE");b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td>Battle When</td><td style='text-align: right; width: 65%'>"+
this.MakeDropDown("WhenBattle",["Stamina Available","At Max Stamina","At X Stamina","No Monster","Stay Hidden","Demi Points Only","Never"],["Stamina Available will battle whenever you have enough stamina","At Max Stamina will battle when stamina is at max and will burn down all stamina when able to level up","At X Stamina you can set maximum and minimum stamina to battle","No Monster will battle only when there are no active monster battles or if Get Demi Points First has been selected.",'Stay Hidden uses stamina to try to keep you under 10 health so you cannot be attacked, while also attempting to maximize your stamina use for Monster attacks. YOU MUST SET MONSTER TO "STAY HIDDEN" TO USE THIS FEATURE.',
"Demi Points Only will battle only when Daily Demi Points are required, can use in conjunction with Get Demi Points First.","Never - disables player battles"],"style='font-size: 10px; width: 100%'","Never")+"</td></tr></table>";b+="<div id='caap_WhenBattleStayHidden1' style='color: red; font-weight: bold; display: "+(config.getItem("WhenBattle","Never")==="Stay Hidden"&&config.getItem("WhenMonster","Never")!=="Stay Hidden"?"block":"none")+"'>Warning: Monster Not Set To 'Stay Hidden'";b+="</div>";
b+="<div id='caap_WhenBattleXStamina' style='display: "+(config.getItem("WhenBattle","Never")!=="At X Stamina"?"none":"block")+"'>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td>Start Battles When Stamina</td><td style='text-align: right'>"+this.MakeNumberForm("XBattleStamina","Start battling if stamina is above this points",1,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>Keep This Stamina</td><td style='text-align: right'>"+
this.MakeNumberForm("XMinBattleStamina","Don't battle if stamina is below this points",0,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr></table>";b+="</div>";b+="<div id='caap_WhenBattleHide' style='display: "+(config.getItem("WhenBattle","Never")!=="Never"?"block":"none")+"'>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td>Battle Type</td><td style='text-align: right; width: 40%'>"+this.MakeDropDown("BattleType",["Invade","Duel","War"],["Battle using Invade button",
"Battle using Duel button - no guarentee you will win though","War using Duel button - no guarentee you will win though"],"style='font-size: 10px; width: 100%'")+"</td></tr></table>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Wait For Safe Health","waitSafeHealth",false,"","Wait until health is 12 instead of 10, prevents you killing yourself but leaves you unhidden for upto 10 minutes");b+=this.MakeCheckTR("Siege Weapon Assist Raids","raidDoSiege",true,"",
"(EXPERIMENTAL) Turns on or off automatic siege assist for all raids only.");b+=this.MakeCheckTR("Collect Raid Rewards","raidCollectReward",false,"","(EXPERIMENTAL) Automatically collect raid rewards.");b+=this.MakeCheckTR("Clear Complete Raids","clearCompleteRaids",false,"","");b+=this.MakeCheckTR("Ignore Battle Losses","IgnoreBattleLoss",false,"","Ignore battle losses and attack regardless.  This will also delete all battle loss records.");b+="<tr><td>Chain:Battle Points Won</td><td style='text-align: right'>"+
this.MakeNumberForm("ChainBP","Number of battle points won to initiate a chain attack. Specify 0 to always chain attack.","","size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td>Chain:Gold Won</td><td style='text-align: right'>"+this.MakeNumberForm("ChainGold","Amount of gold won to initiate a chain attack. Specify 0 to always chain attack.","","size='5' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td>Max Chains</td><td style='text-align: right'>"+
this.MakeNumberForm("MaxChains","Maximum number of chain hits after the initial attack.",4,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr></table>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td>Target Type</td><td style='text-align: right; width: 50%'>"+this.MakeDropDown("TargetType",["Freshmeat","Userid List","Raid"],["Use settings to select a target from the Battle Page","Select target from the supplied list of userids","Raid Battles"],"style='font-size: 10px; width: 100%'")+
"</td></tr></table>";b+="<div id='caap_FreshmeatSub' style='display: "+(config.getItem("TargetType","Never")!=="Userid List"?"block":"none")+"'>";b+="Attack targets that are:";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td style='padding-left: 10px'>Not Lower Than Rank Minus</td><td style='text-align: right'>"+this.MakeNumberForm("FreshMeatMinRank","The lowest relative rank below yours that you are willing to spend your stamina on. Leave blank to attack any rank.","","size='2' style='font-size: 10px; text-align: right'")+
"</td></tr>";b+="<tr><td style='padding-left: 10px'>Not Higher Than X*Army</td><td style='text-align: right'>"+this.MakeNumberForm("FreshMeatARBase","This value sets the base for your army ratio calculation. It is basically a multiplier for the army size of a player at your equal level. A value of 1 means you will battle an opponent the same level as you with an army the same size as you or less. Default .5",0.5,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr></table>";b+="</div>";
b+="<div id='caap_RaidSub' style='display: "+(config.getItem("TargetType","Invade")==="Raid"?"block":"none")+"'>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Attempt +1 Kills","PlusOneKills",false,"","Force +1 kill scenario if 80% or more of targets are withn freshmeat settings. Note: Since Castle Age choses the target, selecting this option could result in a greater chance of loss.")+"</table>";b+="Join Raids in this order <a href='http://senses.ws/caap/index.php?topic=1502.0' target='_blank' style='color: blue'>(INFO)</a><br />";
b+=this.MakeTextBox("orderraid","List of search words that decide which raids to participate in first.  Use words in player name or in raid name. To specify max damage follow keyword with :max token and specifiy max damage values. Use 'k' and 'm' suffixes for thousand and million.","","");b+="</div>";b+="<div align=right id='caap_UserIdsSub' style='display: "+(config.getItem("TargetType","Invade")==="Userid List"?"block":"none")+"'>";b+=this.MakeTextBox("BattleTargets","User IDs(not user name).  Click with the right mouse button on the link to the users profile & copy link.  Then paste it here and remove everything but the last numbers. (ie. 123456789)",
"","");b+="</div>";b+="</div>";b+="<hr/></div>";return b}catch(a){utility.error("ERROR in AddBattleMenu: "+a);return""}},AddMonsterMenu:function(){try{var b=["Ambrosia","Malekus","Corvintheus","Aurora","Azeron"],a=['<img src="http://image2.castleagegame.com/graphics/symbol_tiny_1.jpg" height="15" width="14"/>','<img src="http://image2.castleagegame.com/graphics/symbol_tiny_2.jpg" height="15" width="14"/>','<img src="http://image2.castleagegame.com/graphics/symbol_tiny_3.jpg" height="15" width="14"/>',
'<img src="http://image2.castleagegame.com/graphics/symbol_tiny_4.jpg" height="15" width="14"/>','<img src="http://image2.castleagegame.com/graphics/symbol_tiny_5.jpg" height="15" width="14"/>'],c=0,d="";d+=this.ToggleControl("Monster","MONSTER");d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+="<tr><td style='width: 35%'>Attack When</td><td style='text-align: right'>"+this.MakeDropDown("WhenMonster",["Stamina Available","At Max Stamina","At X Stamina","Stay Hidden","Never"],["Stamina Available will attack whenever you have enough stamina",
"At Max Stamina will attack when stamina is at max and will burn down all stamina when able to level up","At X Stamina you can set maximum and minimum stamina to battle",'Stay Hidden uses stamina to try to keep you under 10 health so you cannot be attacked, while also attempting to maximize your stamina use for Monster attacks. YOU MUST SET BATTLE WHEN TO "STAY HIDDEN" TO USE THIS FEATURE.',"Never - disables attacking monsters"],"style='font-size: 10px; width: 100%;'","Never")+"</td></tr></table>";
d+="<div id='caap_WhenMonsterStayHidden1' style='color: red; font-weight: bold; display: "+(config.getItem("WhenMonster","Never")==="Stay Hidden"&&config.getItem("WhenBattle","Never")!=="Stay Hidden"?"block":"none")+"'>Warning: Battle Not Set To 'Stay Hidden'";d+="</div>";d+="<div id='caap_WhenMonsterXStamina' style='display: "+(config.getItem("WhenMonster","Never")!=="At X Stamina"?"none":"block")+"'>";d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+="<tr><td>Battle When Stamina</td><td style='text-align: right'>"+
this.MakeNumberForm("XMonsterStamina","Start attacking if stamina is above this points",1,"size='3' style='font-size: 10px; text-align: right'")+"</td></tr>";d+="<tr><td style='padding-left: 10px'>Keep This Stamina</td><td style='text-align: right'>"+this.MakeNumberForm("XMinMonsterStamina","Don't attack if stamina is below this points",0,"size='3' style='font-size: 10px; text-align: right'")+"</td></tr></table>";d+="</div>";d+="<div id='caap_WhenMonsterHide' style='display: "+(config.getItem("WhenMonster",
"Never")!=="Never"?"block":"none")+"'>";d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+="<tr><td>Monster delay secs</td><td style='text-align: right'>"+this.MakeNumberForm("seedTime","Max random delay (in seconds) to battle monsters",300,"size='3' style='font-size: 10px; text-align: right'")+"</td></tr>";d+=this.MakeCheckTR("Use Tactics","UseTactics",false,"UseTactics_Adv","Use the Tactics attack method, on monsters that support it, instead of the normal attack. You must be level 50 or above.",
true);d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+="<tr><td>&nbsp;&nbsp;&nbsp;Health threshold</td><td style='text-align: right'>"+this.MakeNumberForm("TacticsThreshold","If monster health falls below this percentage then use the regular attack buttons instead of tactics.",75,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr></table>";d+="</div>";d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+=this.MakeCheckTR("Power Attack Only","PowerAttack",
true,"PowerAttack_Adv","Use power attacks. Only do normal attacks if power attack not possible",true);d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+=this.MakeCheckTR("&nbsp;&nbsp;&nbsp;Power Attack Max","PowerAttackMax",false,"","Use maximum power attacks globally on Skaar, Genesis, Ragnarok, and Bahamut types. Only do normal power attacks if maximum power attack not possible")+"</table>";d+="</div>";d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+=this.MakeCheckTR("Power Fortify Max",
"PowerFortifyMax",false,"","Use maximum power fortify globally on Skaar, Genesis, Ragnarok, and Bahamut types. Only do normal power attacks if maximum power attack not possible");d+=this.MakeCheckTR("Siege Weapon Assist Monsters","monsterDoSiege",true,"","Turns on or off automatic siege assist for all monsters only.");d+=this.MakeCheckTR("Collect Monster Rewards","monsterCollectReward",false,"","Automatically collect monster rewards.");d+=this.MakeCheckTR("Clear Complete Monsters","clearCompleteMonsters",
false,"","");d+=this.MakeCheckTR("Achievement Mode","AchievementMode",true,"","Check if monsters have reached achievement damage level first. Switch when achievement met.");d+=this.MakeCheckTR("Get Demi Points First","DemiPointsFirst",false,"DemiList","Don't attack monsters until you've gotten all your demi points from battling. Set 'Battle When' to 'No Monster'",true);d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";for(c in a)if(a.hasOwnProperty(c))d+=a[c]+this.MakeCheckBox("DemiPoint"+
c,true,"",b[c]);d+="</table>";d+="</div>";d+="<table width='180px' cellpadding='0px' cellspacing='0px'>";d+="<tr><td>Fortify If % Under</td><td style='text-align: right'>"+this.MakeNumberForm("MaxToFortify","Fortify if ship health is below this % (leave blank to disable)",50,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";d+="<tr><td style='padding-left: 10px'>Quest If % Over</td><td style='text-align: right'>"+this.MakeNumberForm("MaxHealthtoQuest","Do Quests if ship health is above this % and quest mode is set to Not Fortify (leave blank to disable)",
60,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";d+="<tr><td>No Attack If % Under</td><td style='text-align: right'>"+this.MakeNumberForm("MinFortToAttack","Don't attack if ship health is below this % (leave blank to disable)",10,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr></table>";d+="Attack Monsters in this order <a href='http://senses.ws/caap/index.php?topic=1502.0' target='_blank' style='color: blue'>(INFO)</a><br />";d+=this.MakeTextBox("orderbattle_monster",
"List of search words that decide which monster to attack first. Use words in player name or in monster name. To specify max damage follow keyword with :max token and specifiy max damage values. Use 'k' and 'm' suffixes for thousand and million. To override achievement use the ach: token and specify damage values.","","");d+="</div>";d+="<hr/></div>";return d}catch(e){utility.error("ERROR in AddMonsterMenu: "+e);return""}},AddReconMenu:function(){try{var b="";b+=this.ToggleControl("Recon","RECON");
b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Enable Player Recon","DoPlayerRecon",false,"PlayerReconControl","Enable player battle reconnaissance to run as an idle background task. Battle targets will be collected and can be displayed using the 'Target List' selection on the dashboard.",true);b+="Find battle targets that are:";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td style='padding-left: 10px'>Not Lower Than Rank Minus</td><td style='text-align: right'>"+
this.MakeNumberForm("ReconPlayerRank","Provide the number of ranks below you which recon will use to filter targets. This value will be subtracted from your rank to establish the minimum rank that recon will consider as a viable target. Default 3.",3,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>Not Higher Than Level Plus</td><td style='text-align: right'>"+this.MakeNumberForm("ReconPlayerLevel","Provide the number of levels above you which recon will use to filter targets. This value will be added to your level to establish the maximum level that recon will consider as a viable target. Default 10.",
10,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>Not Higher Than X*Army</td><td style='text-align: right'>"+this.MakeNumberForm("ReconPlayerARBase","This value sets the base for your army ratio calculation. It is basically a multiplier for the army size of a player at your equal level. For example, a value of .5 means you will battle an opponent the same level as you with an army half the size of your army or less. Default 1.",1,"size='2' style='font-size: 10px; text-align: right'")+
"</td></tr></table>";b+="</div>";b+="<hr/></div>";return b}catch(a){utility.error("ERROR in AddReconMenu: "+a);return""}},AddGeneralsMenu:function(){try{var b=0,a="";a+=this.ToggleControl("Generals","GENERALS");a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+=this.MakeCheckTR("Do not reset General","ignoreGeneralImage",true,"","This will prevent the script from changing your selected General to 'Use Current' if the script is unable to find the General's image when changing activities. Instead it will use the current General for the activity and try to select the correct General again next time.")+
"</table>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";for(b in general.StandardList)if(general.StandardList.hasOwnProperty(b))a+="<tr><td>"+general.StandardList[b]+"</td><td style='text-align: right'>"+this.MakeDropDown(general.StandardList[b]+"General",general.List,"","style='font-size: 10px; min-width: 110px; max-width: 110px; width: 110px;'")+"</td></tr>";a+="<tr><td>Buy</td><td style='text-align: right'>"+this.MakeDropDown("BuyGeneral",general.BuyList,"","style='font-size: 10px; min-width: 110px; max-width: 110px; width: 110px;'")+
"</td></tr>";a+="<tr><td>Collect</td><td style='text-align: right'>"+this.MakeDropDown("CollectGeneral",general.CollectList,"","style='font-size: 10px; min-width: 110px; max-width: 110px; width: 110px;'")+"</td></tr>";a+="<tr><td>Income</td><td style='text-align: right'>"+this.MakeDropDown("IncomeGeneral",general.IncomeList,"","style='font-size: 10px; min-width: 110px; max-width: 110px; width: 110px;'")+"</td></tr>";a+="<tr><td>Banking</td><td style='text-align: right'>"+this.MakeDropDown("BankingGeneral",
general.BankingList,"","style='font-size: 10px; min-width: 110px; max-width: 110px; width: 110px;'")+"</td></tr>";a+="<tr><td>Level Up</td><td style='text-align: right'>"+this.MakeDropDown("LevelUpGeneral",general.List,"","style='font-size: 10px; min-width: 110px; max-width: 110px; width: 110px;'")+"</td></tr></table>";a+="<div id='caap_LevelUpGeneralHide' style='display: "+(config.getItem("LevelUpGeneral","Use Current")!=="Use Current"?"block":"none")+"'>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";
a+="<tr><td>Exp To Use LevelUp Gen </td><td style='text-align: right'>"+this.MakeNumberForm("LevelUpGeneralExp","Specify the number of experience points below the next level up to begin using the level up general.",20,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";a+=this.MakeCheckTR("Level Up Gen For Idle","IdleLevelUpGeneral",true,"","Use the Level Up General for Idle mode.");a+=this.MakeCheckTR("Level Up Gen For Monsters","MonsterLevelUpGeneral",true,"","Use the Level Up General for Monster mode.");
a+=this.MakeCheckTR("Level Up Gen For Fortify","FortifyLevelUpGeneral",true,"","Use the Level Up General for Fortify mode.");a+=this.MakeCheckTR("Level Up Gen For Battles","BattleLevelUpGeneral",true,"","Use the Level Up General for Battle mode.");a+=this.MakeCheckTR("Level Up Gen For Duels","DuelLevelUpGeneral",true,"","Use the Level Up General for Duel mode.");a+=this.MakeCheckTR("Level Up Gen For Wars","WarLevelUpGeneral",true,"","Use the Level Up General for War mode.");a+=this.MakeCheckTR("Level Up Gen For SubQuests",
"SubQuestLevelUpGeneral",true,"","Use the Level Up General for doing sub-quests.");a+=this.MakeCheckTR("Level Up Gen For MainQuests","QuestLevelUpGeneral",false,"","Use the Level Up General for doing primary quests (Warning: May cause you not to gain influence if wrong general is equipped.)");a+=this.MakeCheckTR("Don't Bank After Level Up","NoBankAfterLvl",true,"","Ignore Banking until level up energy and stamina gains have been used.");a+=this.MakeCheckTR("Don't Income After Level Up","NoIncomeAfterLvl",
true,"","Ignore Income until level up energy and stamina gains have been used.");a+="</table></div>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+=this.MakeCheckTR("Reverse Under Level 4 Order","ReverseLevelUpGenerals",false,"","This will make the script level Generals under level 4 from Top-down instead of Bottom-up")+"</table>";a+="<hr/></div>";return a}catch(c){utility.error("ERROR in AddGeneralsMenu: "+c);return""}},AddSkillPointsMenu:function(){try{var b=["","Energy","Attack",
"Defense","Stamina","Health"],a="";a+=this.ToggleControl("Status","UPGRADE SKILL POINTS");a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+=this.MakeCheckTR("Auto Add Upgrade Points","AutoStat",false,"AutoStat_Adv","Automatically increase attributes when upgrade skill points are available.",true);a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+=this.MakeCheckTR("Spend All Possible","StatSpendAll",false,"","If selected then spend all possible points and don't save for stamina upgrade.");
a+=this.MakeCheckTR("Upgrade Immediately","StatImmed",false,"","Update Stats Immediately");a+=this.MakeCheckTR("Advanced Settings <a href='http://userscripts.org/posts/207279' target='_blank'><font color='red'>?</font></a>","AutoStatAdv",false,"","USE WITH CAUTION: You can use numbers or formulas(ie. level * 2 + 10). Variable keywords include energy, health, stamina, attack, defense, and level. JS functions can be used (Math.min, Math.max, etc) !!!Remember your math class: 'level + 20' not equals 'level * 2 + 10'!!!")+
"</table>";a+="<div id='caap_Status_Normal' style='display: "+(config.getItem("AutoStatAdv",false)?"none":"block")+"'>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+="<tr><td style='width: 25%; text-align: right'>Increase</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute0",b,"","style='font-size: 10px'")+"</td><td style='width: 5%; text-align: center'>to</td><td style='width: 20%; text-align: right'>"+this.MakeNumberForm("AttrValue0","Automatically increase attributes when upgrade skill points are available.",
0,"size='3' style='font-size: 10px; text-align: right'","text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute1",b,"","style='font-size: 10px'")+"</td><td style='width: 5%; text-align: center'>to</td><td style='width: 20%; text-align: right'>"+this.MakeNumberForm("AttrValue1","Automatically increase attributes when upgrade skill points are available.",0,"size='3' style='font-size: 10px; text-align: right'",
"text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute2",b,"","style='font-size: 10px'")+"</td><td style='width: 5%; text-align: center'>to</td><td style='width: 20%; text-align: right'>"+this.MakeNumberForm("AttrValue2","Automatically increase attributes when upgrade skill points are available.",0,"size='3' style='font-size: 10px; text-align: right'","text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+
this.MakeDropDown("Attribute3",b,"","style='font-size: 10px'")+"</td><td style='width: 5%; text-align: center'>to</td><td style='width: 20%; text-align: right'>"+this.MakeNumberForm("AttrValue3","Automatically increase attributes when upgrade skill points are available.",0,"size='3' style='font-size: 10px; text-align: right'","text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute4",b,"","style='font-size: 10px'")+
"</td><td style='width: 5%; text-align: center'>to</td><td style='width: 20%; text-align: right'>"+this.MakeNumberForm("AttrValue4","Automatically increase attributes when upgrade skill points are available.",0,"size='3' style='font-size: 10px; text-align: right'","text")+" </td></tr></table>";a+="</div>";a+="<div id='caap_Status_Adv' style='display: "+(config.getItem("AutoStatAdv",false)?"block":"none")+"'>";a+="<table width='180px' cellpadding='0px' cellspacing='0px'>";a+="<tr><td style='width: 25%; text-align: right'>Increase</td><td style='width: 50%; text-align: center'>"+
this.MakeDropDown("Attribute5",b,"","style='font-size: 10px'")+"</td><td style='width: 25%; text-align: left'>using</td></tr>";a+="<tr><td colspan='3'>"+this.MakeNumberForm("AttrValue5","Automatically increase attributes when upgrade skill points are available.",0,"size='7' style='font-size: 10px; width : 98%'","text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute6",b,"","style='font-size: 10px'")+
"</td><td style='width: 25%'>using</td></tr>";a+="<tr><td colspan='3'>"+this.MakeNumberForm("AttrValue6","Automatically increase attributes when upgrade skill points are available.",0,"size='7' style='font-size: 10px; width : 98%'","text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute7",b,"","style='font-size: 10px'")+"</td><td style='width: 25%'>using</td></tr>";a+="<tr><td colspan='3'>"+this.MakeNumberForm("AttrValue7",
"Automatically increase attributes when upgrade skill points are available.",0,"size='7' style='font-size: 10px; width : 98%'","text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute8",b,"","style='font-size: 10px'")+"</td><td style='width: 25%'>using</td></tr>";a+="<tr><td colspan='3'>"+this.MakeNumberForm("AttrValue8","Automatically increase attributes when upgrade skill points are available.",0,"size='7' style='font-size: 10px; width : 98%'",
"text")+" </td></tr>";a+="<tr><td style='width: 25%; text-align: right'>Then</td><td style='width: 50%; text-align: center'>"+this.MakeDropDown("Attribute9",b,"","style='font-size: 10px'")+"</td><td style='width: 25%'>using</td></tr>";a+="<tr><td colspan='3'>"+this.MakeNumberForm("AttrValue9","Automatically increase attributes when upgrade skill points are available.",0,"size='7' style='font-size: 10px; width : 98%'","text")+" </td></tr></table>";a+="</div>";a+="</table></div>";a+="<hr/></div>";return a}catch(c){utility.error("ERROR in AddSkillPointsMenu: "+
c);return""}},AddGiftingOptionsMenu:function(){try{var b="";b+=this.ToggleControl("Gifting","GIFTING OPTIONS");b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Auto Gifting","AutoGift",false,"GiftControl","Automatically receive and send return gifts.",true);b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Queue unique users only","UniqueGiftQueue",true,"","When enabled only unique user's gifts will be queued, otherwise all received gifts will be queued.")+
"</table>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td style='width: 25%'>Give</td><td style='text-align: right'>"+this.MakeDropDown("GiftChoice",gifting.gifts.list(),"","style='font-size: 10px; width: 100%'")+"</td></tr></table>";b+="</div>";b+="<hr/></div>";return b}catch(a){utility.error("ERROR in AddGiftingOptionsMenu: "+a);return""}},AddEliteGuardOptionsMenu:function(){try{var b="";b+=this.ToggleControl("Elite","ELITE GUARD OPTIONS");b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";
b+=this.MakeCheckTR("Auto Elite Army","AutoElite",false,"AutoEliteControl","Enable or disable Auto Elite function",true);b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Timed Only","AutoEliteIgnore",false,"","Use this option if you have a small army and are unable to fill all 10 Elite positions. This prevents the script from checking for any empty places and will cause Auto Elite to run on its timer only.")+"</table>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";
b+="<tr><td><input type='button' id='caap_resetElite' value='Do Now' style='padding: 0; font-size: 10px; height: 18px' /></tr></td>";b+="<tr><td>"+this.MakeTextBox("EliteArmyList","Try these UserIDs first. Use ',' between each UserID","","")+"</td></tr></table>";b+="</div>";b+="<hr/></div>";return b}catch(a){utility.error("ERROR in AddEliteGuardOptionsMenu: "+a);return""}},AddAutoOptionsMenu:function(){try{var b="";b+=this.ToggleControl("Auto","AUTO OPTIONS");b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";
b+=this.MakeCheckTR("Auto Collect MA","AutoCollectMA",false,"","Auto collect your Master and Apprentice rewards.");b+=this.MakeCheckTR("Auto Alchemy","AutoAlchemy",false,"AutoAlchemy_Adv","AutoAlchemy will combine all recipes that do not have missing ingredients. By default, it will not combine Battle Hearts recipes.",true);b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("&nbsp;&nbsp;&nbsp;Do Battle Hearts","AutoAlchemyHearts",false,"","If for some reason you do not want to skip Battle Hearts")+
"</td></tr></table>";b+="</div>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Auto Potions","AutoPotions",false,"AutoPotions_Adv","Enable or disable the auto consumption of energy and stamina potions.",true);b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td style='padding-left: 10px'>Spend Stamina Potions At</td><td style='text-align: right'>"+this.MakeNumberForm("staminaPotionsSpendOver","Number of stamina potions at which to begin consuming.",
39,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>Keep Stamina Potions</td><td style='text-align: right'>"+this.MakeNumberForm("staminaPotionsKeepUnder","Number of stamina potions to keep.",35,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>Spend Energy Potions At</td><td style='text-align: right'>"+this.MakeNumberForm("energyPotionsSpendOver","Number of energy potions at which to begin consuming.",
39,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>Keep Energy Potions</td><td style='text-align: right'>"+this.MakeNumberForm("energyPotionsKeepUnder","Number of energy potions to keep.",35,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px'>Wait If Exp. To Level</td><td style='text-align: right'>"+this.MakeNumberForm("potionsExperience","Do not consume potions if the experience points to the next level are within this value.",
20,"size='2' style='font-size: 10px; text-align: right'")+"</td></tr></table>";b+="</div>";b+="<table width='180px' cellpadding='0px' cellspacing='0px' style='margin-top: 3px'>";b+="<tr><td style='width: 50%'>Auto bless</td><td style='text-align: right'>"+this.MakeDropDown("AutoBless",["None","Energy","Attack","Defense","Stamina","Health"],"","style='font-size: 10px; width: 100%'")+"</td></tr></table>";b+="</div>";b+="<hr/></div>";return b}catch(a){utility.error("ERROR in AddAutoOptionsMenu: "+a);
return""}},AddOtherOptionsMenu:function(){try{var b="";b+=this.ToggleControl("Other","OTHER OPTIONS");b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Display CAAP Banner","BannerDisplay",true,"","Uncheck if you wish to hide the CAAP banner.");b+=this.MakeCheckTR("Use 24 Hour Format","use24hr",true,"","Use 24 hour format for displayed times.");b+=this.MakeCheckTR("Set Title","SetTitle",false,"SetTitle_Adv","Set the title bar.",true);b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";
b+=this.MakeCheckTR("&nbsp;&nbsp;&nbsp;Display Action","SetTitleAction",false,"","Add the current action.");b+=this.MakeCheckTR("&nbsp;&nbsp;&nbsp;Display Name","SetTitleName",false,"","Add the player name.")+"</td></tr></table>";b+="</div>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+=this.MakeCheckTR("Hide Sidebar Adverts","HideAds",false,"","Hides the sidebar adverts.");b+=this.MakeCheckTR("Hide FB Iframe Adverts","HideAdsIframe",false,"","Hide the FaceBook Iframe adverts");
b+=this.MakeCheckTR("Hide FB Chat","HideFBChat",false,"","Hide the FaceBook Chat");b+=this.MakeCheckTR("Enable News Summary","NewsSummary",true,"","Enable or disable the news summary on the index page.");b+="<table width='180px' cellpadding='0px' cellspacing='0px' style='margin-top: 3px'>";b+="<tr><td style='width: 50%'>Style</td><td style='text-align: right'>"+this.MakeDropDown("DisplayStyle",["CA Skin","Original","Custom","None"],"","style='font-size: 10px; width: 100%'")+"</td></tr></table>";b+=
"<div id='caap_DisplayStyleHide' style='display: "+(config.getItem("DisplayStyle","CA Skin")==="Custom"?"block":"none")+"'>";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td style='padding-left: 10px; font-weight: bold;'>Started</td><td style='text-align: right'><input type='button' id='caap_StartedColorSelect' value='Select' style='padding: 0; font-size: 10px; height: 18px' /></td></tr>";b+="<tr><td style='padding-left: 20px'>RGB Color</td><td style='text-align: right'>"+
this.MakeNumberForm("StyleBackgroundLight","#FFF or #FFFFFF","#E0C691","size='5' style='font-size: 10px; text-align: right'","text")+"</td></tr>";b+="<tr><td style='padding-left: 20px'>Transparency</td><td style='text-align: right'>"+this.MakeNumberForm("StyleOpacityLight","0 ~ 1",1,"size='5' style='vertical-align: middle; font-size: 10px; text-align: right'")+"</td></tr>";b+="<tr><td style='padding-left: 10px; font-weight: bold;'>Stoped</td><td style='text-align: right'><input type='button' id='caap_StopedColorSelect' value='Select' style='padding: 0; font-size: 10px; height: 18px' /></td></tr>";
b+="<tr><td style='padding-left: 20px'>RGB Color</td><td style='text-align: right'>"+this.MakeNumberForm("StyleBackgroundDark","#FFF or #FFFFFF","#B09060","size='5' style='font-size: 10px; text-align: right'","text")+"</td></tr>";b+="<tr><td style='padding-left: 20px'>Transparency</td><td style='text-align: right'>"+this.MakeNumberForm("StyleOpacityDark","0 ~ 1",1,"size='5' style='font-size: 10px; text-align: right'")+"</td></tr></table>";b+="</div>";b+="<table width='180px' cellpadding='0px' cellspacing='0px' style='margin-top: 3px'>";
b+="<tr><td><input type='button' id='caap_FillArmy' value='Fill Army' style='padding: 0; font-size: 10px; height: 18px' /></td></tr></table>";b+="</div>";b+="<hr/></div>";return b}catch(a){utility.error("ERROR in AddOtherOptionsMenu: "+a);return""}},AddFooterMenu:function(){try{var b="";b+="<table width='180px' cellpadding='0px' cellspacing='0px'>";b+="<tr><td style='width: 90%'>Unlock Menu <input type='button' id='caap_ResetMenuLocation' value='Reset' style='padding: 0; font-size: 10px; height: 18px' /></td><td style='width: 10%; text-align: right'><input type='checkbox' id='unlockMenu' /></td></tr></table>";
if(devVersion){b+="Version: "+caapVersion+" d"+devVersion+" - <a href='http://senses.ws/caap/index.php' target='_blank'>CAAP Forum</a><br />";if(this.newVersionAvailable)b+="<a href='http://castle-age-auto-player.googlecode.com/svn/trunk/Castle-Age-Autoplayer.user.js'>Install new CAAP version: "+state.getItem("SUC_remote_version")+" d"+state.getItem("DEV_remote_version")+"!</a>"}else{b+="Version: "+caapVersion+" - <a href='http://senses.ws/caap/index.php' target='_blank'>CAAP Forum</a><br />";if(this.newVersionAvailable)b+=
"<a href='http://castle-age-auto-player.googlecode.com/files/Castle-Age-Autoplayer.user.js'>Install new CAAP version: "+state.getItem("SUC_remote_version")+"!</a>"}return b}catch(a){utility.error("ERROR in AddFooterMenu: "+a);return""}},AddColorWheels:function(){try{var b=null,a=null;b=function(d){$("#caap_ColorSelectorDiv1").css({"background-color":d});$("#caap_StyleBackgroundLight").val(d);config.setItem("StyleBackgroundLight",d);state.setItem("CustStyleBackgroundLight",d)};$.farbtastic($("<div id='caap_ColorSelectorDiv1'></div>").css({background:config.getItem("StyleBackgroundLight",
"#E0C691"),padding:"5px",border:"2px solid #000",top:window.innerHeight/2-100+"px",left:window.innerWidth/2-290+"px",zIndex:"1337",position:"fixed",display:"none"}).appendTo(document.body),b).setColor(config.getItem("StyleBackgroundLight","#E0C691"));a=function(d){$("#caap_ColorSelectorDiv2").css({"background-color":d});$("#caap_StyleBackgroundDark").val(d);config.setItem("StyleBackgroundDark",d);state.setItem("CustStyleBackgroundDark",d)};$.farbtastic($("<div id='caap_ColorSelectorDiv2'></div>").css({background:config.getItem("StyleBackgroundDark",
"#B09060"),padding:"5px",border:"2px solid #000",top:window.innerHeight/2-100+"px",left:window.innerWidth/2+"px",zIndex:"1337",position:"fixed",display:"none"}).appendTo(document.body),a).setColor(config.getItem("StyleBackgroundDark","#B09060"));return true}catch(c){utility.error("ERROR in AddColorWheels: "+c);return false}},AddDashboard:function(){try{var b="<div id='caap_top'>",a={x:0,y:0};b+="<div id='caap_buttonMonster' style='position:absolute;top:0px;left:250px;display:"+(config.getItem("DBDisplay",
"Monster")==="Monster"?"block":"none")+"'><input type='button' id='caap_refreshMonsters' value='Refresh Monster List' style='padding: 0; font-size: 9px; height: 18px' /></div>";b+="<div id='caap_buttonTargets' style='position:absolute;top:0px;left:250px;display:"+(config.getItem("DBDisplay","Monster")==="Target List"?"block":"none")+"'><input type='button' id='caap_clearTargets' value='Clear Targets List' style='padding: 0; font-size: 9px; height: 18px' /></div>";b+="<div id='caap_buttonBattle' style='position:absolute;top:0px;left:250px;display:"+
(config.getItem("DBDisplay","Monster")==="Battle Stats"?"block":"none")+"'><input type='button' id='caap_clearBattle' value='Clear Battle Stats' style='padding: 0; font-size: 9px; height: 18px' /></div>";b+="<div id='caap_buttonGifting' style='position:absolute;top:0px;left:250px;display:"+(config.getItem("DBDisplay","Monster")==="Gifting Stats"?"block":"none")+"'><input type='button' id='caap_clearGifting' value='Clear Gifting Stats' style='padding: 0; font-size: 9px; height: 18px' /></div>";b+=
"<div id='caap_buttonGiftQueue' style='position:absolute;top:0px;left:250px;display:"+(config.getItem("DBDisplay","Monster")==="Gift Queue"?"block":"none")+"'><input type='button' id='caap_clearGiftQueue' value='Clear Gift Queue' style='padding: 0; font-size: 9px; height: 18px' /></div>";b+="<div id='caap_buttonFeed' style='position:absolute;top:0px;left:0px;'><input id='caap_liveFeed' type='button' value='LIVE FEED! Your friends are calling.' style='padding: 0; font-size: 9px; height: 18px' /></div>";
b+="<div id='caap_DBDisplay' style='font-size: 9px;position:absolute;top:0px;right:5px;'>Display: "+this.DBDropDown("DBDisplay",["Monster","Target List","Battle Stats","User Stats","Generals Stats","Soldier Stats","Item Stats","Magic Stats","Gifting Stats","Gift Queue"],"","style='font-size: 9px; min-width: 120px; max-width: 120px; width : 120px;'")+"</div>";b+="<div id='caap_infoMonster' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+(config.getItem("DBDisplay",
"Monster")==="Monster"?"block":"none")+"'></div>";b+="<div id='caap_infoTargets1' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+(config.getItem("DBDisplay","Monster")==="Target List"?"block":"none")+"'></div>";b+="<div id='caap_infoBattle' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+(config.getItem("DBDisplay","Monster")==="Battle Stats"?"block":"none")+"'></div>";b+="<div id='caap_userStats' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+
(config.getItem("DBDisplay","Monster")==="User Stats"?"block":"none")+"'></div>";b+="<div id='caap_generalsStats' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+(config.getItem("DBDisplay","Monster")==="Generals Stats"?"block":"none")+"'></div>";b+="<div id='caap_soldiersStats' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+(config.getItem("DBDisplay","Monster")==="Soldier Stats"?"block":"none")+"'></div>";b+="<div id='caap_itemStats' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+
(config.getItem("DBDisplay","Monster")==="Item Stats"?"block":"none")+"'></div>";b+="<div id='caap_magicStats' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+(config.getItem("DBDisplay","Monster")==="Magic Stats"?"block":"none")+"'></div>";b+="<div id='caap_giftStats' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+(config.getItem("DBDisplay","Monster")==="Gifting Stats"?"block":"none")+"'></div>";b+="<div id='caap_giftQueue' style='position:relative;top:15px;width:610px;height:165px;overflow:auto;display:"+
(config.getItem("DBDisplay","Monster")==="Gift Queue"?"block":"none")+"'></div>";b+="</div>";this.dashboardXY.x=state.getItem("caap_top_menuLeft","");this.dashboardXY.y=state.getItem("caap_top_menuTop",$(this.dashboardXY.selector).offset().top-10);a=this.GetDashboardXY();$(b).css({background:config.getItem("StyleBackgroundLight","white"),padding:"5px",height:"185px",width:"610px",margin:"0 auto",opacity:config.getItem("StyleOpacityLight",1),top:a.y+"px",left:a.x+"px",zIndex:state.getItem("caap_top_zIndex",
1),position:"absolute","-moz-border-radius":"5px","-webkit-border-radius":"5px"}).appendTo(document.body);this.caapTopObject=$("#caap_top");$("#caap_refreshMonsters").button();$("#caap_clearTargets").button();$("#caap_clearBattle").button();$("#caap_clearGifting").button();$("#caap_clearGiftQueue").button();$("#caap_liveFeed").button();return true}catch(c){utility.error("ERROR in AddDashboard: "+c);return false}},decHours2HoursMin:function(b){utility.log(9,"decHours2HoursMin",b);var a=0,c=0;a=Math.floor(b);
c=parseInt((b-a)*60,10);if(c<10)c="0"+c;return a+":"+c},makeCommaValue:function(b){b+="";b=b.split(".")[0];for(var a=/(\d+)(\d{3})/;a.test(b);)b=b.replace(a,"$1,$2");return b},makeTh:function(b){var a={text:"",color:"",id:"",title:"",width:""},c="<th";a=b;if(!a.color)a.color="black";if(a.id)c+=" id='"+a.id+"'";if(a.title)c+=" title='"+a.title+"'";if(a.width)c+=" width='"+a.width+"'";c+=" style='color:"+a.color+";font-size:10px;font-weight:bold'>"+a.text+"</th>";return c},makeTd:function(b){var a=
{text:"",color:"",id:"",title:""},c="<td";a=b;if(!a.color)a.color="black";if(a.id)c+=" id='"+a.id+"'";if(a.title)c+=" title='"+a.title+"'";c+=" style='color:"+a.color+";font-size:10px'>"+a.text+"</td>";return c},UpdateDashboardWaitLog:true,UpdateDashboard:function(b){try{var a="",c=[],d="",e="",g=0,f=0,j="",i=0,k=[],l=[],p=[],o=[],h=0,m=0,t=new Date,s=0,n="",r="",w="",D="",x="",A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],z="",B="",G="",y="",F="",J=0,K=0,E=0,I="",L=
{text:"",color:"",id:"",title:"",width:""},H={text:"",color:"",id:"",title:""},M="",C;if($("#caap_top").length===0)throw"We are missing the Dashboard div!";if(!b&&!utility.oneMinuteUpdate("dashboard")&&$("#caap_infoMonster").html()&&$("#caap_infoMonster").html()){if(this.UpdateDashboardWaitLog){utility.log(2,"Dashboard update is waiting on oneMinuteUpdate");this.UpdateDashboardWaitLog=false}return false}utility.log(2,"Updating Dashboard");this.UpdateDashboardWaitLog=true;if(state.getItem("MonsterDashUpdate",
true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";k=["Name","Damage","Damage%","Fort%","Stre%","TimeLeft","T2K","Phase","Link","&nbsp;","&nbsp;"];l=["name","damage","life","fortify","strength","timeLeft","t2k","phase","link"];for(h=0;h<k.length;h+=1){M="";if(k[h]==="Name")M="30%";a+=this.makeTh({text:k[h],color:"",id:"",title:"",width:M})}a+="</tr>";l.shift();utility.log(9,"monsterList",c);monster.records.forEach(function(u){utility.log(9,"monsterObj",u);d=u.name;e=u.type;g=
10;f=0;if(monster.info[e]){if(!caap.InLevelUpMode()&&config.getItem("PowerFortifyMax")&&monster.info[e].staLvl)for(f=monster.info[e].staLvl.length-1;f>=0;f-=1)if(caap.stats.stamina.max>monster.info[e].staLvl[f])break;if(f>=0&&f!==null&&f!==undefined&&config.getItem("PowerAttackMax")&&monster.info[e].nrgMax)g=monster.info[e].nrgMax[f]}utility.log(9,"Energy Required/Node",g,f);j="";a+="<tr>";j=d===state.getItem("targetFromfortify","")?"blue":d===state.getItem("targetFromraid","")||d===state.getItem("targetFrombattle_monster",
"")?"green":u.color;K=J=0;if(F=u.conditions){J=monster.parseCondition("ach",F);K=monster.parseCondition("max",F)}n=u.link;utility.log(9,"monsterObjLink",n);if(n){r=n.replace("&action=doObjective","").match(/'(http:.+)'/);utility.log(9,"visitMonsterLink",r);w="Clicking this link will take you to "+d;H={text:'<span id="caap_monster_'+s+'" title="'+w+'" mname="'+d+'" rlink="'+r[1]+'" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';">'+d+"</span>",color:j,id:"",
title:""};a+=caap.makeTd(H)}else a+=caap.makeTd({text:d,color:j,id:"",title:""});l.forEach(function(q){utility.log(9,"displayItem/value ",q,u[q]);G="caap_"+q+"_"+s;y="";if(q==="phase"&&j==="grey")a+=caap.makeTd({text:u.status,color:j,id:"",title:""});else{i=u[q];if(i!==""&&i>=0||i!==""&&isNaN(i)){if(parseInt(i,10)===i&&i>999){utility.log(9,"makeCommaValue ",i);i=caap.makeCommaValue(i)}switch(q){case "damage":if(J)y="User Set Monster Achievement: "+caap.makeCommaValue(J);else if(config.getItem("AchievementMode",
false)){if(monster.info[e])y="Default Monster Achievement: "+caap.makeCommaValue(monster.info[e].ach)}else y="Achievement Mode Disabled";if(K)y+=" - User Set Max Damage: "+caap.makeCommaValue(K);break;case "timeLeft":if(monster.info[e])y="Total Monster Duration: "+monster.info[e].duration+" hours";break;case "t2k":i=caap.decHours2HoursMin(i);y="Estimated Time To Kill: "+i+" hours:mins";break;case "life":i=i.toFixed(2);y="Percentage of monster life remaining: "+i+"%";break;case "fortify":i=i.toFixed(2);
y="Percentage of party health/monster defense: "+i+"%";break;case "strength":i=i.toFixed(2);y="Percentage of party strength: "+i+"%";break;default:}a+=caap.makeTd({text:i,color:j,id:G,title:y})}else a+=caap.makeTd({text:"",color:j,id:"",title:""})}});if(F&&F!=="none"){H={text:'<span title="User Set Conditions: '+F+'" class="ui-icon ui-icon-info">i</span>',color:"blue",id:"",title:""};a+=caap.makeTd(H)}else a+=caap.makeTd({text:"",color:j,id:"",title:""});if(n){D=n.replace("casuser","remove_list").replace("&action=doObjective",
"").match(/'(http:.+)'/);utility.log(9,"removeLink",D);x="Clicking this link will remove "+d+" from both CA and CAAP!";H={text:'<span id="caap_remove_'+s+'" title="'+x+'" mname="'+d+'" rlink="'+D[1]+'" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';" class="ui-icon ui-icon-circle-close">X</span>',color:"blue",id:"",title:""};a+=caap.makeTd(H)}else a+=caap.makeTd({text:"",color:j,id:"",title:""});a+="</tr>";s+=1});a+="</table>";$("#caap_infoMonster").html(a);
C=function(u){utility.log(9,"Clicked",u.target.id);var q={mname:"",rlink:"",arlink:""},v=0;for(v=0;v<u.target.attributes.length;v+=1)if(u.target.attributes[v].nodeName==="mname")q.mname=u.target.attributes[v].nodeValue;else if(u.target.attributes[v].nodeName==="rlink"){q.rlink=u.target.attributes[v].nodeValue;q.arlink=q.rlink.replace("http://apps.facebook.com/castle_age/","")}utility.log(9,"visitMonsterLink",q);utility.ClickAjax(q.arlink)};$("#caap_top span[id*='caap_monster_']").unbind("click",C).click(C);
C=function(u){utility.log(9,"Clicked",u.target.id);var q={mname:"",rlink:"",arlink:""},v=0;v=false;for(v=0;v<u.target.attributes.length;v+=1)if(u.target.attributes[v].nodeName==="mname")q.mname=u.target.attributes[v].nodeValue;else if(u.target.attributes[v].nodeName==="rlink"){q.rlink=u.target.attributes[v].nodeValue;q.arlink=q.rlink.replace("http://apps.facebook.com/castle_age/","")}utility.log(9,"monsterRemove",q);v=confirm("Are you sure you want to remove "+q.mname+"?");if(v===true){monster.deleteItem(q.mname);
caap.UpdateDashboard(true);if(state.getItem("clickUrl","").indexOf(q.arlink)<0){state.setItem("clickUrl",q.rlink);this.waitingForDomLoad=false}utility.VisitUrl("javascript:void(a46755028429_get_cached_ajax('"+q.arlink+"', 'get_body'))")}};$("#caap_top span[id*='caap_remove_']").unbind("click",C).click(C);state.setItem("MonsterDashUpdate",false)}if(state.getItem("ReconDashUpdate",true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";k=["UserId","Name","Deity#","Rank","Rank#","Level",
"Army","Last Alive"];l=["userID","nameStr","deityNum","rankStr","rankNum","levelNum","armyNum","aliveTime"];for(h=0;h<k.length;h+=1)a+=this.makeTh({text:k[h],color:"",id:"",title:"",width:""});a+="</tr>";for(m=0;m<this.ReconRecordArray.length;m+=1){a+="<tr>";for(h=0;h<l.length;h+=1)if(/userID/.test(l[h])){B="Clicking this link will take you to the user keep of "+this.ReconRecordArray[m][l[h]];z="http://apps.facebook.com/castle_age/keep.php?casuser="+this.ReconRecordArray[m][l[h]];H={text:'<span id="caap_targetrecon_'+
m+'" title="'+B+'" rlink="'+z+'" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';">'+this.ReconRecordArray[m][l[h]]+"</span>",color:"blue",id:"",title:""};a+=caap.makeTd(H)}else if(/\S+Num/.test(l[h]))a+=caap.makeTd({text:this.ReconRecordArray[m][l[h]],color:"black",id:"",title:""});else if(/\S+Time/.test(l[h])){t=new Date(this.ReconRecordArray[m][l[h]]);H={text:t.getDate()+"-"+A[t.getMonth()]+" "+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes(),color:"black",
id:"",title:""};a+=caap.makeTd(H)}else a+=caap.makeTd({text:this.ReconRecordArray[m][l[h]],color:"black",id:"",title:""});a+="</tr>"}a+="</table>";$("#caap_infoTargets1").html(a);C=function(u){utility.log(9,"Clicked",u.target.id);var q={rlink:"",arlink:""},v=0;for(v=0;v<u.target.attributes.length;v+=1)if(u.target.attributes[v].nodeName==="rlink"){q.rlink=u.target.attributes[v].nodeValue;q.arlink=q.rlink.replace("http://apps.facebook.com/castle_age/","")}utility.log(9,"visitUserIdLink",q);utility.ClickAjax(q.arlink)};
$("#caap_top span[id*='caap_targetrecon_']").unbind("click",C).click(C);state.setItem("ReconDashUpdate",false)}if(state.getItem("BattleDashUpdate",true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";k=["UserId","Name","BR#","WR#","Level","Army","I Win","I Lose","D Win","D Lose","W Win","W Lose"];l=["userId","nameStr","rankNum","warRankNum","levelNum","armyNum","invadewinsNum","invadelossesNum","duelwinsNum","duellossesNum","warwinsNum","warlossesNum"];for(h=0;h<k.length;h+=1)a+=
this.makeTh({text:k[h],color:"",id:"",title:"",width:""});a+="</tr>";for(m=0;m<battle.records.length;m+=1){a+="<tr>";for(h=0;h<l.length;h+=1)if(/userId/.test(l[h])){B="Clicking this link will take you to the user keep of "+battle.records[m][l[h]];z="http://apps.facebook.com/castle_age/keep.php?casuser="+battle.records[m][l[h]];H={text:'<span id="caap_battle_'+m+'" title="'+B+'" rlink="'+z+'" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';">'+battle.records[m][l[h]]+
"</span>",color:"blue",id:"",title:""};a+=caap.makeTd(H)}else a+=/rankNum/.test(l[h])?caap.makeTd({text:battle.records[m][l[h]],color:"black",id:"",title:battle.records[m].rankStr}):/warRankNum/.test(l[h])?caap.makeTd({text:battle.records[m][l[h]],color:"black",id:"",title:battle.records[m].warRankStr}):caap.makeTd({text:battle.records[m][l[h]],color:"black",id:"",title:""});a+="</tr>"}a+="</table>";$("#caap_infoBattle").html(a);$("#caap_top span[id*='caap_battle_']").click(function(u){utility.log(9,
"Clicked",u.target.id);var q={rlink:"",arlink:""},v=0;for(v=0;v<u.target.attributes.length;v+=1)if(u.target.attributes[v].nodeName==="rlink"){q.rlink=u.target.attributes[v].nodeValue;q.arlink=q.rlink.replace("http://apps.facebook.com/castle_age/","")}utility.log(9,"visitUserIdLink",q);utility.ClickAjax(q.arlink)});state.setItem("BattleDashUpdate",false)}if(state.getItem("UserDashUpdate",true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";k=["Name","Value","Name","Value"];for(h=
0;h<k.length;h+=1)a+=this.makeTh({text:k[h],color:"",id:"",title:"",width:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Facebook ID",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.FBID,color:"red",id:"",title:""});a+=this.makeTd({text:"Account Name",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.account,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});
a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Character Name",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.PlayerName,color:"red",id:"",title:""});a+=this.makeTd({text:"Energy",color:"black",id:"",title:"Current/Max"});a+=this.makeTd({text:this.stats.energy.num+"/"+this.stats.energy.max,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Level",
color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.level,color:"red",id:"",title:""});a+=this.makeTd({text:"Stamina",color:"black",id:"",title:"Current/Max"});a+=this.makeTd({text:this.stats.stamina.num+"/"+this.stats.stamina.max,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Battle Rank",color:"black",id:"",title:""});a+=this.makeTd({text:battle.battleRankTable[this.stats.rank.battle]+" ("+this.stats.rank.battle+")",color:"red",id:"",title:""});a+=this.makeTd({text:"Attack",
color:"black",id:"",title:"Current/Max"});a+=this.makeTd({text:this.makeCommaValue(this.stats.attack),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Battle Rank Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.rank.battlePoints),color:"red",id:"",title:""});a+=this.makeTd({text:"Defense",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.defense),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=
this.makeTd({text:"War Rank",color:"black",id:"",title:""});a+=this.makeTd({text:battle.warRankTable[this.stats.rank.war]+" ("+this.stats.rank.war+")",color:"red",id:"",title:""});a+=this.makeTd({text:"Health",color:"black",id:"",title:"Current/Max"});a+=this.makeTd({text:this.stats.health.num+"/"+this.stats.health.max,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"War Rank Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.rank.warPoints),
color:"red",id:"",title:""});a+=this.makeTd({text:"Army",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.army.actual),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"Generals",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.generals.total,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",
color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"Generals When Invade",color:"black",id:"",title:"For every 5 army members you have, one of your generals will also join the fight."});a+=this.makeTd({text:this.stats.generals.invade,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",
id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Gold In Bank",color:"black",id:"",title:""});a+=this.makeTd({text:"$"+this.makeCommaValue(this.stats.gold.bank),color:"red",id:"",title:""});a+=this.makeTd({text:"Total Income Per Hour",color:"black",id:"",title:""});a+=this.makeTd({text:"$"+this.makeCommaValue(this.stats.gold.income),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Gold In Cash",color:"black",
id:"",title:""});a+=this.makeTd({text:"$"+this.makeCommaValue(this.stats.gold.cash),color:"red",id:"",title:""});a+=this.makeTd({text:"Upkeep",color:"black",id:"",title:""});a+=this.makeTd({text:"$"+this.makeCommaValue(this.stats.gold.upkeep),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Total Gold",color:"black",id:"",title:""});a+=this.makeTd({text:"$"+this.makeCommaValue(this.stats.gold.total),color:"red",id:"",title:""});a+=this.makeTd({text:"Cash Flow Per Hour",color:"black",
id:"",title:""});a+=this.makeTd({text:"$"+this.makeCommaValue(this.stats.gold.flow),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Skill Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.points.skill,
color:"red",id:"",title:""});a+=this.makeTd({text:"Energy Potions",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.potions.energy,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Favor Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.points.favor,color:"red",id:"",title:""});a+=this.makeTd({text:"Stamina Potions",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.potions.stamina,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";
a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Experience To Next Level (ETNL)",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.exp.dif),color:"red",id:"",title:""});a+=this.makeTd({text:"Battle Strength Index (BSI)",color:"black",
id:"",title:""});a+=this.makeTd({text:this.stats.indicators.bsi.toFixed(2),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Hours To Level (HTL)",color:"black",id:"",title:""});a+=this.makeTd({text:this.decHours2HoursMin(this.stats.indicators.htl),color:"red",id:"",title:""});a+=this.makeTd({text:"Levelling Speed Index (LSI)",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.indicators.lsi.toFixed(2),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Hours Remaining To Level (HRTL)",
color:"black",id:"",title:""});a+=this.makeTd({text:this.decHours2HoursMin(this.stats.indicators.hrtl),color:"red",id:"",title:""});a+=this.makeTd({text:"Skill Points Per Level (SPPL)",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.indicators.sppl.toFixed(2),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Expected Next Level (ENL)",color:"black",id:"",title:""});a+=this.makeTd({text:schedule.FormatTime(new Date(this.stats.indicators.enl)),color:"red",id:"",
title:""});a+=this.makeTd({text:"Attack Power Index (API)",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.indicators.api.toFixed(2),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"Defense Power Index (DPI)",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.indicators.dpi.toFixed(2),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";
a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"Mean Power Index (MPI)",color:"black",id:"",title:""});a+=this.makeTd({text:this.stats.indicators.mpi.toFixed(2),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",
color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Battles/Wars Won",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.other.bww),color:"red",id:"",title:""});a+=this.makeTd({text:"Times eliminated",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.other.te),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Battles/Wars Lost",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.other.bwl),
color:"red",id:"",title:""});a+=this.makeTd({text:"Times you eliminated an enemy",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.other.tee),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Battles/Wars Win/Loss Ratio (WLR)",color:"black",id:"",title:""});a+=this.stats.other.wlr?this.makeTd({text:this.stats.other.wlr.toFixed(2),color:"red",id:"",title:""}):this.makeTd({text:this.stats.other.wlr,color:"red",id:"",title:""});a+=this.makeTd({text:"Enemy Eliminated/Eliminated Ratio (EER)",
color:"black",id:"",title:""});a+=this.stats.other.eer?this.makeTd({text:this.stats.other.eer.toFixed(2),color:"red",id:"",title:""}):this.makeTd({text:this.stats.other.eer,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Invasions Won",
color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.battle.invasions.won),color:"red",id:"",title:""});a+=this.makeTd({text:"Duels Won",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.battle.duels.won),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Invasions Lost",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.battle.invasions.lost),
color:"red",id:"",title:""});a+=this.makeTd({text:"Duels Lost",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.battle.duels.lost),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Invasions Streak",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.battle.invasions.streak),color:"red",id:"",title:""});a+=this.makeTd({text:"Duels Streak",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.battle.duels.streak),
color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Invasions Win/loss Ratio (IWLR)",color:"black",id:"",title:""});a+=this.stats.achievements.battle.invasions.ratio?this.makeTd({text:this.stats.achievements.battle.invasions.ratio.toFixed(2),color:"red",id:"",title:""}):this.makeTd({text:this.stats.achievements.battle.invasions.ratio,color:"red",id:"",title:""});a+=this.makeTd({text:"Duels Win/loss Ratio (DWLR)",color:"black",id:"",title:""});a+=this.stats.achievements.battle.duels.ratio?
this.makeTd({text:this.stats.achievements.battle.duels.ratio.toFixed(2),color:"red",id:"",title:""}):this.makeTd({text:this.stats.achievements.battle.duels.ratio,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Quests Completed",
color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.other.qc),color:"red",id:"",title:""});a+=this.makeTd({text:"Alchemy Performed",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.other.alchemy),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});
a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Gildamesh, The Orc King Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.gildamesh),color:"red",id:"",title:""});a+=this.makeTd({text:"Lotus Ravenmoore Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.lotus),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"The Colossus of Terra Slain",
color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.colossus),color:"red",id:"",title:""});a+=this.makeTd({text:"Dragons Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.dragons),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Sylvanas the Sorceress Queen Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.sylvanas),
color:"red",id:"",title:""});a+=this.makeTd({text:"Cronus, The World Hydra Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.cronus),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Keira the Dread Knight Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.keira),color:"red",id:"",title:""});a+=this.makeTd({text:"The Battle of the Dark Legion Slain",color:"black",
id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.legion),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Genesis, The Earth Elemental Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.genesis),color:"red",id:"",title:""});a+=this.makeTd({text:"Skaar Deathrune Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.skaar),
color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Gehenna, The Fire Elemental Slain",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.gehenna),color:"red",id:"",title:""});a+=this.makeTd({text:"Sieges Assisted With",color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.sieges),color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Aurelius, Lion's Rebellion",
color:"black",id:"",title:""});a+=this.makeTd({text:this.makeCommaValue(this.stats.achievements.monster.aurelius),color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",
id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Ambrosia Daily Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.ambrosia.daily.num+"/"+this.demi.ambrosia.daily.max,color:"red",id:"",title:""});a+=this.makeTd({text:"Malekus Daily Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.malekus.daily.num+"/"+this.demi.ambrosia.daily.max,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Ambrosia Total Points",color:"black",id:"",title:""});
a+=this.makeTd({text:this.demi.ambrosia.power.total,color:"red",id:"",title:""});a+=this.makeTd({text:"Malekus Total Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.malekus.power.total,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";
a+="<tr>";a+=this.makeTd({text:"Corvintheus Daily Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.corvintheus.daily.num+"/"+this.demi.corvintheus.daily.max,color:"red",id:"",title:""});a+=this.makeTd({text:"Aurora Daily Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.aurora.daily.num+"/"+this.demi.aurora.daily.max,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Corvintheus Total Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.corvintheus.power.total,
color:"red",id:"",title:""});a+=this.makeTd({text:"Aurora Total Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.aurora.power.total,color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Azeron Daily Points",
color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.azeron.daily.num+"/"+this.demi.azeron.daily.max,color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"Azeron Total Points",color:"black",id:"",title:""});a+=this.makeTd({text:this.demi.azeron.power.total,color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",
color:"red",id:"",title:""});a+="</tr>";a+="<tr>";a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"black",id:"",title:""});a+=this.makeTd({text:"&nbsp;",color:"red",id:"",title:""});a+="</tr>";s=0;for(h in this.stats.character)if(this.stats.character.hasOwnProperty(h)){if(s%2===0)a+="<tr>";a+=this.makeTd({text:this.stats.character[h].name,color:"black",id:"",title:""});a+=this.makeTd({text:"Level "+
this.stats.character[h].level+" ("+this.stats.character[h].percent+"%)",color:"red",id:"",title:""});if(s%2===1)a+="</tr>";s+=1}a+="</table>";$("#caap_userStats").html(a);state.setItem("UserDashUpdate",false)}if(state.getItem("GeneralsDashUpdate",true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";k=["General","Lvl","Atk","Def","API","DPI","MPI","EAtk","EDef","EAPI","EDPI","EMPI","Special"];l=["name","lvl","atk","def","api","dpi","mpi","eatk","edef","eapi","edpi","empi","special"];
$.merge(p,l);for(h=0;h<k.length;h+=1){L={text:'<span id="caap_generalsStats_'+l[h]+'" title="Click to sort" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';">'+k[h]+"</span>",color:"blue",id:"",title:"",width:""};if(k[h]==="Special")L={text:k[h],color:"black",id:"",title:"",width:"25%"};a+=this.makeTh(L)}a+="</tr>";for(E=0;E<general.recordsSortable.length;E+=1){a+="<tr>";for(h=0;h<l.length;h+=1){I="";if(isNaN(general.recordsSortable[E][l[h]])){if(general.recordsSortable[E][l[h]])I=
general.recordsSortable[E][l[h]]}else I=/pi/.test(l[h])?general.recordsSortable[E][l[h]].toFixed(2):general.recordsSortable[E][l[h]].toString();j=h===0?"black":"red";a+=caap.makeTd({text:I,color:j,id:"",title:""})}a+="</tr>"}a+="</table>";$("#caap_generalsStats").html(a);C=function(u){var q="";if(u.target.id)q=u.target.id.replace(/caap_.*Stats_/,"");utility.log(9,"Clicked",q);if(p.indexOf(q)!==-1&&typeof sort[q]==="function"){general.recordsSortable.sort(sort[q]);state.setItem("GeneralsDashUpdate",
true);caap.UpdateDashboard(true)}};$("#caap_top span[id*='caap_generalsStats_']").unbind("click",C).click(C);state.setItem("GeneralsDashUpdate",false)}if(state.getItem("SoldiersDashUpdate",true)||state.getItem("ItemDashUpdate",true)||state.getItem("MagicDashUpdate",true)){k=["Name","Owned","Atk","Def","API","DPI","MPI","Cost","Upkeep","Hourly"];l=["name","owned","atk","def","api","dpi","mpi","cost","upkeep","hourly"];$.merge(o,l);for(m=0;m<town.types.length;m+=1)if(state.getItem(town.types[m].ucFirst()+
"DashUpdate",true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";for(h=0;h<k.length;h+=1){L={text:'<span id="caap_'+town.types[m]+"Stats_"+l[h]+'" title="Click to sort" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';">'+k[h]+"</span>",color:"blue",id:"",title:"",width:""};a+=this.makeTh(L)}a+="</tr>";for(E=0;E<town[town.types[m]+"Sortable"].length;E+=1){a+="<tr>";for(h=0;h<l.length;h+=1){I="";if(isNaN(town[town.types[m]+"Sortable"][E][l[h]])){if(town[town.types[m]+
"Sortable"][E][l[h]])I=town[town.types[m]+"Sortable"][E][l[h]]}else if(/pi/.test(l[h]))I=town[town.types[m]+"Sortable"][E][l[h]].toFixed(2);else{I=this.makeCommaValue(town[town.types[m]+"Sortable"][E][l[h]]);if(l[h]==="cost"||l[h]==="upkeep"||l[h]==="hourly")I="$"+I}j=h===0?"black":"red";a+=caap.makeTd({text:I,color:j,id:"",title:""})}a+="</tr>"}a+="</table>";$("#caap_"+town.types[m]+"Stats").html(a)}C=function(u){var q="";if(u.target.id)q=u.target.id.replace(/caap_.*Stats_/,"");utility.log(9,"Clicked",
q);if(o.indexOf(q)!==-1&&typeof sort[q]==="function"){town.soldiersSortable.sort(sort[q]);state.setItem("SoldiersDashUpdate",true);caap.UpdateDashboard(true)}};$("#caap_top span[id*='caap_soldiersStats_']").unbind("click",C).click(C);state.setItem("SoldiersDashUpdate",false);C=function(u){var q="";if(u.target.id)q=u.target.id.replace(/caap_.*Stats_/,"");utility.log(9,"Clicked",q);if(o.indexOf(q)!==-1&&typeof sort[q]==="function"){town.itemSortable.sort(sort[q]);state.setItem("ItemDashUpdate",true);
caap.UpdateDashboard(true)}};$("#caap_top span[id*='caap_itemStats_']").unbind("click",C).click(C);state.setItem("ItemDashUpdate",false);C=function(u){var q="";if(u.target.id)q=u.target.id.replace(/caap_.*Stats_/,"");utility.log(9,"Clicked",q);if(o.indexOf(q)!==-1&&typeof sort[q]==="function"){town.magicSortable.sort(sort[q]);state.setItem("MagicDashUpdate",true);caap.UpdateDashboard(true)}};$("#caap_top span[id*='caap_magicStats_']").unbind("click",C).click(C);state.setItem("MagicDashUpdate",false)}if(state.getItem("GiftHistoryDashUpdate",
true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";k=["UserId","Name","Received","Sent"];l=["userId","name","received","sent"];for(h=0;h<k.length;h+=1)a+=this.makeTh({text:k[h],color:"",id:"",title:"",width:""});a+="</tr>";for(m=0;m<gifting.history.records.length;m+=1){a+="<tr>";for(h=0;h<l.length;h+=1)if(/userId/.test(l[h])){B="Clicking this link will take you to the user keep of "+gifting.history.records[m][l[h]];z="http://apps.facebook.com/castle_age/keep.php?casuser="+gifting.history.records[m][l[h]];
H={text:'<span id="caap_targetgift_'+m+'" title="'+B+'" rlink="'+z+'" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';">'+gifting.history.records[m][l[h]]+"</span>",color:"blue",id:"",title:""};a+=caap.makeTd(H)}else a+=caap.makeTd({text:gifting.history.records[m][l[h]],color:"black",id:"",title:""});a+="</tr>"}a+="</table>";$("#caap_giftStats").html(a);C=function(u){utility.log(9,"Clicked",u.target.id);var q={rlink:"",arlink:""},v=0;for(v=0;v<u.target.attributes.length;v+=
1)if(u.target.attributes[v].nodeName==="rlink"){q.rlink=u.target.attributes[v].nodeValue;q.arlink=q.rlink.replace("http://apps.facebook.com/castle_age/","")}utility.log(9,"visitUserIdLink",q);utility.ClickAjax(q.arlink)};$("#caap_top span[id*='caap_targetgift_']").unbind("click",C).click(C);state.setItem("GiftHistoryDashUpdate",false)}if(state.getItem("GiftQueueDashUpdate",true)){a="<table width='100%' cellpadding='0px' cellspacing='0px'><tr>";k=["UserId","Name","Gift","FB Cleared","Delete"];l=["userId",
"name","gift","found"];for(h=0;h<k.length;h+=1)a+=this.makeTh({text:k[h],color:"",id:"",title:"",width:""});a+="</tr>";for(m=0;m<gifting.queue.records.length;m+=1){a+="<tr>";for(h=0;h<l.length;h+=1)if(/userId/.test(l[h])){B="Clicking this link will take you to the user keep of "+gifting.queue.records[m][l[h]];z="http://apps.facebook.com/castle_age/keep.php?casuser="+gifting.queue.records[m][l[h]];H={text:'<span id="caap_targetgiftq_'+m+'" title="'+B+'" rlink="'+z+'" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';">'+
gifting.queue.records[m][l[h]]+"</span>",color:"blue",id:"",title:""};a+=caap.makeTd(H)}else a+=caap.makeTd({text:gifting.queue.records[m][l[h]],color:"black",id:"",title:""});x="Clicking this link will remove "+gifting.queue.records[m].name+"'s entry from the gift queue!";H={text:'<span id="caap_removeq_'+m+'" title="'+x+'" mname="" onmouseover="this.style.cursor=\'pointer\';" onmouseout="this.style.cursor=\'default\';" class="ui-icon ui-icon-circle-close">X</span>',color:"blue",id:"",title:""};
a+=caap.makeTd(H);a+="</tr>"}a+="</table>";$("#caap_giftQueue").html(a);C=function(u){utility.log(9,"Clicked",u.target.id);var q={rlink:"",arlink:""},v=0;for(v=0;v<u.target.attributes.length;v+=1)if(u.target.attributes[v].nodeName==="rlink"){q.rlink=u.target.attributes[v].nodeValue;q.arlink=q.rlink.replace("http://apps.facebook.com/castle_age/","")}utility.log(9,"visitUserIdLink",q);utility.ClickAjax(q.arlink)};$("#caap_top span[id*='caap_targetgiftq_']").unbind("click",C).click(C);C=function(u){utility.log(9,
"Clicked",u.target.id);var q=-1,v=0;v=false;for(v=0;v<u.target.attributes.length;v+=1)if(u.target.attributes[v].nodeName==="id")q=parseInt(u.target.attributes[v].nodeValue.replace("caap_removeq_",""),10);utility.log(9,"index",q);v=confirm("Are you sure you want to remove this queue entry?");if(v===true){gifting.queue.deleteIndex(q);caap.UpdateDashboard(true)}};$("#caap_top span[id*='caap_removeq_']").unbind("click",C).click(C);state.setItem("GiftQueueDashUpdate",false)}return true}catch(N){utility.error("ERROR in UpdateDashboard: "+
N);return false}},dbDisplayListener:function(b){b=b.target.options[b.target.selectedIndex].value;config.setItem("DBDisplay",b);caap.SetDisplay("infoMonster",false);caap.SetDisplay("infoTargets1",false);caap.SetDisplay("infoBattle",false);caap.SetDisplay("userStats",false);caap.SetDisplay("generalsStats",false);caap.SetDisplay("soldiersStats",false);caap.SetDisplay("itemStats",false);caap.SetDisplay("magicStats",false);caap.SetDisplay("giftStats",false);caap.SetDisplay("giftQueue",false);caap.SetDisplay("buttonMonster",
false);caap.SetDisplay("buttonTargets",false);caap.SetDisplay("buttonBattle",false);caap.SetDisplay("buttonGifting",false);caap.SetDisplay("buttonGiftQueue",false);switch(b){case "Target List":caap.SetDisplay("infoTargets1",true);caap.SetDisplay("buttonTargets",true);break;case "Battle Stats":caap.SetDisplay("infoBattle",true);caap.SetDisplay("buttonBattle",true);break;case "User Stats":caap.SetDisplay("userStats",true);break;case "Generals Stats":caap.SetDisplay("generalsStats",true);break;case "Soldier Stats":caap.SetDisplay("soldiersStats",
true);break;case "Item Stats":caap.SetDisplay("itemStats",true);break;case "Magic Stats":caap.SetDisplay("magicStats",true);break;case "Gifting Stats":caap.SetDisplay("giftStats",true);caap.SetDisplay("buttonGifting",true);break;case "Gift Queue":caap.SetDisplay("giftQueue",true);caap.SetDisplay("buttonGiftQueue",true);break;case "Monster":caap.SetDisplay("infoMonster",true);caap.SetDisplay("buttonMonster",true);break;default:}},refreshMonstersListener:function(){monster.flagFullReview()},liveFeedButtonListener:function(){utility.ClickAjax("army_news_feed.php")},
clearTargetsButtonListener:function(){caap.ReconRecordArray=[];caap.SaveRecon();caap.UpdateDashboard(true)},clearBattleButtonListener:function(){battle.clear();caap.UpdateDashboard(true)},clearGiftingButtonListener:function(){gifting.clear("history");caap.UpdateDashboard(true)},clearGiftQueueButtonListener:function(){gifting.clear("queue");caap.UpdateDashboard(true)},AddDBListener:function(){try{utility.log(1,"Adding listeners for caap_top");$("#caap_DBDisplay").length||caap.ReloadCastleAge();$("#caap_DBDisplay").change(this.dbDisplayListener);
$("#caap_refreshMonsters").click(this.refreshMonstersListener);$("#caap_liveFeed").click(this.liveFeedButtonListener);$("#caap_clearTargets").click(this.clearTargetsButtonListener);$("#caap_clearBattle").click(this.clearBattleButtonListener);$("#caap_clearGifting").click(this.clearGiftingButtonListener);$("#caap_clearGiftQueue").click(this.clearGiftQueueButtonListener);utility.log(8,"Listeners added for caap_top");return true}catch(b){utility.error("ERROR in AddDBListener: "+b);return false}},SetDisplay:function(b,
a){try{a===true?$("#caap_"+b).css("display","block"):$("#caap_"+b).css("display","none");return true}catch(c){utility.error("ERROR in SetDisplay: "+c);return false}},CheckBoxListener:function(b){try{var a=b.target.id.replace(/caap_/i,""),c="",d="",e={};utility.log(1,"Change: setting '"+a+"' to ",b.target.checked);config.setItem(a,b.target.checked);b.target.className&&caap.SetDisplay(b.target.className,b.target.checked);switch(a){case "AutoStatAdv":utility.log(9,"AutoStatAdv");if(b.target.checked){caap.SetDisplay("Status_Normal",
false);caap.SetDisplay("Status_Adv",true)}else{caap.SetDisplay("Status_Normal",true);caap.SetDisplay("Status_Adv",false)}state.setItem("statsMatch",true);break;case "HideAds":utility.log(9,"HideAds");b.target.checked?$(".UIStandardFrame_SidebarAds").css("display","none"):$(".UIStandardFrame_SidebarAds").css("display","block");break;case "HideAdsIframe":utility.log(9,"HideAdsIframe");b.target.checked?$("iframe[name*='fb_iframe']:first").parent().css("display","none"):$("iframe[name*='fb_iframe']:first").parent().css("display",
"block");caap.dashboardXY.x=state.getItem("caap_top_menuLeft","");caap.dashboardXY.y=state.getItem("caap_top_menuTop",$(caap.dashboardXY.selector).offset().top-10);e=caap.GetDashboardXY();caap.caapTopObject.css({top:e.y+"px",left:e.x+"px"});break;case "HideFBChat":utility.log(9,"HideFBChat");b.target.checked?$("div[class*='fbDockWrapper fbDockWrapperBottom fbDockWrapperRight']").css("display","none"):$("div[class*='fbDockWrapper fbDockWrapperBottom fbDockWrapperRight']").css("display","block");break;
case "BannerDisplay":utility.log(9,"BannerDisplay");b.target.checked?$("#caap_BannerHide").css("display","block"):$("#caap_BannerHide").css("display","none");break;case "IgnoreBattleLoss":utility.log(9,"IgnoreBattleLoss");b.target.checked&&utility.log(1,"Ignore Battle Losses has been enabled.");break;case "SetTitle":case "SetTitleAction":case "SetTitleName":utility.log(9,a);if(b.target.checked){if(config.getItem("SetTitleAction",false))if(d=$("#caap_activity_mess").html())c+=d.replace("Activity: ",
"")+" - ";if(config.getItem("SetTitleName",false))c+=caap.stats.PlayerName+" - ";document.title=c+caap.documentTitle}else document.title=caap.documentTitle;break;case "unlockMenu":utility.log(9,"unlockMenu");if(b.target.checked){$(":input[id^='caap_']").attr({disabled:true});caap.caapDivObject.css("cursor","move").draggable({stop:function(){caap.SaveControlXY()}});caap.caapTopObject.css("cursor","move").draggable({stop:function(){caap.SaveDashboardXY()}})}else{caap.caapDivObject.css("cursor","").draggable("destroy");
caap.caapTopObject.css("cursor","").draggable("destroy");$(":input[id^='caap_']").attr({disabled:false})}break;case "AutoElite":utility.log(9,"AutoElite");schedule.setItem("AutoEliteGetList",0);schedule.setItem("AutoEliteReqNext",0);state.setItem("AutoEliteEnd","");state.setItem("MyEliteTodo",[]);if(!state.getItem("FillArmy",false)){state.setItem(caap.friendListType.giftc.name+"Requested",false);state.setItem(caap.friendListType.giftc.name+"Responded",[])}break;case "AchievementMode":utility.log(9,
"AchievementMode");monster.flagReview();break;case "StatSpendAll":state.setItem("statsMatch",true);state.setItem("autoStatRuleLog",true);break;default:}return true}catch(g){utility.error("ERROR in CheckBoxListener: "+g);return false}},TextBoxListener:function(b){try{var a=b.target.id.replace(/caap_/i,"");utility.log(1,'Change: setting "'+a+'" to ',String(b.target.value));if(/Style+/.test(a))switch(a){case "StyleBackgroundLight":if(b.target.value.substr(0,1)!=="#")b.target.value="#"+b.target.value;
state.setItem("CustStyleBackgroundLight",b.target.value);break;case "StyleBackgroundDark":if(b.target.value.substr(0,1)!=="#")b.target.value="#"+b.target.value;state.setItem("CustStyleBackgroundDark",b.target.value);break;default:}else/AttrValue+/.test(a)&&state.setItem("statsMatch",true);config.setItem(a,String(b.target.value));return true}catch(c){utility.error("ERROR in TextBoxListener: "+c);return false}},NumberBoxListener:function(b){try{var a=b.target.id.replace(/caap_/i,"");utility.log(1,'Change: setting "'+
a+'" to ',parseFloat(b.target.value)||"");if(/Style+/.test(a))switch(a){case "StyleOpacityLight":state.setItem("CustStyleOpacityLight",b.target.value);break;case "StyleOpacityDark":state.setItem("CustStyleOpacityDark",b.target.value);break;default:}else if(/AttrValue+/.test(a))state.setItem("statsMatch",true);else if(/MaxToFortify/.test(a))monster.flagFullReview();else/Chain/.test(a)&&state.getItem("BattleChainId",0);config.setItem(a,parseFloat(b.target.value)||"");return true}catch(c){utility.error("ERROR in NumberBoxListener: "+
c);return false}},DropBoxListener:function(b){try{if(b.target.selectedIndex>0){var a=b.target.id.replace(/caap_/i,""),c=b.target.options[b.target.selectedIndex].value,d=b.target.options[b.target.selectedIndex].title;utility.log(1,'Change: setting "'+a+'" to "'+c+'" with title "'+d+'"');config.setItem(a,c);b.target.title=d;if(a==="WhenQuest"||a==="WhenBattle"||a==="WhenMonster"||a==="LevelUpGeneral"){caap.SetDisplay(a+"Hide",c!=="Never");if(a==="WhenBattle"||a==="WhenMonster"){caap.SetDisplay(a+"XStamina",
c==="At X Stamina");caap.SetDisplay("WhenBattleStayHidden1",config.getItem("WhenBattle","Never")==="Stay Hidden"&&config.getItem("WhenMonster","Never")!=="Stay Hidden");caap.SetDisplay("WhenMonsterStayHidden1",config.getItem("WhenMonster","Never")==="Stay Hidden"&&config.getItem("WhenBattle","Never")!=="Stay Hidden");if(a==="WhenBattle")c==="Never"?caap.SetDivContent("battle_mess","Battle off"):caap.SetDivContent("battle_mess","");else if(a==="WhenMonster")c==="Never"?caap.SetDivContent("monster_mess",
"Monster off"):caap.SetDivContent("monster_mess","")}a==="WhenQuest"&&caap.SetDisplay(a+"XEnergy",c==="At X Energy")}else if(a==="QuestArea"||a==="QuestSubArea"||a==="WhyQuest"){state.setItem("AutoQuest",caap.newAutoQuest());caap.ClearAutoQuest();if(a==="QuestArea")switch(c){case "Quest":$("#trQuestSubArea").css("display","table-row");caap.ChangeDropDownList("QuestSubArea",caap.landQuestList);break;case "Demi Quests":$("#trQuestSubArea").css("display","table-row");caap.ChangeDropDownList("QuestSubArea",
caap.demiQuestList);break;case "Atlantis":$("#trQuestSubArea").css("display","table-row");caap.ChangeDropDownList("QuestSubArea",caap.atlantisQuestList);break;default:}}else if(a==="BattleType")state.getItem("BattleChainId",0);else if(a==="TargetType"){state.getItem("BattleChainId",0);switch(c){case "Freshmeat":caap.SetDisplay("FreshmeatSub",true);caap.SetDisplay("UserIdsSub",false);caap.SetDisplay("RaidSub",false);break;case "Userid List":caap.SetDisplay("FreshmeatSub",false);caap.SetDisplay("UserIdsSub",
true);caap.SetDisplay("RaidSub",false);break;case "Raid":caap.SetDisplay("FreshmeatSub",true);caap.SetDisplay("UserIdsSub",false);caap.SetDisplay("RaidSub",true);break;default:caap.SetDisplay("FreshmeatSub",true);caap.SetDisplay("UserIdsSub",false);caap.SetDisplay("RaidSub",false)}}else if(/Attribute?/.test(a))state.setItem("statsMatch",true);else if(a==="DisplayStyle"){caap.SetDisplay(a+"Hide",c==="Custom");switch(c){case "CA Skin":config.setItem("StyleBackgroundLight","#E0C691");config.setItem("StyleBackgroundDark",
"#B09060");config.setItem("StyleOpacityLight",1);config.setItem("StyleOpacityDark",1);break;case "None":config.setItem("StyleBackgroundLight","white");config.setItem("StyleBackgroundDark","white");config.setItem("StyleOpacityLight",1);config.setItem("StyleOpacityDark",1);break;case "Custom":config.setItem("StyleBackgroundLight",state.getItem("CustStyleBackgroundLight","#E0C691"));config.setItem("StyleBackgroundDark",state.getItem("CustStyleBackgroundDark","#B09060"));config.setItem("StyleOpacityLight",
state.getItem("CustStyleOpacityLight",1));config.setItem("StyleOpacityDark",state.getItem("CustStyleOpacityDark",1));break;default:config.setItem("StyleBackgroundLight","#efe");config.setItem("StyleBackgroundDark","#fee");config.setItem("StyleOpacityLight",1);config.setItem("StyleOpacityDark",1)}caap.caapDivObject.css({background:config.getItem("StyleBackgroundDark","#fee"),opacity:config.getItem("StyleOpacityDark",1)});caap.caapTopObject.css({background:config.getItem("StyleBackgroundDark","#fee"),
opacity:config.getItem("StyleOpacityDark",1)})}}return true}catch(e){utility.error("ERROR in DropBoxListener: "+e);return false}},TextAreaListener:function(b){try{var a=b.target.id.replace(/caap_/i,"");utility.log(1,'Change: setting "'+a+'" to ',b.target.value);if(a==="orderbattle_monster"||a==="orderraid")monster.flagFullReview();else a==="BattleTargets"&&state.getItem("BattleChainId",0);caap.SaveBoxText(a);return true}catch(c){utility.error("ERROR in TextAreaListener: "+c);return false}},PauseListener:function(){$("#caap_div").css({background:config.getItem("StyleBackgroundDark",
"#fee"),opacity:"1","z-index":"3"});$("#caap_top").css({background:config.getItem("StyleBackgroundDark","#fee"),opacity:"1"});$("#caapPaused").css("display","block");state.setItem("caapPause","block")},RestartListener:function(){$("#caapPaused").css("display","none");$("#caap_div").css({background:config.getItem("StyleBackgroundLight","#efe"),opacity:config.getItem("StyleOpacityLight",1),"z-index":state.getItem("caap_div_zIndex","2"),cursor:""});$("#caap_top").css({background:config.getItem("StyleBackgroundLight",
"#efe"),opacity:config.getItem("StyleOpacityLight",1),"z-index":state.getItem("caap_top_zIndex","1"),cursor:""});$(":input[id*='caap_']").attr({disabled:false});$("#unlockMenu").attr("checked",false);state.setItem("caapPause","none");state.setItem("ReleaseControl",true);state.setItem("resetselectMonster",true);caap.waitingForDomLoad=false},ResetMenuLocationListener:function(){state.deleteItem("caap_div_menuLeft");state.deleteItem("caap_div_menuTop");state.deleteItem("caap_div_zIndex");caap.controlXY.x=
"";caap.controlXY.y=$(caap.controlXY.selector).offset().top;var b=caap.GetControlXY(true);caap.caapDivObject.css({cursor:"","z-index":"2",top:b.y+"px",left:b.x+"px"});state.deleteItem("caap_top_menuLeft");state.deleteItem("caap_top_menuTop");state.deleteItem("caap_top_zIndex");caap.dashboardXY.x="";caap.dashboardXY.y=$(caap.dashboardXY.selector).offset().top-10;b=caap.GetDashboardXY(true);caap.caapTopObject.css({cursor:"","z-index":"1",top:b.y+"px",left:b.x+"px"});$(":input[id^='caap_']").attr({disabled:false})},
FoldingBlockListener:function(b){try{var a=b.target.id.replace(/_Switch/i,""),c=document.getElementById(a);if(c.style.display==="block"){utility.log(2,"Folding: ",a);c.style.display="none";b.target.innerHTML=b.target.innerHTML.replace(/-/,"+");state.setItem("Control_"+a.replace(/caap_/i,""),"none")}else{utility.log(2,"Unfolding: ",a);c.style.display="block";b.target.innerHTML=b.target.innerHTML.replace(/\+/,"-");state.setItem("Control_"+a.replace(/caap_/i,""),"block")}return true}catch(d){utility.error("ERROR in FoldingBlockListener: "+
d);return false}},whatClickedURLListener:function(b){for(b=b.target;b&&!b.href;)b=b.parentNode;if(b&&b.href)state.setItem("clickUrl",b.href);else b&&!b.href&&utility.warn("whatClickedURLListener globalContainer no href",b)},whatFriendBox:function(b){utility.log(9,"whatFriendBox",b);b=b.target;for(var a=[],c="";b&&!b.id;)b=b.parentNode;if(b&&b.id){if((a=b.onclick.toString().match(/friendKeepBrowse\('([0-9]+)'/))&&a.length===2)c="?casuser="+a[1];state.setItem("clickUrl","http://apps.facebook.com/castle_age/keep.php"+
c)}},windowResizeListener:function(){if(window.location.href.indexOf("castle_age")){var b=caap.GetControlXY();caap.caapDivObject.css("left",b.x+"px");b=caap.GetDashboardXY();caap.caapTopObject.css("left",b.x+"px")}},targetList:["app_body","index","keep","generals","battle_monster","battle","battlerank","battle_train","arena","quests","raid","symbolquests","alchemy","goblin_emp","soldiers","item","land","magic","oracle","symbols","treasure_chest","gift","apprentice","news","friend_page","party","comments",
"army","army_news_feed","army_reqs","guild","guild_panel","guild_current_battles"],AddListeners:function(){try{utility.log(1,"Adding listeners for caap_div");if($("#caap_div").length===0)throw"Unable to find div for caap_div";$('#caap_div input:checkbox[id^="caap_"]').change(this.CheckBoxListener);$('#caap_div input[data-subtype="text"]').change(this.TextBoxListener);$('#caap_div input[data-subtype="number"]').change(this.NumberBoxListener);$("#unlockMenu").change(this.CheckBoxListener);$('#caap_div select[id^="caap_"]').change(this.DropBoxListener);
$('#caap_div textarea[id^="caap_"]').change(this.TextAreaListener);$('#caap_div a[id^="caap_Switch"]').click(this.FoldingBlockListener);$("#caap_FillArmy").click(function(){state.setItem("FillArmy",true);state.setItem("ArmyCount",0);state.setItem("FillArmyList",[]);state.setItem(caap.friendListType.giftc.name+"Responded",[]);state.setItem(caap.friendListType.facebook.name+"Responded",false)});$("#caap_StartedColorSelect").click(function(){var a="none";if($("#caap_ColorSelectorDiv1").css("display")===
"none")a="block";$("#caap_ColorSelectorDiv1").css("display",a)});$("#caap_StopedColorSelect").click(function(){var a="none";if($("#caap_ColorSelectorDiv2").css("display")==="none")a="block";$("#caap_ColorSelectorDiv2").css("display",a)});$("#caap_ResetMenuLocation").click(this.ResetMenuLocationListener);$("#caap_resetElite").click(function(){schedule.setItem("AutoEliteGetList",0);schedule.setItem("AutoEliteReqNext",0);state.setItem("AutoEliteEnd","");if(!state.getItem("FillArmy",false)){state.setItem(caap.friendListType.giftc.name+
"Requested",false);state.setItem(caap.friendListType.giftc.name+"Responded",[])}});$("#caapRestart").click(this.RestartListener);$("#caap_control").mousedown(this.PauseListener);$("#stopAutoQuest").click(function(){utility.log(1,"Change: setting stopAutoQuest and go to Manual");caap.ManualAutoQuest()});if($("#app46755028429_globalContainer").length===0)throw"Global Container not found";$("#app46755028429_globalContainer").find("a").bind("click",this.whatClickedURLListener);$("#app46755028429_globalContainer").find("div[id*='app46755028429_friend_box_']").bind("click",
this.whatFriendBox);$("#app46755028429_globalContainer").bind("DOMNodeInserted",function(a){var c=a.target.id.replace("app46755028429_","");config.getItem("HideAdsIframe",false)&&$("iframe[name*='fb_iframe']:first").parent().css("display","none");if($.inArray(c,caap.targetList)!==-1){utility.log(9,"Refreshing DOM Listeners",a.target.id);caap.waitingForDomLoad=false;$("#app46755028429_globalContainer").find("a").unbind("click",caap.whatClickedURLListener).bind("click",caap.whatClickedURLListener);
$("#app46755028429_globalContainer").find("div[id*='app46755028429_friend_box_']").unbind("click",caap.whatFriendBox).bind("click",caap.whatFriendBox);window.setTimeout(function(){caap.CheckResults()},100)}if(c==="gold_time_value"){var d=$(a.target).text().match(/([0-9]+):([0-9]+)/);utility.log(10,"gold_time_value",d);if(d&&d.length===3){caap.stats.gold.payTime.ticker=d[0];caap.stats.gold.payTime.minutes=parseInt(d[1],10);caap.stats.gold.payTime.seconds=parseInt(d[2],10)}}if(c==="energy_current_value"){d=
parseInt($(a.target).text(),10);var e=null,g=null;utility.log(9,"energy_current_value",d);if(utility.isNum(d)){e=caap.GetStatusNumbers(d+"/"+caap.stats.energy.max);g=caap.GetStatusNumbers(d+"/"+caap.stats.energyT.max);if(e&&g){caap.stats.energy=e;caap.stats.energyT=g}else utility.warn("Unable to get energy levels")}}if(c==="health_current_value"){d=parseInt($(a.target).text(),10);g=e=null;utility.log(9,"health_current_value",d);if(utility.isNum(d)){e=caap.GetStatusNumbers(d+"/"+caap.stats.health.max);
g=caap.GetStatusNumbers(d+"/"+caap.stats.healthT.max);if(e&&g){caap.stats.health=e;caap.stats.healthT=g}else utility.warn("Unable to get health levels")}}if(c==="stamina_current_value"){c=parseInt($(a.target).text(),10);e=d=null;utility.log(9,"stamina_current_value",c);if(utility.isNum(c)){d=caap.GetStatusNumbers(c+"/"+caap.stats.stamina.max);e=caap.GetStatusNumbers(c+"/"+caap.stats.staminaT.max);if(d){caap.stats.stamina=d;caap.stats.staminaT=e}else utility.warn("Unable to get stamina levels")}}a.target.id===
caap.dashboardXY.selector&&caap.caapTopObject.css("left",caap.GetDashboardXY().x+"px")});$(window).unbind("resize",this.windowResizeListener).bind("resize",this.windowResizeListener);utility.log(8,"Listeners added for caap_div");return true}catch(b){utility.error("ERROR in AddListeners: "+b);return false}},SetCheckResultsFunction:function(b){schedule.setItem("SetResultsFunctionTimer",20);state.setItem("ResultsFunction",b)},pageList:{index:{signaturePic:"gif",CheckResultsFunction:"CheckResults_index"},
battle_monster:{signaturePic:"tab_monster_list_on.gif",CheckResultsFunction:"CheckResults_fightList",subpages:["onMonster"]},onMonster:{signaturePic:"tab_monster_active.gif",CheckResultsFunction:"CheckResults_viewFight"},raid:{signaturePic:"tab_raid_on.gif",CheckResultsFunction:"CheckResults_fightList",subpages:["onRaid"]},onRaid:{signaturePic:"raid_map",CheckResultsFunction:"CheckResults_viewFight"},land:{signaturePic:"tab_land_on.gif",CheckResultsFunction:"CheckResults_land"},generals:{signaturePic:"tab_generals_on.gif",
CheckResultsFunction:"CheckResults_generals"},quests:{signaturePic:"tab_quest_on.gif",CheckResultsFunction:"CheckResults_quests"},symbolquests:{signaturePic:"demi_quest_on.gif",CheckResultsFunction:"CheckResults_quests"},monster_quests:{signaturePic:"tab_atlantis_on.gif",CheckResultsFunction:"CheckResults_quests"},gift_accept:{signaturePic:"gif",CheckResultsFunction:"CheckResults_gift_accept"},army:{signaturePic:"invite_on.gif",CheckResultsFunction:"CheckResults_army"},keep:{signaturePic:"tab_stats_on.gif",
CheckResultsFunction:"CheckResults_keep"},oracle:{signaturePic:"oracle_on.gif",CheckResultsFunction:"CheckResults_oracle"},battlerank:{signaturePic:"tab_battle_rank_on.gif",CheckResultsFunction:"CheckResults_battlerank"},war_rank:{signaturePic:"tab_war_on.gif",CheckResultsFunction:"CheckResults_war_rank"},achievements:{signaturePic:"tab_achievements_on.gif",CheckResultsFunction:"CheckResults_achievements"},battle:{signaturePic:"battle_on.gif",CheckResultsFunction:"CheckResults_battle"},soldiers:{signaturePic:"tab_soldiers_on.gif",
CheckResultsFunction:"CheckResults_soldiers"},item:{signaturePic:"tab_black_smith_on.gif",CheckResultsFunction:"CheckResults_item"},magic:{signaturePic:"tab_magic_on.gif",CheckResultsFunction:"CheckResults_magic"},gift:{signaturePic:"tab_gifts_on.gif",CheckResultsFunction:"CheckResults_gift"},view_class_progress:{signaturePic:"nm_class_whole_progress_bar.jpg",CheckResultsFunction:"CheckResults_view_class_progress"},guild_current_battles:{signaturePic:"tab_guild_current_battles_on.gif",CheckResultsFunction:"CheckResults_guild_current_battles"}},
AddExpDisplay:function(){try{var b=$("#app46755028429_st_2_5 strong"),a=null;if(!b.length){utility.warn("Unable to get experience array");return false}a=$("#caap_enl");if(a.length){utility.log(8,"Experience to Next Level already displayed. Updating.");a.html(this.stats.exp.dif)}else{utility.log(8,"Prepending Experience to Next Level to display");b.prepend("(<span id='caap_enl' style='color:red'>"+this.stats.exp.dif+"</span>) ")}this.SetDivContent("exp_mess","Experience to next level: "+this.stats.exp.dif);
return true}catch(c){utility.error("ERROR in AddExpDisplay: "+c);return false}},CheckResults:function(){try{if(!schedule.check("CheckResultsTimer"))return false;this.pageLoadOK=this.GetStats();this.AddExpDisplay();this.SetDivContent("level_mess","Expected next level: "+schedule.FormatTime(new Date(this.stats.indicators.enl)));if(config.getItem("DemiPointsFirst",false)&&config.getItem("WhenMonster","Never")!=="Never"||config.getItem("WhenBattle","Never")==="Demi Points Only")if(state.getItem("DemiPointsDone",
true))this.SetDivContent("demipoint_mess","Daily Demi Points: Done");else config.getItem("DemiPointsFirst",false)&&config.getItem("WhenMonster","Never")!=="Never"?this.SetDivContent("demipoint_mess","Daily Demi Points: First"):this.SetDivContent("demipoint_mess","Daily Demi Points: Only");else this.SetDivContent("demipoint_mess","");if(schedule.display("BlessingTimer"))schedule.check("BlessingTimer")?this.SetDivContent("demibless_mess","Demi Blessing = none"):this.SetDivContent("demibless_mess","Next Demi Blessing: "+
schedule.display("BlessingTimer"));schedule.setItem("CheckResultsTimer",1);state.getItem("page","");state.setItem("pageUserCheck","");var b=state.getItem("clickUrl","");utility.log(9,"Page url",b);if(b){var a=b.match(/user=([0-9]+)/);utility.log(6,"pageUserCheck",a);a&&state.setItem("pageUserCheck",a[1])}var c="None";a="";if(b.match(/\/[^\/]+.php/i)){c=b.match(/\/[^\/]+.php/i)[0].replace("/","").replace(".php","");utility.log(9,"Page match",c)}if(this.pageList[c]){a=c==="quests"&&this.stats.level<
8?"quest_back_1.jpg":this.pageList[c].signaturePic;if($("img[src*='"+a+"']").length){state.setItem("page",c);utility.log(9,"Page set value",c)}this.pageList[c].subpages&&this.pageList[c].subpages.forEach(function(f){if($("img[src*='"+caap.pageList[f].signaturePic+"']").length){c=state.setItem("page",f);utility.log(9,"Page pubpage",c)}})}var d=$("span[class*='result_body']");b="";if(d&&d.length)b=$.trim(d.text());if(c&&this.pageList[c]){utility.log(1,"Checking results for",c);typeof this[this.pageList[c].CheckResultsFunction]===
"function"?this[this.pageList[c].CheckResultsFunction](b):utility.warn("Check Results function not found",this.pageList[c])}else utility.log(1,"No results check defined for",c);monster.select();this.UpdateDashboard();if(general.List.length<=2){schedule.setItem("generals",0);schedule.setItem("allGenerals",0);this.CheckGenerals()}this.battlePage=this.stats.level<10?"battle_train,battle_off":"battle";config.getItem("AutoEliteIgnore",false)||utility.CheckForImage("elite_guard_add")&&state.getItem("AutoEliteEnd",
"NoArmy")!=="NoArmy"&&schedule.setItem("AutoEliteGetList",0);var e=state.getItem("ResultsFunction","");e&&!schedule.check("SetResultsFunctionTimer")&&this[e](b);return true}catch(g){utility.error("ERROR in CheckResults: "+g);return false}},CheckResults_generals:function(){try{var b="",a="";general.GetGenerals();if(b=general.GetEquippedStats()){a="<span title='Equipped Attack Power Index' style='font-size: 12px; font-weight: normal;'>EAPI:"+b.eapi.toFixed(2)+"</span> <span title='Equipped Defense Power Index' style='font-size: 12px; font-weight: normal;'>EDPI:"+
b.edpi.toFixed(2)+"</span> <span title='Equipped Mean Power Index' style='font-size: 12px; font-weight: normal;'>EMPI:"+b.empi.toFixed(2)+"</span>";$("#app46755028429_general_name_div_int").append(a)}schedule.setItem("generals",gm.getItem("CheckGenerals",24,hiddenVar)*3600,300);return true}catch(c){utility.error("ERROR in CheckResults_generals: "+c);return false}},GetStatusNumbers:function(b){try{var a=[];if(b===""||typeof b!=="string")throw"No text supplied for status numbers:"+b;a=b.match(/([0-9]+)\/([0-9]+)/);
if(a.length!==3)throw"Unable to match status numbers"+b;return{num:parseInt(a[1],10),max:parseInt(a[2],10),dif:parseInt(a[2],10)-parseInt(a[1],10)}}catch(c){utility.error("ERROR in GetStatusNumbers: "+c);return false}},stats:{FBID:0,account:"",PlayerName:"",level:0,army:{actual:0,capped:0},generals:{total:0,invade:0},attack:0,defense:0,points:{skill:0,favor:0},indicators:{bsi:0,lsi:0,sppl:0,api:0,dpi:0,mpi:0,htl:0,hrtl:0,enl:(new Date(2009,1,1)).getTime()},gold:{cash:0,bank:0,total:0,income:0,upkeep:0,
flow:0,payTime:{ticker:"0:00",minutes:0,seconds:0}},rank:{battle:0,battlePoints:0,war:0,warPoints:0},potions:{energy:0,stamina:0},energy:{num:0,max:0,dif:0},energyT:{num:0,max:0,dif:0},health:{num:0,max:0,dif:0},healthT:{num:0,max:0,dif:0},stamina:{num:0,max:0,dif:0},staminaT:{num:0,max:0,dif:0},exp:{num:0,max:0,dif:0},other:{qc:0,bww:0,bwl:0,te:0,tee:0,wlr:0,eer:0},achievements:{battle:{invasions:{won:0,lost:0,streak:0,ratio:0},duels:{won:0,lost:0,streak:0,ratio:0}},monster:{gildamesh:0,colossus:0,
sylvanas:0,keira:0,legion:0,skaar:0,lotus:0,dragons:0,cronus:0,sieges:0,genesis:0,gehenna:0,aurelius:0},other:{alchemy:0}},character:{warrior:{name:"Warrior",level:0,percent:0},rogue:{name:"Rogue",level:0,percent:0},mage:{name:"Mage",level:0,percent:0},cleric:{name:"Cleric",level:0,percent:0},warlock:{name:"Warlock",level:0,percent:0},ranger:{name:"Ranger",level:0,percent:0}}},LoadStats:function(){if(gm.getItem("stats.record","default")==="default")gm.setItem("stats.record",this.stats);else this.stats=
gm.getItem("stats.record",this.stats);utility.log(2,"Stats",this.stats);state.setItem("UserDashUpdate",true)},SaveStats:function(){gm.setItem("stats.record",this.stats);utility.log(2,"Stats",this.stats);state.setItem("UserDashUpdate",true)},GetStats:function(){try{var b=null,a=null,c=null,d=null,e=null,g=null,f=null,j=null,i=true,k=null,l=null,p=[],o=0,h=0,m=[],t=[],s=0,n=0;utility.log(8,"Getting Gold, Energy, Health, Stamina and Experience");b=$("#app46755028429_gold_current_value");if(b.length){utility.log(8,
"Getting current cash value");k=utility.NumberOnly(b.text());if(isNaN(k)){utility.warn("Cash value is not a number",k);i=false}else{this.stats.gold.cash=k;this.stats.gold.total=this.stats.gold.bank+this.stats.gold.cash}}else{utility.warn("Unable to get cashDiv");i=false}a=$("#app46755028429_st_2_2");if(a.length){utility.log(8,"Getting current energy levels");l=this.GetStatusNumbers(a.text());if((k=this.GetStatusNumbers(l.num+"/"+this.stats.energy.max))&&l){this.stats.energy=k;this.stats.energyT=l}else{utility.warn("Unable to get energy levels");
i=false}}else{utility.warn("Unable to get energyDiv");i=false}c=$("#app46755028429_st_2_3");if(c.length){utility.log(8,"Getting current health levels");l=this.GetStatusNumbers(c.text());if((k=this.GetStatusNumbers(l.num+"/"+this.stats.health.max))&&l){this.stats.health=k;this.stats.healthT=l}else{utility.warn("Unable to get health levels");i=false}}else{utility.warn("Unable to get healthDiv");i=false}d=$("#app46755028429_st_2_4");if(d.length){utility.log(8,"Getting current stamina values");l=this.GetStatusNumbers(d.text());
if((k=this.GetStatusNumbers(l.num+"/"+this.stats.stamina.max))&&l){this.stats.stamina=k;this.stats.staminaT=l}else{utility.warn("Unable to get stamina values");i=false}}else{utility.warn("Unable to get staminaDiv");i=false}e=$("#app46755028429_st_2_5");if(e.length){utility.log(8,"Getting current experience values");if(k=this.GetStatusNumbers(e.text()))this.stats.exp=k;else{utility.warn("Unable to get experience values");i=false}}else{utility.warn("Unable to get expDiv");i=false}g=$("#app46755028429_st_5");
if(g.length)if((p=g.text().match(/Level: ([0-9]+)!/))&&p.length===2){utility.log(8,"Getting current level");o=parseInt(p[1],10);if(o>this.stats.level){utility.log(1,"New level. Resetting Best Land Cost.");state.setItem("BestLandCost",0);state.setItem("KeepLevelUpGeneral",true);this.stats.level=o}}else{utility.warn("levelArray incorrect");i=false}else{utility.warn("Unable to get levelDiv");i=false}f=$("#app46755028429_main_bntp a[href*='army.php']");if(f.length)if((m=f.text().match(/My Army \(([0-9]+)\)/))&&
m.length===2){utility.log(8,"Getting current army count");this.stats.army.actual=parseInt(m[1],10);k=Math.min(this.stats.army.actual,501);if(k>=0&&k<=501)this.stats.army.capped=k;else{utility.warn("Army count not in limits");i=false}}else{utility.warn("armyArray incorrect");i=false}else{utility.warn("Unable to get armyDiv");i=false}j=$("#app46755028429_main_bntp a[href*='keep.php']");if(j.length)if((t=j.text().match(/My Stats \(\+([0-9]+)\)/))&&t.length===2){utility.log(8,"Getting current upgrade points");
h=parseInt(t[1],10);if(h>this.stats.points.skill){utility.log(1,"New points. Resetting AutoStat.");state.setItem("statsMatch",true)}this.stats.points.skill=h}else{utility.log(8,"No upgrade points found");this.stats.points.skill=0}else{utility.warn("Unable to get pointsDiv");i=false}if(this.stats.exp){utility.log(8,"Calculating time to next level");s=gm.getItem("expStaminaRatio",2.4,hiddenVar);n=state.getItem("AutoQuest",this.newAutoQuest()).expRatio||gm.getItem("expEnergyRatio",1.4,hiddenVar);this.stats.indicators.htl=
(this.stats.level*12.5-this.stats.stamina.max*s-this.stats.energy.max*n)/(12*(s+n));this.stats.indicators.hrtl=(this.stats.exp.dif-this.stats.stamina.num*s-this.stats.energy.num*n)/(12*(s+n));this.stats.indicators.enl=(new Date).getTime()+Math.ceil(this.stats.indicators.hrtl*60*60*1E3)}else{utility.warn("Could not calculate time to next level. Missing experience stats!");i=false}if(!i){utility.log(8,"Saving stats");this.SaveStats()}if(!i&&this.stats.energy.max===0&&this.stats.health.max===0&&this.stats.stamina.max===
0){utility.alert("Paused as this account may have been disabled!");utility.warn("Paused as this account may have been disabled!",this.stats);this.PauseListener()}return i}catch(r){utility.error("ERROR GetStats: "+r);return false}},CheckResults_keep:function(){try{var b=null,a=null,c=null,d=null,e=null,g=null,f=null,j=null,i=null,k=null,l=null,p=null,o=null,h=null,m=null,t=null;if($(".keep_attribute_section").length){utility.log(8,"Getting new values from player keep");b=$("img[src*='gif/rank']");
if(b.length){b=b.attr("src").split("/");this.stats.rank.battle=parseInt(b[b.length-1].match(/rank([0-9]+)\.gif/)[1],10)}else utility.warn("Using stored rank.");c=$(".keep_stat_title_inc");if(c.length){this.stats.PlayerName=c.text().match(/"(.+)",/)[1];state.setItem("PlayerName",this.stats.PlayerName)}else utility.warn("Using stored PlayerName.");if(this.stats.level>=100){a=$("img[src*='war_rank_']");if(a.length){a=a.attr("src").split("/");this.stats.rank.war=parseInt(a[a.length-1].match(/war_rank_([0-9]+)\.gif/)[1],
10)}else utility.warn("Using stored warRank.")}m=$(".attribute_stat_container");if(m.length===6){k=m.eq(0);if(k.length)this.stats.energy=this.GetStatusNumbers(this.stats.energyT.num+"/"+parseInt(k.text().match(/\s*([0-9]+).*/)[1],10));else utility.warn("Using stored energy value.");l=m.eq(1);if(l.length)this.stats.stamina=this.GetStatusNumbers(this.stats.staminaT.num+"/"+parseInt(l.text().match(/\s*([0-9]+).*/)[1],10));else utility.warn("Using stored stamina value.");if(this.stats.level>=10){p=m.eq(2);
if(p.length)this.stats.attack=parseInt(p.text().match(/\s*([0-9]+).*/)[1],10);else utility.warn("Using stored attack value.");o=m.eq(3);if(o.length)this.stats.defense=parseInt(o.text().match(/\s*([0-9]+).*/)[1],10);else utility.warn("Using stored defense value.")}h=m.eq(4);if(h.length)this.stats.health=this.GetStatusNumbers(this.stats.healthT.num+"/"+parseInt(h.text().match(/\s*([0-9]+).*/)[1],10));else utility.warn("Using stored health value.")}else utility.warn("Can't find stats containers! Using stored stats values.");
d=$(".statsTB .money");if(d.length){this.stats.gold.bank=utility.NumberOnly(d.text());this.stats.gold.total=this.stats.gold.bank+this.stats.gold.cash;d.attr({title:"Click to copy value to retrieve",style:"color: blue;"}).hover(function(){this.style.cursor="pointer"},function(){this.style.cursor="default"}).click(function(){$("input[name='get_gold']").val(caap.stats.gold.bank)})}else utility.warn("Using stored inStore.");e=$(".statsTB .positive:first");if(e.length)this.stats.gold.income=utility.NumberOnly(e.text());
else utility.warn("Using stored income.");g=$(".statsTB .negative");if(g.length)this.stats.gold.upkeep=utility.NumberOnly(g.text());else utility.warn("Using stored upkeep.");this.stats.gold.flow=this.stats.gold.income-this.stats.gold.upkeep;f=$("img[title='Energy Potion']");this.stats.potions.energy=f.length?f.parent().next().text().replace(RegExp("[^0-9\\.]","g"),""):0;j=$("img[title='Stamina Potion']");this.stats.potions.stamina=j.length?j.parent().next().text().replace(RegExp("[^0-9\\.]","g"),
""):0;i=$(".statsTB .keepTable1 tr:eq(0) td:last");if(i.length)this.stats.other.qc=parseInt(i.text(),10);else utility.warn("Using stored other.");i=$(".statsTB .keepTable1 tr:eq(1) td:last");if(i.length)this.stats.other.bww=parseInt(i.text(),10);else utility.warn("Using stored other.");i=$(".statsTB .keepTable1 tr:eq(2) td:last");if(i.length)this.stats.other.bwl=parseInt(i.text(),10);else utility.warn("Using stored other.");i=$(".statsTB .keepTable1 tr:eq(3) td:last");if(i.length)this.stats.other.te=
parseInt(i.text(),10);else utility.warn("Using stored other.");i=$(".statsTB .keepTable1 tr:eq(4) td:last");if(i.length)this.stats.other.tee=parseInt(i.text(),10);else utility.warn("Using stored other.");this.stats.other.wlr=this.stats.other.bwl!==0?this.stats.other.bww/this.stats.other.bwl:Infinity;this.stats.other.eer=this.stats.other.tee!==0?this.stats.other.tee/this.stats.other.te:Infinity;if(this.stats.level>=10){this.stats.indicators.bsi=(this.stats.attack+this.stats.defense)/this.stats.level;
this.stats.indicators.lsi=(this.stats.energy.max+2*this.stats.stamina.max)/this.stats.level;this.stats.indicators.sppl=(this.stats.energy.max+2*this.stats.stamina.max+this.stats.attack+this.stats.defense+this.stats.health.max-122)/this.stats.level;this.stats.indicators.api=this.stats.attack+this.stats.defense*0.7;this.stats.indicators.dpi=this.stats.defense+this.stats.attack*0.7;this.stats.indicators.mpi=(this.stats.indicators.api+this.stats.indicators.dpi)/2}schedule.setItem("keep",gm.getItem("CheckKeep",
1,hiddenVar)*3600,300);this.SaveStats()}else(t=$("a[href*='keep.php?user=']"))&&t.length?utility.log(1,"On another player's keep",t.attr("href").match(/user=([0-9]+)/)[1]):utility.warn("Attribute section not found and not identified as another player's keep!");return true}catch(s){utility.error("ERROR in CheckResults_keep: "+s);return false}},CheckResults_oracle:function(){try{var b=null,a="",c=[],d=false;b=$(".title_action");if(b.length){a=b.text();if((c=a.match(/\s*You have zero favor points!\s*/))&&
c.length===1){utility.log(1,"Got number of Favor Points.");this.stats.points.favor=0;d=true}else if((c=a.match(/\s*You have a favor point!\s*/))&&c.length===1){utility.log(1,"Got number of Favor Points.");this.stats.points.favor=1;d=true}else if((c=a.match(/\s*You have ([0-9]+) favor points!\s*/))&&c.length===2){utility.log(1,"Got number of Favor Points.");this.stats.points.favor=parseInt(c[1],10);d=true}else utility.warn("Favor Points RegExp not matched.")}else utility.warn("Favor Points div not found.");
d&&this.SaveStats();schedule.setItem("oracle",gm.getItem("CheckOracle",24,hiddenVar)*3600,300);return true}catch(e){utility.error("ERROR in CheckResults_oracle: "+e);return false}},CheckResults_soldiers:function(){try{$("div[class='eq_buy_costs_int']").find("select[name='amount']:first option[value='5']").attr("selected","selected");town.GetItems("soldiers");schedule.setItem("soldiers",gm.getItem("CheckSoldiers",72,hiddenVar)*3600,300);return true}catch(b){utility.error("ERROR in CheckResults_soldiers: "+
b);return false}},CheckResults_item:function(){try{$("div[class='eq_buy_costs_int']").find("select[name='amount']:first option[value='5']").attr("selected","selected");town.GetItems("item");schedule.setItem("item",gm.getItem("CheckItem",72,hiddenVar)*3600,300);return true}catch(b){utility.error("ERROR in CheckResults_item: "+b);return false}},CheckResults_magic:function(){try{$("div[class='eq_buy_costs_int']").find("select[name='amount']:first option[value='5']").attr("selected","selected");town.GetItems("magic");
schedule.setItem("magic",gm.getItem("CheckMagic",72,hiddenVar)*3600,300);return true}catch(b){utility.error("ERROR in CheckResults_magic: "+b);return false}},CheckResults_gift:function(){try{gifting.gifts.populate();schedule.setItem("gift",gm.getItem("CheckGift",72,hiddenVar)*3600,300);return true}catch(b){utility.error("ERROR in CheckResults_gift: "+b);return false}},CheckResults_battlerank:function(){try{var b=null,a="",c=[];b=$("div[style*='battle_rank_banner.jpg']");if(b.length){a=b.text();if((c=
a.match(/.*with (.*) Battle Points.*/))&&c.length===2){utility.log(1,"Got Battle Rank Points.");this.stats.rank.battlePoints=utility.NumberOnly(c[1]);this.SaveStats()}else utility.warn("Battle Rank Points RegExp not matched.")}else utility.warn("Battle Rank Points div not found.");schedule.setItem("battlerank",gm.getItem("CheckBattleRank",48,hiddenVar)*3600,300);return true}catch(d){utility.error("ERROR in CheckResults_battlerank: "+d);return false}},CheckResults_war_rank:function(){try{var b=null,
a="",c=[];b=$("div[style*='war_rank_banner.jpg']");if(b.length){a=b.text();if((c=a.match(/.*with (.*) War Points.*/))&&c.length===2){utility.log(1,"Got War Rank Points.");this.stats.rank.warPoints=utility.NumberOnly(c[1]);this.SaveStats()}else utility.warn("War Rank Points RegExp not matched.")}else utility.warn("War Rank Points div not found.");schedule.setItem("warrank",gm.getItem("CheckWarRank",48,hiddenVar)*3600,300);return true}catch(d){utility.error("ERROR in CheckResults_war_rank: "+d);return false}},
CheckResults_achievements:function(){try{var b=null,a=null;if((b=$("#app46755028429_achievements_2"))&&b.length)if((a=b.find("td div"))&&a.length===6){this.stats.achievements.battle.invasions.won=utility.NumberOnly(a.eq(0).text());this.stats.achievements.battle.duels.won=utility.NumberOnly(a.eq(1).text());this.stats.achievements.battle.invasions.lost=utility.NumberOnly(a.eq(2).text());this.stats.achievements.battle.duels.lost=utility.NumberOnly(a.eq(3).text());this.stats.achievements.battle.invasions.streak=
parseInt(a.eq(4).text(),10);this.stats.achievements.battle.duels.streak=parseInt(a.eq(5).text(),10);this.stats.achievements.battle.invasions.ratio=this.stats.achievements.battle.invasions.lost?this.stats.achievements.battle.invasions.won/this.stats.achievements.battle.invasions.lost:Infinity;this.stats.achievements.battle.duels.ratio=this.stats.achievements.battle.invasions.lost?this.stats.achievements.battle.duels.won/this.stats.achievements.battle.duels.lost:Infinity}else utility.warn("Battle Achievements problem.");
else utility.warn("Battle Achievements not found.");if((b=$("#app46755028429_achievements_3"))&&b.length)if((a=b.find("td div"))&&a.length===13){this.stats.achievements.monster.gildamesh=utility.NumberOnly(a.eq(0).text());this.stats.achievements.monster.lotus=utility.NumberOnly(a.eq(1).text());this.stats.achievements.monster.colossus=utility.NumberOnly(a.eq(2).text());this.stats.achievements.monster.dragons=utility.NumberOnly(a.eq(3).text());this.stats.achievements.monster.sylvanas=utility.NumberOnly(a.eq(4).text());
this.stats.achievements.monster.cronus=utility.NumberOnly(a.eq(5).text());this.stats.achievements.monster.keira=utility.NumberOnly(a.eq(6).text());this.stats.achievements.monster.sieges=utility.NumberOnly(a.eq(7).text());this.stats.achievements.monster.legion=utility.NumberOnly(a.eq(8).text());this.stats.achievements.monster.genesis=utility.NumberOnly(a.eq(9).text());this.stats.achievements.monster.skaar=utility.NumberOnly(a.eq(10).text());this.stats.achievements.monster.gehenna=utility.NumberOnly(a.eq(11).text());
this.stats.achievements.monster.aurelius=utility.NumberOnly(a.eq(12).text())}else utility.warn("Monster Achievements problem.");else utility.warn("Monster Achievements not found.");if((b=$("#app46755028429_achievements_4"))&&b.length){if((a=b.find("td div"))&&a.length===1)this.stats.achievements.other.alchemy=utility.NumberOnly(a.eq(0).text());else utility.warn("Other Achievements problem.");this.SaveStats()}else utility.warn("Other Achievements not found.");schedule.setItem("achievements",gm.getItem("CheckAchievements",
72,hiddenVar)*3600,300);return true}catch(c){utility.error("ERROR in CheckResults_achievements: "+c);return false}},CheckResults_view_class_progress:function(){try{var b=null,a="";if((b=$("#app46755028429_choose_class_screen div[class*='banner_']"))&&b.length===6){b.each(function(){if((a=$(this).attr("class").replace("banner_",""))&&typeof caap.stats.character[a]==="object"){caap.stats.character[a].percent=utility.NumberOnly($(this).find("img[src*='progress']").css("width"));caap.stats.character[a].level=
utility.NumberOnly($(this).children().eq(2).text())}else utility.warn("Problem character class name",a)});this.SaveStats()}else utility.warn("Problem with character class records",b);schedule.setItem("view_class_progress",gm.getItem("CheckClassProgress",48,hiddenVar)*3600,300);return true}catch(c){utility.error("ERROR in CheckResults_view_class_progress: "+c);return false}},MaxEnergyQuest:function(){var b=this.stats.energy.max,a=config.getItem("IdleGeneral","Use Current");if(a!=="Use Current")b=general.GetEnergyMax(a);
if(a!=="Use Current"&&!b){utility.log(1,"Changing to idle general to get Max energy");if(general.Select("IdleGeneral"))return true}if(this.stats.energy.num>=b)return this.Quests();return false},QuestAreaInfo:{"Land of Fire":{clas:"quests_stage_1",base:"land_fire",next:"Land of Earth",area:"",list:"",boss:"Heart of Fire"},"Land of Earth":{clas:"quests_stage_2",base:"land_earth",next:"Land of Mist",area:"",list:"",boss:"Gift of Earth"},"Land of Mist":{clas:"quests_stage_3",base:"land_mist",next:"Land of Water",
area:"",list:"",boss:"Eye of the Storm"},"Land of Water":{clas:"quests_stage_4",base:"land_water",next:"Demon Realm",area:"",list:"",boss:"A Look into the Darkness"},"Demon Realm":{clas:"quests_stage_5",base:"land_demon_realm",next:"Undead Realm",area:"",list:"",boss:"The Rift"},"Undead Realm":{clas:"quests_stage_6",base:"land_undead_realm",next:"Underworld",area:"",list:"",boss:"Undead Embrace"},Underworld:{clas:"quests_stage_7",base:"tab_underworld",next:"Kingdom of Heaven",area:"",list:"",boss:"Confrontation"},
"Kingdom of Heaven":{clas:"quests_stage_8",base:"tab_heaven",next:"Ivory City",area:"",list:"",boss:"Archangels Wrath"},"Ivory City":{clas:"quests_stage_9",base:"tab_ivory",next:"Earth II",area:"",list:"",boss:"Entrance to the Throne"},"Earth II":{clas:"quests_stage_10",base:"tab_earth2",next:"Ambrosia",area:"Demi Quests",list:"demiQuestList",boss:"Lion's Rebellion"},Ambrosia:{clas:"symbolquests_stage_1",next:"Malekus",area:"",list:""},Malekus:{clas:"symbolquests_stage_2",next:"Corvintheus",area:"",
list:""},Corvintheus:{clas:"symbolquests_stage_3",next:"Aurora",area:"",list:""},Aurora:{clas:"symbolquests_stage_4",next:"Azeron",area:"",list:""},Azeron:{clas:"symbolquests_stage_5",next:"Atlantis",area:"Atlantis",list:"atlantisQuestList"},Atlantis:{clas:"monster_quests_stage_1",next:"",area:"",list:""}},demiQuestTable:{Ambrosia:"energy",Malekus:"attack",Corvintheus:"defense",Aurora:"health",Azeron:"stamina"},Quests:function(){try{var b=state.getItem("storeRetrieve","");if(b)if(b==="general"){if(general.Select("BuyGeneral"))return true;
state.setItem("storeRetrieve","");return true}else return this.RetrieveFromBank(b);this.SetDivContent("quest_mess","");var a=config.getItem("WhenQuest","Never");if(a==="Never"){this.SetDivContent("quest_mess","Questing off");return false}if(a==="Not Fortifying"){var c=config.getItem("MaxHealthtoQuest",0);if(!c){this.SetDivContent("quest_mess",'<span style="font-weight: bold;">No valid over fortify %</span>');return false}var d=state.getItem("targetFromfortify","");if(d){this.SetDivContent("quest_mess",
"No questing until attack target "+d+" health exceeds "+config.getItem("MaxToFortify",0)+"%");return false}var e=state.getItem("targetFrombattle_monster","");if(!e){var g=monster.getItem(e).fortify;if(!g)if(g<c){this.SetDivContent("quest_mess","No questing until fortify target "+e+" health exceeds "+c+"%");return false}}}if(state.getItem("AutoQuest",this.newAutoQuest()).name){if(!this.CheckEnergy(state.getItem("AutoQuest",this.newAutoQuest()).energy,a,"quest_mess"))return false}else{if(config.getItem("WhyQuest",
"Never")==="Manual"){this.SetDivContent("quest_mess","Pick quest manually.");return false}this.SetDivContent("quest_mess","Searching for quest.");utility.log(1,"Searching for quest")}if(state.getItem("AutoQuest",this.newAutoQuest()).general==="none"||config.getItem("ForceSubGeneral",false)){if(general.Select("SubQuestGeneral"))return true}else if(general.LevelUpCheck("QuestGeneral")){if(general.Select("LevelUpGeneral"))return true;utility.log(1,"Using level up general")}switch(config.getItem("QuestArea",
"Quest")){case "Quest":b=false;if(this.stats.level>7){var f=this.QuestAreaInfo[config.getItem("QuestSubArea","Land of Fire")].base;b=f==="tab_underworld"||f==="tab_ivory"||f==="tab_earth2"?utility.NavigateTo("quests,jobs_tab_more.gif,"+f+"_small.gif",f+"_big"):f==="tab_heaven"?utility.NavigateTo("quests,jobs_tab_more.gif,"+f+"_small2.gif",f+"_big2.gif"):f==="land_demon_realm"||f==="land_undead_realm"?utility.NavigateTo("quests,jobs_tab_more.gif,"+f+".gif",f+"_sel"):utility.NavigateTo("quests,jobs_tab_back.gif,"+
f+".gif",f+"_sel")}else b=utility.NavigateTo("quests","quest_back_1.jpg");if(b)return true;break;case "Demi Quests":if(utility.NavigateTo("quests,symbolquests","demi_quest_on.gif"))return true;var j=config.getItem("QuestSubArea","Ambrosia");if(nHtml.FindByAttrContains(document.body,"img","src","deity_"+this.demiQuestTable[j]).style.height!=="160px")return utility.NavigateTo("deity_"+this.demiQuestTable[j]);break;case "Atlantis":if(!utility.CheckForImage("tab_atlantis_on.gif"))return utility.NavigateTo("quests,monster_quests");
break;default:}var i=utility.CheckForImage("quick_switch_button.gif");if(i&&!config.getItem("ForceSubGeneral",false)){utility.log(1,"Clicking on quick switch general button.");utility.Click(i);return general.quickSwitch=true}general.quickSwitch&&general.GetEquippedStats();f="";var k=nHtml.FindByAttrContains(document.body,"form","id","itemBuy");if(k){state.setItem("storeRetrieve","general");if(general.Select("BuyGeneral"))return true;state.setItem("storeRetrieve","");f=k.textContent.replace(/.*\$/,
"").replace(/[^0-9]{3,}.*/,"");utility.log(1,"costToBuy",f);if(this.stats.gold.cash<f)if(this.stats.gold.cash+(this.stats.gold.bank-config.getItem("minInStore",0))>=f){utility.log(1,"Trying to retrieve",f-this.stats.gold.cash);state.setItem("storeRetrieve",f-this.stats.gold.cash);return this.RetrieveFromBank(f-this.stats.gold.cash)}else{utility.log(1,"Cant buy requires, stopping quest");this.ManualAutoQuest();return false}if(i=utility.CheckForImage("quick_buy_button.jpg")){utility.log(1,"Clicking on quick buy button.");
utility.Click(i);return true}utility.warn("Cant find buy button");return false}if(i=utility.CheckForImage("quick_buy_button.jpg")){state.setItem("storeRetrieve","general");if(general.Select("BuyGeneral"))return true;state.setItem("storeRetrieve","");f=i.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.firstChild.data.replace(RegExp("[^0-9]","g"),"");utility.log(1,"costToBuy",f);if(this.stats.gold.cash<
f)if(this.stats.gold.cash+(this.stats.gold.bank-config.getItem("minInStore",0))>=f){utility.log(1,"Trying to retrieve: ",f-this.stats.gold.cash);state.setItem("storeRetrieve",f-this.stats.gold.cash);return this.RetrieveFromBank(f-this.stats.gold.cash)}else{utility.log(1,"Cant buy General, stopping quest");this.ManualAutoQuest();return false}utility.log(1,"Clicking on quick buy general button.");utility.Click(i);return true}var l=this.CheckResults_quests(true);if(!state.getItem("AutoQuest",this.newAutoQuest()).name){utility.log(1,
"Could not find AutoQuest.");this.SetDivContent("quest_mess","Could not find AutoQuest.");return false}var p=state.getItem("AutoQuest",this.newAutoQuest()).name;if(state.getItem("AutoQuest",this.newAutoQuest()).name!==p){utility.log(1,"New AutoQuest found.");this.SetDivContent("quest_mess","New AutoQuest found.");return true}if(l.tr!==undefined){if(config.getItem("QuestSubArea","Atlantis")==="Atlantis"){utility.log(1,"Cant buy Atlantis items, stopping quest");this.ManualAutoQuest();return false}var o=
nHtml.FindByAttrContains(l.tr,"div","style","background-color");if(o)if(o.style.backgroundColor==="rgb(158, 11, 15)"){utility.log(3," background.style.backgroundColor",o.style.backgroundColor);state.setItem("storeRetrieve","general");if(general.Select("BuyGeneral"))return true;state.setItem("storeRetrieve","");if(o.firstChild.firstChild.title){utility.log(1,"Clicking to buy",o.firstChild.firstChild.title);utility.Click(o.firstChild.firstChild);return true}}}else{utility.warn("Can not buy quest item");
return false}var h=state.getItem("AutoQuest",this.newAutoQuest()).general;if(h==="none"||config.getItem("ForceSubGeneral",false)){if(general.Select("SubQuestGeneral"))return true}else if(h&&h!==general.GetCurrent())if(general.LevelUpCheck("QuestGeneral")){if(general.Select("LevelUpGeneral"))return true;utility.log(1,"Using level up general")}else if(l.genDiv!==undefined){utility.log(1,"Clicking on general",h);utility.Click(l.genDiv);return true}else{utility.warn("Can not click on general",h);return false}if(l.click!==
undefined){utility.log(1,"Clicking auto quest",p);state.setItem("ReleaseControl",true);utility.Click(l.click,1E4);this.ShowAutoQuest();return true}else{utility.warn("Can not click auto quest",p);return false}}catch(m){utility.error("ERROR in Quests: "+m);return false}},questName:null,CheckResults_symbolquests:function(){try{var b=null,a=[],c=true;if((b=$("div[id*='app46755028429_symbol_desc_symbolquests']"))&&b.length===5){b.each(function(){var e=utility.NumberOnly($(this).children().next().eq(1).children().children().next().text());
if(utility.isNum(e))a.push(e);else{c=false;utility.warn("Demi-Power temp text problem",e)}});utility.log(2,"Points",a);if(c){this.demi.ambrosia.power.total=a[0];this.demi.malekus.power.total=a[1];this.demi.corvintheus.power.total=a[2];this.demi.aurora.power.total=a[3];this.demi.azeron.power.total=a[4];schedule.setItem("symbolquests",gm.getItem("CheckSymbolQuests",24,hiddenVar)*3600,300);this.SaveDemi()}}else utility.warn("Demi demiDiv problem",b);return true}catch(d){utility.error("ERROR in CheckResults_symbolquests: "+
d);return false}},isBossQuest:function(b){try{var a="",c=false;for(a in this.QuestAreaInfo)if(this.QuestAreaInfo.hasOwnProperty(a))if(this.QuestAreaInfo.boss&&this.QuestAreaInfo.boss===b){c=true;break}return c}catch(d){utility.error("ERROR in isBossQuest: "+d);return false}},CheckResults_quests:function(b){try{if($("#app46755028429_quest_map_container").length){var a=$("div[id*='app46755028429_meta_quest_']");a&&a.length&&a.each(function(){$(this).find("img[src*='_completed']").length||$(this).find("img[src*='_locked']").length||
$("div[id='app46755028429_quest_wrapper_"+$(this).attr("id").replace("app46755028429_meta_quest_","")+"']").css("display","block")})}var c=config.getItem("WhyQuest","Manual");b===true&&c!=="Manual"&&state.setItem("AutoQuest",this.newAutoQuest());var d=a=0,e=document.body,g=null,f=0;if(utility.CheckForImage("demi_quest_on.gif")){this.CheckResults_symbolquests();g=document.evaluate(".//div[contains(@id,'symbol_displaysymbolquest')]",e,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);g.snapshotLength<=
0&&utility.warn("Failed to find symbol_displaysymbolquest");for(f=0;f<g.snapshotLength;f+=1){e=g.snapshotItem(f);if(e.style.display!=="none")break}}g=document.evaluate(".//div[contains(@class,'quests_background')]",e,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(g.snapshotLength<=0){utility.warn("Failed to find quests_background");return false}var j=false;if($(e).find("input[src*='alchemy_summon']").length){j=true;this.isBossQuest(state.getItem("AutoQuest",this.newAutoQuest()).name)&&config.getItem("GetOrbs",
false)&&c!=="Manual"&&state.setItem("AutoQuest",this.newAutoQuest())}var i={click:undefined,tr:undefined,genDiv:undefined};for(f=0;f<g.snapshotLength;f+=1){e=g.snapshotItem(f);if(this.questName=this.GetQuestName(e)){var k=null,l=null,p=null,o=nHtml.GetText(e),h=o.match(/\+([0-9]+)/);if(h&&h.length===2)p=utility.NumberOnly(h[1]);else{var m=$("div[class='quest_experience']");if(m&&m.length)p=utility.NumberOnly(m.text());else utility.warn("Can't find experience for",this.questName)}var t=this.questName.indexOf("<br>");
if(t>=0)this.questName=this.questName.substring(0,t);var s=o.match(/([0-9]+)\s+energy/i);if(s&&s.length===2)l=utility.NumberOnly(s[1]);else{var n=nHtml.FindByAttrContains(e,"div","className","quest_req");if(n)l=n.getElementsByTagName("b")[0]}if(l){var r=utility.RemoveHtmlJunk(o).match(/\$([0-9,]+)\s*-\s*\$([0-9,]+)/i),w=0,D=0;if(r&&r.length===3){w=utility.NumberOnly(r[1]);D=utility.NumberOnly(r[2]);k=(w+D)/2}else if((r=utility.RemoveHtmlJunk(o).match(/\$([0-9,]+)mil\s*-\s*\$([0-9,]+)mil/i))&&r.length===
3){w=utility.NumberOnly(r[1])*1E6;D=utility.NumberOnly(r[2])*1E6;k=(w+D)/2}else utility.warn("No money found for",this.questName,o);var x=$(e).find("input[name*='Do']");if(x&&x.length){x=x.get(0);var A=null;if(this.isBossQuest(this.questName))A=$("div[class='quests_background_sub']").length?"100":"0";else{var z=o.match(/([0-9]+)%/);if(z&&z.length===2)A=z[1];else utility.warn("Influence div not found.",z)}A||utility.warn("No influence found for",this.questName,o);w="none";D=null;if(A&&A<100)if(D=nHtml.FindByAttrContains(e,
"div","className","quest_act_gen"))if(D=nHtml.FindByAttrContains(D,"img","src","jpg"))w=D.title;var B="subquest";if(e.className==="quests_background")B="primary";else if(e.className==="quests_background_special")B="boss";f===0&&utility.log(1,"Adding Quest Labels and Listeners");this.LabelQuests(e,l,k,p,x);utility.log(9,"QuestSubArea",config.getItem("QuestSubArea","Atlantis"));if(this.CheckCurrentQuestArea(config.getItem("QuestSubArea","Atlantis"))){if(config.getItem("GetOrbs",false)&&B==="boss"&&
c!=="Manual")if(!j){this.updateAutoQuest("name",this.questName);b=true}switch(c){case "Advancement":if(A){if(!state.getItem("AutoQuest",this.newAutoQuest()).name&&B==="primary"&&utility.NumberOnly(A)<100){this.updateAutoQuest("name",this.questName);b=true}}else utility.warn("Can't find influence for",this.questName,A);break;case "Max Influence":if(A){if(!state.getItem("AutoQuest",this.newAutoQuest()).name&&utility.NumberOnly(A)<100){this.updateAutoQuest("name",this.questName);b=true}}else utility.warn("Can't find influence for",
this.questName,A);break;case "Max Experience":d=Math.floor(p/l*100)/100;if(a<d){this.updateAutoQuest("name",this.questName);b=true}break;case "Max Gold":d=Math.floor(k/l*10)/10;if(a<d){this.updateAutoQuest("name",this.questName);b=true}break;default:}utility.log(5,"Setting AutoQuest?",state.getItem("AutoQuest",this.newAutoQuest()),this.questName);if(state.getItem("AutoQuest",this.newAutoQuest()).name===this.questName){a=d;k=p/l;utility.log(1,"Setting AutoQuest",this.questName);var G=this.newAutoQuest();
G.name=this.questName;G.energy=l;G.general=w;G.expRatio=k;state.setItem("AutoQuest",G);utility.log(2,"CheckResults_quests",state.getItem("AutoQuest",this.newAutoQuest()));this.ShowAutoQuest();i.click=x;i.tr=e;i.genDiv=D}}}else utility.warn("No button found for",this.questName)}else utility.warn("Can't find energy for",this.questName)}}if(b){if(state.getItem("AutoQuest",this.newAutoQuest()).name){utility.log(2,"CheckResults_quests(pickQuestTF)",state.getItem("AutoQuest",this.newAutoQuest()));this.ShowAutoQuest();
return i}if((c==="Max Influence"||c==="Advancement")&&config.getItem("switchQuestArea",true)){var y=config.getItem("QuestSubArea","Land Of Fire");utility.log(9,"QuestSubArea",y);if(y&&this.QuestAreaInfo[y]&&this.QuestAreaInfo[y].next){config.setItem("QuestSubArea",this.QuestAreaInfo[y].next);if(this.QuestAreaInfo[y].area&&this.QuestAreaInfo[y].list){config.setItem("QuestArea",this.QuestAreaInfo[y].area);this.ChangeDropDownList("QuestSubArea",this[this.QuestAreaInfo[y].list])}}else{utility.log(1,"Setting questing to manual");
this.ManualAutoQuest()}utility.log(1,"UpdateQuestGUI: Setting drop down menus");this.SelectDropOption("QuestArea",config.getItem("QuestArea","Quest"));this.SelectDropOption("QuestSubArea",config.getItem("QuestSubArea","Land Of Fire"));return false}utility.log(1,"Finished QuestArea.");this.ManualAutoQuest()}return false}catch(F){utility.error("ERROR in CheckResults_quests: "+F);this.ManualAutoQuest();return false}},ClassToQuestArea:{quests_stage_1:"Land of Fire",quests_stage_2:"Land of Earth",quests_stage_3:"Land of Mist",
quests_stage_4:"Land of Water",quests_stage_5:"Demon Realm",quests_stage_6:"Undead Realm",quests_stage_7:"Underworld",quests_stage_8:"Kingdom of Heaven",quests_stage_9:"Ivory City",quests_stage_10:"Earth II",symbolquests_stage_1:"Ambrosia",symbolquests_stage_2:"Malekus",symbolquests_stage_3:"Corvintheus",symbolquests_stage_4:"Aurora",symbolquests_stage_5:"Azeron",monster_quests_stage_1:"Atlantis"},CheckCurrentQuestArea:function(b){try{var a=false;if(this.stats.level<8){if(utility.CheckForImage("quest_back_1.jpg"))a=
true}else if(b&&this.QuestAreaInfo[b])if($("div[class*='"+this.QuestAreaInfo[b].clas+"']").length)a=true;return a}catch(c){utility.error("ERROR in CheckCurrentQuestArea: "+c);return false}},GetQuestName:function(b){try{var a=nHtml.FindByAttrXPath(b,"div","@class='quest_desc' or @class='quest_sub_title'");if(!a){utility.log(2,"Can't find quest description or sub-title");return false}if(a.innerHTML.toString().match(/LOCK/)){utility.log(2,"Quest locked",a);return false}var c=a.getElementsByTagName("b")[0];
if(!c){utility.warn("Can't get bolded member out of",a.innerHTML.toString());return false}this.questName=$.trim(c.innerHTML.toString()).stripHTML();if(!this.questName){utility.warn("No quest name for this row");return false}return this.questName}catch(d){utility.error("ERROR in GetQuestName: "+d);return false}},CheckEnergy:function(b,a,c){try{if(!this.stats.energy||!b)return false;if(a==="Energy Available"||a==="Not Fortifying"){if(this.stats.energy.num>=b)return true;if(c)this.SetDivContent(c,"Waiting for more energy: "+
this.stats.energy.num+"/"+(b?b:""))}else if(a==="At X Energy"){if(this.InLevelUpMode()&&this.stats.energy.num>=b){c&&this.SetDivContent(c,"Burning all energy to level up");return true}var d=config.getItem("XQuestEnergy",1);this.stats.energy.num>=d&&state.setItem("AtXQuestEnergy",true);if(this.stats.energy.num>=b)if(state.getItem("AtXQuestEnergy",false)&&this.stats.energy.num>=config.getItem("XMinQuestEnergy",0)){this.SetDivContent(c,"At X energy. Burning to "+config.getItem("XMinQuestEnergy",0));
return true}else state.setItem("AtXQuestEnergy",false);if(b>d)d=b;c&&this.SetDivContent(c,"Waiting for X energy: "+this.stats.energy.num+"/"+d)}else if(a==="At Max Energy"){var e=this.stats.energy.max,g=config.getItem("IdleGeneral","Use Current");if(g!=="Use Current")e=general.GetEnergyMax(g);if(g!=="Use Current"&&!e){utility.log(1,"Changing to idle general to get Max energy");if(general.Select("IdleGeneral"))return true}if(this.stats.energy.num>=e)return true;if(this.InLevelUpMode()&&this.stats.energy.num>=
b){c&&this.SetDivContent(c,"Burning all energy to level up");return true}c&&this.SetDivContent(c,"Waiting for max energy: "+this.stats.energy.num+"/"+e)}return false}catch(f){utility.error("ERROR in CheckEnergy: "+f);return false}},AddLabelListener:function(b,a,c,d){try{b.addEventListener(a,this[c],d);return true}catch(e){utility.error("ERROR in AddLabelListener: "+e);return false}},LabelListener:function(b){try{var a=b.target.getElementsByTagName("span");b=null;var c="",d={};if(a.length<=0)throw"what did we click on?";
d=caap.newAutoQuest();d.name=a[0].innerHTML;d.energy=parseInt(a[1].innerHTML,10);caap.ManualAutoQuest(d);utility.log(5,"LabelListener",a,state.getItem("AutoQuest"));if(caap.stats.level<10&&utility.CheckForImage("quest_back_1.jpg")){config.setItem("QuestArea","Quest");config.setItem("QuestSubArea","Land of Fire")}else{if(utility.CheckForImage("tab_quest_on.gif")){config.setItem("QuestArea","Quest");caap.SelectDropOption("QuestArea","Quest");caap.ChangeDropDownList("QuestSubArea",caap.landQuestList)}else if(utility.CheckForImage("demi_quest_on.gif")){config.setItem("QuestArea",
"Demi Quests");caap.SelectDropOption("QuestArea","Demi Quests");caap.ChangeDropDownList("QuestSubArea",caap.demiQuestList)}else if(utility.CheckForImage("tab_atlantis_on.gif")){config.setItem("QuestArea","Atlantis");caap.SelectDropOption("QuestArea","Atlantis");caap.ChangeDropDownList("QuestSubArea",caap.atlantisQuestList)}if((b=$("#app46755028429_main_bn"))&&b.length)(c=b.attr("class"))&&caap.ClassToQuestArea[c]&&config.setItem("QuestSubArea",caap.ClassToQuestArea[c])}utility.log(1,"Setting QuestSubArea to",
config.getItem("QuestSubArea","Land Of Fire"));caap.SelectDropOption("QuestSubArea",config.getItem("QuestSubArea","Land Of Fire"));caap.ShowAutoQuest();return true}catch(e){utility.error("ERROR in LabelListener: "+e);return false}},LabelQuests:function(b,a,c,d,e){if(!$(b).find("div[class='autoquest'").length){b=document.createElement("div");b.className="autoquest";b.style.fontSize="10px";b.innerHTML="$ per energy: "+Math.floor(c/a*10)/10+"<br />Exp per energy: "+Math.floor(d/a*100)/100+"<br />";if(state.getItem("AutoQuest",
this.newAutoQuest()).name===this.questName){a=document.createElement("b");a.innerHTML="Current auto quest";b.appendChild(a)}else{c=document.createElement("a");c.innerHTML="Auto run this quest.";c.quest_name=this.questName;d=document.createElement("span");d.innerHTML=this.questName;d.style.display="none";c.appendChild(d);d=document.createElement("span");d.innerHTML=a;d.style.display="none";c.appendChild(d);this.AddLabelListener(c,"click","LabelListener",false);b.appendChild(c)}b.style.position="absolute";
b.style.background="#B09060";b.style.right="144px";e.parentNode.insertBefore(b,e)}},deityTable:{energy:1,attack:2,defense:3,health:4,stamina:5},BlessingResults:function(b){if(b.match(/Please come back in: /)){var a=parseInt(b.match(/ \d+ hour/),10),c=parseInt(b.match(/ \d+ minute/),10);schedule.setItem("BlessingTimer",(a*60+c)*60,300);utility.log(1,"Recorded Blessing Time. Scheduling next click!")}if(b.match(/You have paid tribute to/)){schedule.setItem("BlessingTimer",86400,300);utility.log(1,"Received blessing. Scheduling next click!")}this.SetCheckResultsFunction("")},
AutoBless:function(){var b=config.getItem("AutoBless","None").toLowerCase();if(b==="none")return false;if(!schedule.check("BlessingTimer"))return false;if(utility.NavigateTo("quests,demi_quest_off","demi_quest_bless"))return true;var a=nHtml.FindByAttrContains(document.body,"img","src","deity_"+b);if(!a){utility.warn("No diety pics for deity",b);return false}if(a.style.height!=="160px")return utility.NavigateTo("deity_"+b);a=nHtml.FindByAttrContains(document.body,"form","id","_symbols_form_"+this.deityTable[b]);
if(!a){utility.warn("No form for deity blessing.");return false}a=utility.CheckForImage("demi_quest_bless",a);if(!a){utility.warn("No image for deity blessing.");return false}utility.log(1,"Click deity blessing for ",b);schedule.setItem("BlessingTimer",3600,300);this.SetCheckResultsFunction("BlessingResults");utility.Click(a);return true},LandsGetNameFromRow:function(b){(b=nHtml.FindByAttrXPath(b,"div","contains(@class,'land_buy_info') or contains(@class,'item_title')"))||utility.warn("can't find land_buy_info");
if(b.className.indexOf("item_title")>=0)return $.trim(b.textContent);b=b.getElementsByTagName("strong");if(b.length<1)return null;return $.trim(b[0].textContent)},bestLand:{land:"",roi:0},CheckResults_land:function(){if(nHtml.FindByAttrXPath(document,"div","contains(@class,'caap_landDone')"))return null;state.setItem("BestLandCost",0);this.sellLand="";this.bestLand.roi=0;this.IterateLands(function(a){this.SelectLands(a.row,2);var c=parseInt(a.income/a.totalCost*24E4,10)/100,d=null;if(!nHtml.FindByAttrXPath(a.row,
"input","@name='Buy'")){c=0;d=nHtml.FindByAttrXPath(a.row,"div","contains(@class,'land_buy_info') or contains(@class,'item_title')");var e=$.trim(nHtml.GetText(d).match(/:\s+\d+/i).toString());e=Number(e.replace(/:\s+/,""));d=nHtml.FindByAttrXPath(a.row,"div","contains(@class,'land_buy_costs')");d=$.trim(nHtml.GetText(d).match(/:\s+\d+/i).toString());d=Number(d.replace(/:\s+/,""));for(var g=[1,5,10],f=2;f>=0;f-=1)if(d-e>=g[f]){this.sellLand=a;this.sellLand.selection=f;break}}d=nHtml.FindByAttrXPath(a.row,
"div","contains(@class,'land_buy_info') or contains(@class,'item_title')").getElementsByTagName("strong");d[0].innerHTML+=" | "+c+"% per day.";if(!a.usedByOther)if(!(this.bestLand.roi||c===0)||c>this.bestLand.roi){this.bestLand.roi=c;this.bestLand.land=a;state.setItem("BestLandCost",this.bestLand.land.cost)}});var b=state.getItem("BestLandCost","");utility.log(1,"Best Land Cost: ",b);b||state.setItem("BestLandCost","none");b=document.createElement("div");b.className="caap_landDone";b.style.display=
"none";nHtml.FindByAttrContains(document.body,"tr","class","land_buy_row").appendChild(b);return null},IterateLands:function(b){var a=document.getElementById("content"),c=document.evaluate(".//tr[contains(@class,'land_buy_row')]",a,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(!c||c.snapshotLength===0){utility.log(9,"Can't find land_buy_row");return null}a={};var d=[];utility.log(9,"forms found",c.snapshotLength);for(var e=0;e<c.snapshotLength;e+=1){var g=c.snapshotItem(e);if(g){var f=this.LandsGetNameFromRow(g);
if(f===null||f==="")utility.warn("Can't find land name");else{var j=document.evaluate(".//*[contains(@class,'gold') or contains(@class,'currency')]",g,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(j.snapshotLength<2)utility.warn("Can't find 2 gold instances");else{for(var i=0,k=[],l=/([0-9,]+)/,p=0;p<j.snapshotLength;p+=1){i=j.snapshotItem(p);if(i.className.indexOf("label")>=0){i=i.parentNode;var o=l.exec(i.textContent);if(o&&o.length>=2&&o[1].length>1)i=utility.NumberOnly(o[1]);else{utility.log(9,
"Cannot find income for ",f,i.textContent);continue}}else i=utility.NumberOnly(i.textContent);k.push(i)}i=k[0];j=k[1];if(!i||!j)utility.warn("Can't find income or cost for",f);else{if(i>j){i=k[1];j=k[0]}a[f]={row:g,name:f,income:i,cost:j,totalCost:j,usedByOther:false};d.push(f)}}}}}for(c=0;c<d.length;c+=1)b.call(this,a[d[c]]);return a},SelectLands:function(b,a){var c=b.getElementsByTagName("select");if(c.length<1)return false;c[0].selectedIndex=a;return true},BuyLand:function(b){this.SelectLands(b.row,
2);var a=nHtml.FindByAttrXPath(b.row,"input","@type='submit' or @type='image'");if(a){utility.log(9,"Clicking buy button",a);utility.log(1,"Buying Land",b.name);utility.Click(a,13E3);state.setItem("BestLandCost",0);this.bestLand.roi=0;return true}return false},SellLand:function(b,a){this.SelectLands(b.row,a);var c=nHtml.FindByAttrXPath(b.row,"input","@type='submit' or @type='image'");if(c){utility.log(9,"Clicking sell button",c);utility.log(1,"Selling Land: ",b.name);utility.Click(c,13E3);this.sellLand=
"";return true}return false},Lands:function(){if(config.getItem("autoBuyLand",false)){if(this.sellLand&&config.getItem("SellLands",false)){this.SellLand(this.sellLand,this.sellLand.selection);return true}var b=state.getItem("BestLandCost","");if(!b){utility.log(1,"Going to land to get Best Land Cost");if(utility.NavigateTo("soldiers,land","tab_land_on.gif"))return true}if(b==="none"){utility.log(2,"No Lands avaliable");return false}utility.log(2,"Lands: How much gold in store?",this.stats.gold.bank);
if(!this.stats.gold.bank&&this.stats.gold.bank!==0){utility.log(1,"Going to keep to get Stored Value");if(utility.NavigateTo("keep"))return true}var a=this.stats.gold.cash+(this.stats.gold.bank-config.getItem("minInStore",0)),c=10*b,d=config.getItem("IdleGeneral","Use Current");if(a>=c&&this.stats.gold.cash<c){if(d!=="Use Current"){utility.log(1,"Changing to idle general");if(general.Select("IdleGeneral"))return true}utility.log(1,"Trying to retrieve",10*b-this.stats.gold.cash);return this.RetrieveFromBank(10*
b-this.stats.gold.cash)}if(b&&this.stats.gold.cash>=10*b){if(d!=="Use Current"){utility.log(1,"Changing to idle general");if(general.Select("IdleGeneral"))return true}utility.NavigateTo("soldiers,land");if(utility.CheckForImage("tab_land_on.gif")){utility.log(2,"Buying land",this.bestLand.land.name);if(this.BuyLand(this.bestLand.land))return true}else return utility.NavigateTo("soldiers,land")}}return false},CheckBattleResults:function(){try{var b={},a=(new Date(2009,0,1)).getTime(),c=0,d=0,e=0,g=
{userId:0,userName:"",battleType:"",points:0,gold:0,win:false};if(battle.deadCheck()!==false)return true;g=battle.getResult();if(!g)return true;b=battle.getItem(g.userId);if(g.win){utility.log(1,"We Defeated ",g.userName);state.setItem("BattleChainId",0);a=b.chainTime?b.chainTime:(new Date(2009,0,1)).getTime();c=config.getItem("ChainBP","");d=config.getItem("ChainGold","");if(schedule.since(a,86400)&&(utility.isNum(c)&&c>=0||utility.isNum(d)&&d>=0)){if(utility.isNum(c)&&c>=0)if(g.points>=c){state.setItem("BattleChainId",
g.userId);utility.log(1,"Chain Attack: "+g.userId+(g.battleType==="War"?"  War Points: ":"  Battle Points: ")+g.points)}else b.ignoreTime=(new Date).getTime();if(utility.isNum(d)&&d>=0)if(g.gold>=d){state.setItem("BattleChainId",g.userId);utility.log(1,"Chain Attack: "+g.userId+" Gold: "+g.goldnum)}else b.ignoreTime=(new Date).getTime()}b.chainCount=b.chainCount?b.chainCount+=1:1;e=config.getItem("MaxChains",4);if(!utility.isNum(e)||e<0)e=4;if(b.chainCount>=e){utility.log(1,"Lets give this guy a break. Chained",
b.chainCount);b.chainTime=(new Date).getTime();b.chainCount=0}}else{utility.log(1,"We Were Defeated By ",g.userName);b.chainCount=0;b.chainTime=(new Date(2009,0,1)).getTime()}battle.setItem(b);this.SetCheckResultsFunction("");return true}catch(f){utility.error("ERROR in CheckBattleResults: "+f);return false}},BattleUserId:function(b){try{if(battle.hashCheck(b))return true;var a=null,c=null,d=null;if(a=utility.CheckForImage(this.battles.Freshmeat[config.getItem("BattleType","Invade")]))if((c=$(a).parent().parent())&&
c.length)if((d=c.find("input[name='target_id']"))&&d.length){d.attr("value",b);state.setItem("lastBattleID",b);this.ClickBattleButton(a);state.setItem("notSafeCount",0);return true}else utility.warn("target_id not found in battleForm");else utility.warn("form not found in battleButton");else utility.warn("battleButton not found");return false}catch(e){utility.error("ERROR in BattleUserId: "+e);return false}},ClickBattleButton:function(b){state.setItem("ReleaseControl",true);this.SetCheckResultsFunction("CheckBattleResults");
utility.Click(b)},battles:{Raid:{Invade:"raid_attack_button.gif",Duel:"raid_attack_button2.gif",regex1:/Rank: ([0-9]+) ([^0-9]+) ([0-9]+) ([^0-9]+) ([0-9]+)/i,refresh:"raid",image:"tab_raid_on.gif"},Freshmeat:{Invade:"battle_01.gif",Duel:"battle_02.gif",War:"war_button_duel.gif",regex1:RegExp("(.+)    \\(Level ([0-9]+)\\)\\s*Battle: ([A-Za-z ]+) \\(Rank ([0-9]+)\\)\\s*War: ([A-Za-z ]+) \\(Rank ([0-9]+)\\)\\s*([0-9]+)","i"),regex2:/(.+)    \(Level ([0-9]+)\)\s*Battle: ([A-Za-z ]+) \(Rank ([0-9]+)\)\s*([0-9]+)/i,
warLevel:true,refresh:"battle_on.gif",image:"battle_on.gif"}},BattleFreshmeat:function(b){try{var a=config.getItem("BattleType","Invade"),c="//input[contains(@src,'"+this.battles[b][a]+"')]",d=document.evaluate(c,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);utility.log(1,"target ",c);if(d.snapshotLength<=0){utility.warn("Not on battlepage");return false}var e=false;a=[];c=0;var g="",f=false,j=null,i="",k="",l=0,p=0,o=0,h=0,m=0,t=0,s=0,n={},r={},w=(new Date(2009,0,1)).getTime();g=state.getItem("BattleChainId",
0);state.setItem("BattleChainId","");l=config.getItem("FreshMeatMinRank",99);utility.log(2,"FreshMeatMinRank",l);if(!utility.isNum(l)){l!==""&&utility.warn("FreshMeatMinRank is NaN, using default",99);l=99}p=gm.getItem("FreshMeatMaxLevel",99999,hiddenVar);utility.log(2,"FreshMeatMaxLevel",p);if(!utility.isNum(p)){p=99999;utility.warn("FreshMeatMaxLevel is NaN, using default",p)}o=config.getItem("FreshMeatARBase",0.5);utility.log(2,"FreshMeatARBase",o);if(!utility.isNum(o)){o=0.5;utility.warn("FreshMeatARBase is NaN, using default",
o)}h=gm.getItem("FreshMeatARMax",99999,hiddenVar);utility.log(2,"FreshMeatARMax",h);if(!utility.isNum(h)){h=99999;utility.warn("FreshMeatARMax is NaN, using default",h)}m=gm.getItem("FreshMeatARMin",0,hiddenVar);utility.log(2,"FreshMeatARMin",m);if(!utility.isNum(m)){m=0;utility.warn("FreshMeatARMin is NaN, using default",m)}for(var D=0;D<d.snapshotLength;D+=1){w=(new Date(2009,0,1)).getTime();n={};n.button=d.snapshotItem(D);var x=n.button;if(x){i=k="";if(b==="Raid"){x=x.parentNode.parentNode.parentNode.parentNode.parentNode;
i=x.childNodes[3].childNodes[3].textContent;k=this.battles.Raid.regex1.exec(i);if(!k){utility.warn("Can't match Raid regex in ",i);continue}n.rankNum=parseInt(k[1],10);n.rankStr=battle.battleRankTable[n.rankNum];n.levelNum=parseInt(k[3],10);n.armyNum=parseInt(k[5],10)}else{for(;x.tagName.toLowerCase()!=="tr";)x=x.parentNode;n.deityNum=utility.NumberOnly(utility.CheckForImage("symbol_",x).src.match(/\d+\.jpg/i))-1;n.deityStr=this.demiTable[n.deityNum];if(config.getItem("DemiPointsFirst",false)&&!state.getItem("DemiPointsDone",
true)&&config.getItem("WhenMonster","Never")!=="Never"){utility.log(9,"Demi Points First",n.deityNum,n.deityStr,this.demi[n.deityStr],config.getItem("DemiPoint"+n.deityNum,true));if(this.demi[n.deityStr].daily.dif<=0||!config.getItem("DemiPoint"+n.deityNum,true)){utility.log(1,"Daily Demi Points done for",n.deityStr);continue}}i=$.trim(nHtml.GetText(x));if(!i.length){utility.warn("Can't find txt in tr");continue}if(this.battles.Freshmeat.warLevel){k=this.battles.Freshmeat.regex1.exec(i);if(!k){k=
this.battles.Freshmeat.regex2.exec(i);this.battles.Freshmeat.warLevel=false}}else{k=this.battles.Freshmeat.regex2.exec(i);if(!k){k=this.battles.Freshmeat.regex1.exec(i);this.battles.Freshmeat.warLevel=true}}if(!k){utility.warn("Can't match Freshmeat regex in ",i);continue}n.nameStr=k[1];n.levelNum=parseInt(k[2],10);n.rankStr=k[3];n.rankNum=parseInt(k[4],10);if(this.battles.Freshmeat.warLevel){n.warRankStr=k[5];n.warRankNum=parseInt(k[6],10)}n.armyNum=this.battles.Freshmeat.warLevel?parseInt(k[7],
10):parseInt(k[5],10)}if(j=nHtml.FindByAttrXPath(x,"input","@name='target_id'")){n.userId=parseInt(j.value,10);if(!battle.hashCheck(n.userId)){t=this.stats.level/n.levelNum;s=o*t;s=Math.min(s,h);s=Math.max(s,m);if(s<=0)utility.warn("Bad ratio",s,o,m,h,t);else{utility.log(2,"Army Ratio: "+s+" Level: "+n.levelNum+" Rank: "+n.rankNum+" Army: "+n.armyNum);if(n.levelNum-this.stats.level>p)utility.log(2,"Greater than maxLevel",p);else{if(config.getItem("BattleType","Invade")==="War"&&this.battles.Freshmeat.warLevel){if(this.stats.rank.war&&
this.stats.rank.war-n.warRankNum>l){utility.log(2,"Greater than minRank",l);continue}}else if(this.stats.rank.battle&&this.stats.rank.battle-n.rankNum>l){utility.log(2,"Greater than minRank",l);continue}if(this.stats.army.capped&&n.armyNum>this.stats.army.capped*s)utility.log(2,"Greater than armyRatio",s);else{config.getItem("BattleType","Invade")==="War"&&this.battles.Freshmeat.warLevel?utility.log(1,"ID: "+utility.rpad(n.userId.toString()," ",15)+" Level: "+utility.rpad(n.levelNum.toString()," ",
4)+" War Rank: "+utility.rpad(n.warRankNum.toString()," ",2)+" Army: "+n.armyNum):utility.log(1,"ID: "+utility.rpad(n.userId.toString()," ",15)+" Level: "+utility.rpad(n.levelNum.toString()," ",4)+" Battle Rank: "+utility.rpad(n.rankNum.toString()," ",2)+" Army: "+n.armyNum);r=battle.getItem(n.userId);if(!config.getItem("IgnoreBattleLoss",false)){switch(config.getItem("BattleType","Invade")){case "Invade":w=r.invadeLostTime?r.invadeLostTime:(new Date(2009,0,1)).getTime();break;case "Duel":w=r.duelLostTime?
r.duelLostTime:(new Date(2009,0,1)).getTime();break;case "War":w=r.warlostTime?r.warlostTime:(new Date(2009,0,1)).getTime();break;default:utility.warn("Battle type unknown!",config.getItem("BattleType","Invade"))}if(r&&r.nameStr!==""&&!schedule.since(w,604800)){utility.log(1,"We lost "+config.getItem("BattleType","Invade")+" to this id this week: ",n.userId);continue}}w=r.deadTime?r.deadTime:(new Date(2009,0,1)).getTime();if(r&&r.nameStr!==""&&!schedule.since(w,3600))utility.log(1,"User was dead in the last hour: ",
n.userId);else{w=r.chainTime?r.chainTime:(new Date(2009,0,1)).getTime();if(r&&r.nameStr!==""&&!schedule.since(w,86400))utility.log(1,"We chained user within 2 days: ",n.userId);else{w=r.ignoreTime?r.ignoreTime:(new Date(2009,0,1)).getTime();if(r&&r.nameStr!==""&&!schedule.since(w,604800))utility.log(1,"User didn't meet chain requirements this week: ",n.userId);else{n.score=(b==="Raid"?0:n.rankNum)-n.armyNum/t/this.stats.army.capped;if(n.userId===g)f=true;n.targetNumber=D+1;utility.log(2,"tempRecord/levelm",
n,k);a[c]=n;c+=1;if(D===0&&b==="Raid")e=true;for(var A=0;A<c;A+=1)for(var z=0;z<A;z+=1)if(a[z].score<a[z+1].score){n=a[z];a[z]=a[z+1];a[z+1]=n}}}}}}}}}else utility.warn("Could not find 'target_id' input")}else utility.warn("No tr parent of button?")}if(c>0){x=w=null;if(f){w=d.snapshotItem(0);x=w.parentNode.parentNode;if(j=nHtml.FindByAttrXPath(x,"input","@name='target_id'")){j.value=g;utility.log(1,"Chain attacking: ",g);this.ClickBattleButton(w);state.setItem("lastBattleID",g);this.SetDivContent("battle_mess",
"Attacked: "+state.getItem("lastBattleID",0));state.setItem("notSafeCount",0);return true}utility.warn("Could not find 'target_id' input")}else if(config.getItem("PlusOneKills",false)&&b==="Raid")if(e){w=d.snapshotItem(0);x=w.parentNode.parentNode;if(j=nHtml.FindByAttrXPath(x,"input","@name='target_id'")){var B=parseInt(j.value,10);j.value="200000000000001";utility.log(1,"Target ID Overriden For +1 Kill. Expected Defender: ",B);this.ClickBattleButton(w);state.setItem("lastBattleID",B);this.SetDivContent("battle_mess",
"Attacked: "+state.getItem("lastBattleID",0));state.setItem("notSafeCount",0);return true}utility.warn("Could not find 'target_id' input")}else utility.log(1,"Not safe for +1 kill.");else for(d=0;d<c;d+=1)if(!(!state.getItem("lastBattleID",0)&&state.getItem("lastBattleID",0)===a[d].id&&d<c-1)){var G=a[d].button;if(G!==null||G!==undefined){utility.log(1,"Found Target score: "+a[d].score.toFixed(2)+" id: "+a[d].userId+" Number: "+a[d].targetNumber);this.ClickBattleButton(G);delete a[d].score;delete a[d].targetNumber;
delete a[d].button;state.setItem("lastBattleID",a[d].userId);a[d].aliveTime=(new Date).getTime();r=battle.getItem(a[d].userId);$.extend(true,r,a[d]);utility.log(1,"battleRecord",r);battle.setItem(r);this.SetDivContent("battle_mess","Attacked: "+state.getItem("lastBattleID",0));state.setItem("notSafeCount",0);return true}utility.warn("Attack button is null")}}state.setItem("notSafeCount",state.getItem("notSafeCount",0)+1);if(state.getItem("notSafeCount",0)>100){this.SetDivContent("battle_mess","Leaving Battle. Will Return Soon.");
utility.log(1,"No safe targets limit reached. Releasing control for other processes: ",state.getItem("notSafeCount",0));state.setItem("notSafeCount",0);return false}this.SetDivContent("battle_mess","No targets matching criteria");utility.log(1,"No safe targets: ",state.getItem("notSafeCount",0));if(b==="Raid"){var y=monster.engageButtons[state.getItem("targetFromraid","")];if(state.getItem("page","")==="raid"&&y)utility.Click(y);else{schedule.setItem("RaidNoTargetDelay",gm.getItem("RaidNoTargetDelay",
45,hiddenVar));utility.NavigateTo(this.battlePage+",raid")}}else utility.NavigateTo(this.battlePage+",battle_on.gif");return true}catch(F){utility.error("ERROR in BattleFreshmeat: "+F);return utility.ClickAjax("raid.php")}},CheckKeep:function(){try{if(!schedule.check("keep"))return false;utility.log(1,"Visiting keep to get stats");return utility.NavigateTo("keep","tab_stats_on.gif")}catch(b){utility.error("ERROR in CheckKeep: "+b);return false}},CheckOracle:function(){try{if(!schedule.check("oracle"))return false;
utility.log(9,"Checking Oracle for Favor Points");return utility.NavigateTo("oracle","oracle_on.gif")}catch(b){utility.error("ERROR in CheckOracle: "+b);return false}},CheckBattleRank:function(){try{if(!schedule.check("battlerank")||this.stats.level<8)return false;utility.log(1,"Visiting Battle Rank to get stats");return utility.NavigateTo("battle,battlerank","tab_battle_rank_on.gif")}catch(b){utility.error("ERROR in CheckBattleRank: "+b);return false}},CheckWarRank:function(){try{if(!schedule.check("warrank")||
this.stats.level<100)return false;utility.log(1,"Visiting War Rank to get stats");return utility.NavigateTo("battle,war_rank","tab_war_on.gif")}catch(b){utility.error("ERROR in CheckWar: "+b);return false}},CheckGenerals:function(){try{if(!schedule.check("generals"))return false;utility.log(1,"Visiting generals to get 'General' list");return utility.NavigateTo("mercenary,generals","tab_generals_on.gif")}catch(b){utility.error("ERROR in CheckGenerals: "+b);return false}},CheckSoldiers:function(){try{if(!schedule.check("soldiers"))return false;
utility.log(9,"Checking Soldiers");return utility.NavigateTo("soldiers","tab_soldiers_on.gif")}catch(b){utility.error("ERROR in CheckSoldiers: "+b);return false}},CheckItem:function(){try{if(!schedule.check("item"))return false;utility.log(9,"Checking Item");return utility.NavigateTo("soldiers,item","tab_black_smith_on.gif")}catch(b){utility.error("ERROR in CheckItem: "+b);return false}},CheckMagic:function(){try{if(!schedule.check("magic"))return false;utility.log(9,"Checking Magic");return utility.NavigateTo("soldiers,magic",
"tab_magic_on.gif")}catch(b){utility.error("ERROR in CheckMagic: "+b);return false}},CheckAchievements:function(){try{if(!schedule.check("achievements"))return false;utility.log(1,"Visiting achievements to get stats");return utility.NavigateTo("keep,achievements","tab_achievements_on.gif")}catch(b){utility.error("ERROR in CheckAchievements: "+b);return false}},CheckSymbolQuests:function(){try{if(!schedule.check("symbolquests")||this.stats.level<8)return false;utility.log(1,"Visiting symbolquests to get 'Demi-Power' points");
return utility.NavigateTo("quests,symbolquests","demi_quest_on.gif")}catch(b){utility.error("ERROR in CheckSymbolQuests: "+b);return false}},CheckCharacterClasses:function(){try{if(!schedule.check("view_class_progress")||this.stats.level<100)return false;utility.log(9,"Checking Monster Class to get Character Class Stats");return utility.NavigateTo("battle_monster,view_class_progress","nm_class_whole_progress_bar.jpg")}catch(b){utility.error("ERROR in CheckCharacterClasses: "+b);return false}},CheckGift:function(){try{if(!schedule.check("gift"))return false;
utility.log(9,"Checking Gift");return utility.NavigateTo("army,gift","tab_gifts_on.gif")}catch(b){utility.error("ERROR in CheckGift: "+b);return false}},battleWarnLevel:true,Battle:function(b){try{var a="",c="",d="",e="",g=0,f="",j=null,i="",k=0,l="",p="",o="",h="",m={},t=(new Date(2009,0,1)).getTime();if(this.stats.level<8){if(this.battleWarnLevel){utility.log(1,"Battle: Unlock at level 8");this.battleWarnLevel=false}return false}a=config.getItem("WhenBattle","Never");p=config.getItem("WhenMonster",
"Never");l=state.getItem("targetFrombattle_monster","");switch(a){case "Never":this.SetDivContent("battle_mess","Battle off");return false;case "Stay Hidden":if(!this.NeedToHide()){this.SetDivContent("battle_mess","We Dont Need To Hide Yet");utility.log(1,"We Dont Need To Hide Yet");return false}break;case "No Monster":if(b!=="DemiPoints")if(p!=="Never"&&l&&!l.match(/the deathrune siege/i))return false;break;case "Demi Points Only":if(b==="DemiPoints"&&p==="Never")return false;if(b!=="DemiPoints"&&
p!=="Never"&&l&&!l.match(/the deathrune siege/i))return false;if(state.getItem("DemiPointsDone",true))return false;break;default:}if(this.CheckKeep())return true;if(this.stats.health.num<10){utility.log(9,"Health is less than 10: ",this.stats.health.num);return false}if(config.getItem("waitSafeHealth",false)&&this.stats.health.num<12){utility.log(9,"Unsafe. Health is less than 12: ",this.stats.health.num);return false}c=this.GetCurrentBattleTarget(b);utility.log(9,"Mode/Target",b,c);if(c)utility.isNum(c)||
(c=c.toLowerCase());else{utility.log(1,"No valid battle target");return false}if(c==="noraid"){utility.log(9,"No Raid To Attack");return false}d=config.getItem("BattleType","Invade");switch(d){case "Invade":e="BattleGeneral";g=1;f="battle_invade_again.gif";if(general.LevelUpCheck(e)){e="LevelUpGeneral";utility.log(1,"Using level up general")}break;case "Duel":e="DuelGeneral";g=1;f="battle_duel_again.gif";if(general.LevelUpCheck(e)){e="LevelUpGeneral";utility.log(1,"Using level up general")}break;
case "War":e="WarGeneral";g=10;f="battle_duel_again.gif";if(general.LevelUpCheck(e)){e="LevelUpGeneral";utility.log(1,"Using level up general")}break;default:utility.warn("Unknown battle type ",d);return false}if(this.CheckStamina("Battle",g)){if(general.Select(e))return true}else{utility.log(9,"Not enough stamina for ",d);return false}if($("img[src*='battle_victory.gif']").length){j=utility.CheckForImage(f);k=state.getItem("BattleChainId",0);if(j&&k){this.SetDivContent("battle_mess","Chain Attack In Progress");
utility.log(1,"Chaining Target",k);this.ClickBattleButton(j);state.setItem("BattleChainId",0);return true}}state.getItem("notSafeCount",0)||state.setItem("notSafeCount",0);utility.log(1,"Battle Target",c);o=config.getItem("TargetType","Invade");switch(c){case "raid":if(!schedule.check("RaidNoTargetDelay")){h=((schedule.getItem("RaidNoTargetDelay").next-(new Date).getTime())/1E3).toFixed()+" secs";utility.log(1,"Rejoining the raid in",h);this.SetDivContent("battle_mess","Joining the Raid in "+h);return true}this.SetDivContent("battle_mess",
"Joining the Raid");if(utility.NavigateTo(this.battlePage+",raid","tab_raid_on.gif"))return true;if(config.getItem("clearCompleteRaids",false)&&monster.completeButton.raid.button&&monster.completeButton.raid.name){utility.Click(monster.completeButton.raid.button);monster.deleteItem(monster.completeButton.raid.name);monster.completeButton.raid={};this.UpdateDashboard(true);utility.log(1,"Cleared a completed raid");return true}i=state.getItem("targetFromraid","");if(!$("div[style*='dragon_title_owner']").length){if(j=
monster.engageButtons[i]){utility.Click(j);return true}utility.warn("Unable to engage raid",i);return false}if(monster.ConfirmRightPage(i))return true;if(o==="Userid List"){if(this.BattleFreshmeat("Raid")){$("span[class*='result_body']").length&&this.NextBattleTarget();if(state.getItem("notSafeCount",0)>10){state.setItem("notSafeCount",0);this.NextBattleTarget()}return true}utility.warn("Doing Raid UserID list, but no target");return false}return this.BattleFreshmeat("Raid");case "freshmeat":if(utility.NavigateTo(this.battlePage,
"battle_on.gif"))return true;this.SetDivContent("battle_mess","Battling "+c);if(o==="Userid List"){if(this.BattleFreshmeat("Freshmeat")){$("span[class*='result_body']").length&&this.NextBattleTarget();if(state.getItem("notSafeCount",0)>10){state.setItem("notSafeCount",0);this.NextBattleTarget()}return true}utility.warn("Doing Freshmeat UserID list, but no target");return false}return this.BattleFreshmeat("Freshmeat");default:if(!config.getItem("IgnoreBattleLoss",false)){m=battle.getItem(c);switch(config.getItem("BattleType",
"Invade")){case "Invade":t=m.invadeLostTime?m.invadeLostTime:t;break;case "Duel":t=m.duelLostTime?m.duelLostTime:t;break;case "War":t=m.warlostTime?m.warlostTime:t;break;default:utility.warn("Battle type unknown!",config.getItem("BattleType","Invade"))}if(m&&m.nameStr!==""&&!schedule.since(t,604800)){utility.log(1,"Avoiding Losing Target",c);this.NextBattleTarget();return true}}if(utility.NavigateTo(this.battlePage,"battle_on.gif"))return true;state.setItem("BattleChainId",0);if(this.BattleUserId(c)){this.NextBattleTarget();
return true}utility.warn("Doing default UserID list, but no target");return false}}catch(s){utility.error("ERROR in Battle: "+s);return false}},NextBattleTarget:function(){state.setItem("BattleTargetUpto",state.getItem("BattleTargetUpto",0)+1)},GetCurrentBattleTarget:function(b){try{var a="",c=[],d="",e="",g="";e=config.getItem("TargetType","Freshmeat");g=state.getItem("targetFromraid","");if(b==="DemiPoints"){if(g&&e==="Raid")return"Raid";return"Freshmeat"}if(e==="Raid"){if(g)return"Raid";this.SetDivContent("battle_mess",
"No Raid To Attack");return"NoRaid"}if(e==="Freshmeat")return"Freshmeat";if(a=state.getItem("BattleChainId",0))return a;c=utility.TextToArray(config.getItem("BattleTargets",""));if(!c.length)return false;d=state.getItem("BattleTargetUpto",0);if(d>c.length-1){d=0;state.setItem("BattleTargetUpto",0)}if(!c[d]){this.NextBattleTarget();return false}this.SetDivContent("battle_mess","Battling User "+d+"/"+c.length+" "+c[d]);if((!utility.isNum(c[d])?c[d].toLowerCase():c[d])==="raid"){if(g)return"Raid";this.SetDivContent("battle_mess",
"No Raid To Attack");this.NextBattleTarget();return false}return c[d]}catch(f){utility.error("ERROR in GetCurrentBattleTarget: "+f);return false}},CheckResults_guild_current_battles:function(){try{var b=null;if((b=$("img[src*='guild_symbol']"))&&b.length)b.each(function(){utility.log(2,"name",$.trim($(this).parent().parent().next().text()));utility.log(2,"button",$(this).parent().parent().parent().next().find("input[src*='dragon_list_btn_']"))});else return false;return true}catch(a){utility.error("ERROR in CheckResults_guild_current_battles: "+
a);return false}},CheckResults_fightList:function(){try{utility.log(9,"CheckResults_fightList - get all buttons to check monsterObjectList");var b=document.evaluate(".//img[contains(@src,'dragon_list_btn_') or contains(@src,'mp_button_summon_')]",document.body,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(b.snapshotLength===0){utility.warn("No monster buttons found");return false}var a=state.getItem("page","battle_monster"),c=utility.CheckForImage("dragon_list_btn_");if(c&&!(c.parentNode.href.match("user="+
this.stats.FBID)||c.parentNode.href.match(/alchemy\.php/))){var d=state.getItem("pageUserCheck","");if(d){utility.log(1,"On another player's keep.",d);return false}}if(a==="battle_monster"&&b.snapshotLength===1){utility.log(1,"No monsters to review");state.setItem("reviewDone",true);return true}d=0;if(a==="battle_monster")d=1;utility.log(9,"startCount",d);c={};for(d=d;d<b.snapshotLength;d+=1){var e=b.snapshotItem(d).src.match(/dragon_list_btn_\d/i)[0],g=b.snapshotItem(d).parentNode.parentNode.parentNode.parentNode,
f=$.trim(nHtml.GetText(g)),j=$.trim(f.replace("Completed!","").replace(/Fled!/i,"")),i=b.snapshotItem(d).parentNode.href;if(i&&i.match(/user=/)&&(i.match(/mpool=/)||i.match(/raid\.php/))){utility.log(5,"monster",j);c=monster.getItem(j);c.page=a;switch(e){case "dragon_list_btn_2":c.status="Collect Reward";c.color="grey";break;case "dragon_list_btn_3":monster.engageButtons[j]=b.snapshotItem(d);break;case "dragon_list_btn_4":if(a==="raid"&&!/!/.test(f)){monster.engageButtons[j]=b.snapshotItem(d);break}if(!monster.completeButton[a].button&&
!monster.completeButton[a].name){monster.completeButton[a].name=j;monster.completeButton[a].button=utility.CheckForImage("cancelButton.gif",g)}c.status="Complete";c.color="grey";break;default:}var k=i.match(/mpool=\d+/i)?"&mpool="+i.match(/mpool=\d+/i)[0].split("=")[1]:"",l=monster.type(j),p="";if(l==="Siege")p="&action=doObjective";else{var o=monster.info[l];p=o&&o.siege?"&action=doObjective":""}var h="<a href='http://apps.facebook.com/castle_age/"+a+".php?casuser="+i.match(/user=\d+/i)[0].split("=")[1]+
k+p+"'>Link</a>";c.link=h;monster.setItem(c)}}b=0;a=[];for(b=0;b<monster.records.length;b+=1)monster.records[b].page===""&&a.push(monster.records[b].name);for(b=0;b<a.length;b+=1)monster.deleteItem(a[b]);state.setItem("reviewDone",true);this.UpdateDashboard(true);return true}catch(m){utility.error("ERROR in CheckResults_fightList: "+m);return false}},CheckResults_viewFight:function(){try{var b=null,a={},c=[],d=0,e="",g=null,f="",j=[],i=0,k="",l=0,p=0,o=0,h=0,m=0,t=false,s=false,n=0,r=false,w=false,
D=false,x=0,A=0,z=0,B=0,G=0,y=null,F=null,J=null,K=[],E="";(J=$("#app46755028429_chat_log div[style*='hidden'] div[style*='320px']"))&&J.length&&J.each(function(){if(E=$.trim($(this).html()))if((K=E.split("<br>"))&&K.length===2)if((j=K[1].replace(/"/g,"").match(/.*(http:.*)/))&&j.length===2&&j[1])if((j=j[1].split(" "))&&j.length){f="<a href='"+j[0]+"'>"+j[0]+"</a>";E=E.replace(j[0],f);$(this).html(E)}});if((y=$("div[style*='dragon_title_owner']"))&&y.length)f=$.trim(y.children(":eq(2)").text());else if((y=
$("div[style*='nm_top']"))&&y.length){f=$.trim(y.children(":eq(0)").children(":eq(0)").text());if((g=$("div[style*='nm_bars']"))&&g.length)f+=" "+$.trim(g.children(":eq(0)").children(":eq(0)").children(":eq(0)").siblings(":last").children(":eq(0)").text()).replace("'s Life","");else{utility.warn("Problem finding nm_bars");return}}else{utility.warn("Problem finding dragon_title_owner and nm_top");return}if(y.find("img[uid='"+this.stats.FBID+"']").length){utility.log(2,"monster name found");f=f.replace(/.+'s /,
"Your ")}utility.log(2,"monster name",f);a=monster.getItem(f);if(a.type==="")a.type=monster.type(a.name);if(a.type==="Siege")if((g=$("div[style*='raid_back']"))&&g.length)if(g.find("img[src*='raid_1_large.jpg']").length)a.type="Raid I";else if(g.find("img[src*='raid_b1_large.jpg']").length)a.type="Raid II";else g.find("img[src*='raid_1_large_victory.jpg']").length?utility.log(1,"Siege Victory!"):utility.warn("Problem finding raid image! Probably finished.");else{utility.warn("Problem finding raid_back");
return}a.review=(new Date).getTime();state.setItem("monsterRepeatCount",0);if((g=$("#app46755028429_monsterTicker"))&&g.length){utility.log(2,"Monster ticker found.");c=g.text().split(":")}else utility.CheckForImage("dead.jpg")||utility.warn("Could not locate Monster ticker.");if(c&&c.length===3&&monster.info[a.type]&&monster.info[a.type].fort){a.fortify=a.type==="Deathrune"||a.type==="Ice Elemental"?100:0;switch(monster.info[a.type].defense_img){case "bar_dispel.gif":if((g=$("img[src*='"+monster.info[a.type].defense_img+
"']"))&&g.length)a.fortify=100-parseFloat(g.parent().css("width"));else utility.warn("Unable to find defense bar",monster.info[a.type].defense_img);break;case "seamonster_ship_health.jpg":if((g=$("img[src*='"+monster.info[a.type].defense_img+"']"))&&g.length){a.fortify=parseFloat(g.parent().css("width"));if(monster.info[a.type].repair_img)if((g=$("img[src*='"+monster.info[a.type].repair_img+"']"))&&g.length)a.fortify*=100/(100-parseFloat(g.parent().css("width")));else utility.warn("Unable to find repair bar",
monster.info[a.type].repair_img)}else utility.warn("Unable to find defense bar",monster.info[a.type].defense_img);break;case "nm_green.jpg":if((g=$("img[src*='"+monster.info[a.type].defense_img+"']"))&&g.length){a.fortify=parseFloat(g.parent().css("width"));a.strength=parseFloat(g.parent().parent().css("width"))}else utility.warn("Unable to find defense bar",monster.info[a.type].defense_img);break;default:utility.warn("No match for defense_img",monster.info[a.type].defense_img)}}if((F=$("td[class='dragonContainer'] td[valign='top'] a[href*='user="+
this.stats.FBID+"']"))&&F.length){if(monster.info[a.type]&&monster.info[a.type].defense)if((j=$.trim(F.parent().parent().siblings(":last").text()).match(/([0-9,]+) dmg \/ ([0-9,]+) def/))&&j.length===3){a.attacked=utility.NumberOnly(j[1]);a.defended=utility.NumberOnly(j[2]);a.damage=a.attacked+a.defended}else utility.warn("Unable to get attacked and defended damage");else{a.attacked=a.type==="Siege"||monster.info[a.type]&&monster.info[a.type].raid?utility.NumberOnly($.trim(F.parent().siblings(":last").text())):
utility.NumberOnly($.trim(F.parent().parent().siblings(":last").text()));a.damage=a.attacked}F.parents("tr:first").css("background-color",gm.getItem("HighlightColor","#C6A56F",hiddenVar))}else utility.log(1,"Player hasn't done damage yet");if(/:ac\b/.test(a.conditions)||a.type.match(/Raid/)&&config.getItem("raidCollectReward",false)||!a.type.match(/Raid/)&&config.getItem("monsterCollectReward",false)){i=state.getItem("monsterReviewCounter",-3);if(i>=0&&monster.records[i]&&monster.records[i].name===
a.name&&($("a[href*='&action=collectReward']").length||$("input[alt*='Collect Reward']").length)){utility.log(1,"Collecting Reward");a.review=1;state.setItem("monsterReviewCounter",i-=1);a.status="Collect Reward";if(a.name.indexOf("Siege")>=0)a.rix=$("a[href*='&rix=1']").length?1:2}}k=monster.info[a.type]&&monster.info[a.type].alpha?"nm_red.jpg":"monster_health_background.jpg";y=$("img[src*='"+k+"']");if(c&&c.length===3&&y&&y.length){a.timeLeft=c[0]+":"+c[1];if(y&&y.length){utility.log(2,"Found monster health div.");
a.life=parseFloat(y.parent().css("width"))}else utility.warn("Could not find monster health div.");if(a.life)if(!monster.info[a.type]){monster.setItem(a);utility.warn("Unknown monster");return}if(F&&F.length&&monster.info[a.type]&&monster.info[a.type].alpha)if((y=$("div[style*='nm_bottom']"))&&y.length)if(f=$.trim(y.children().eq(0).children().text()).replace(RegExp("[\\s\\s]+","g")," ")){utility.log(2,"tempText",f);if((j=f.match(/Class: (\w+) /))&&j.length===2){a.charClass=j[1];utility.log(2,"character",
a.charClass)}else utility.warn("Can't get character",j);if((j=f.match(/Tip: ([\w ]+) Status/))&&j.length===2){a.tip=j[1];utility.log(2,"tip",a.tip)}else utility.warn("Can't get tip",j);if((j=f.match(/Status Time Remaining: ([0-9]+):([0-9]+):([0-9]+)\s*/))&&j.length===4){a.stunTime=(new Date).getTime()+j[1]*60*60*1E3+j[2]*60*1E3+j[3]*1E3;utility.log(2,"statusTime",a.stunTime)}else utility.warn("Can't get statusTime",j);if((g=y.find("img[src*='nm_stun_bar']"))&&g.length){f=g.css("width");utility.log(2,
"tempText",f);if(f){a.stun=utility.NumberOnly(f);utility.log(2,"stun",a.stun)}else utility.warn("Can't get stun bar width")}else a.strength!==100&&utility.warn("Can't get stun bar");if(a.charClass&&a.tip&&a.stun!==-1){a.stunDo=RegExp(a.charClass).test(a.tip)&&a.stun<100;a.stunType="";if(a.stunDo){utility.log(1,"Do character specific attack",a.stunDo);if((j=a.tip.split(" "))&&j.length){f=j[j.length-1].toLowerCase();j=["strengthen","cripple","heal","deflection"];if(f&&j.indexOf(f)>=0){a.stunType=f.replace("ion",
"");utility.log(1,"Character specific attack type",a.stunType)}else utility.warn("Type does match list!",f)}else utility.warn("Unable to get type from tip!",a.tip)}}else utility.warn("Missing 'class', 'tip' or 'stun'",a)}else utility.warn("Missing tempText");else utility.warn("Missing nm_bottom");if(monster.info[a.type]&&monster.info[a.type].siege){b=/.*Need (\d+) more.*/;e=monster.info[a.type].alpha?$.trim($("div[style*='nm_bottom']").children(":last").children(":last").children(":last").children(":last").text()).replace(b,
"$1"):a.type.indexOf("Raid")>=0?$.trim($("img[src*='"+monster.info[a.type].siege_img+"']").parent().parent().text()).replace(b,"$1"):$.trim($("#app46755028429_action_logs").prev().children().eq(3).children().eq(2).children().eq(1).text()).replace(b,"$1");if(a.type.indexOf("Raid")>=0)l=utility.NumberOnly(utility.getHTMLPredicate(g.attr("src")));else{l=1;for(p=0;p<monster.info[a.type].siege_img.length;p+=1)l+=$("img[src*="+monster.info[a.type].siege_img[p]+"]").size()}d=Math.min(l,monster.info[a.type].siege);
a.phase=Math.min(d,monster.info[a.type].siege)+"/"+monster.info[a.type].siege+" need "+(isNaN(e)?0:e)}if(monster.info[a.type]){if(isNaN(e))e=0;a.t2k=monster.t2kCalc(monster.info[a.type],c,a.life,d,e)}if(F&&F.length){o=monster.parseCondition("ach",a.conditions);if(monster.info[a.type]&&o===false)o=monster.info[a.type].ach;h=monster.parseCondition("max",a.conditions);m=monster.parseCondition("f%",a.conditions)!==false?monster.parseCondition("f%",a.conditions):config.getItem("MaxToFortify",0);t=a.name===
state.getItem("targetFromraid","")||a.name===state.getItem("targetFrombattle_monster","")||a.name===state.getItem("targetFromfortify","");a.name===state.getItem("targetFromfortify","")&&a.fortify>m&&state.setItem("resetselectMonster",true);utility.log(1,"Start of Keep On Budget (KOB) Code");s=false;n=0;D=w=r=false;x=monster.parseCondition("kob",a.conditions);if(isNaN(x)){utility.log(1,"NaN branch");s=true;n=0}else if(x){utility.log(1,"passed value branch");s=true;n=x}else{utility.log(1,"false branch");
s=false;n=0}if(!s&&gm.getItem("KOBAllMonters",false,hiddenVar))s=true;if(this.InLevelUpMode()||this.stats.stamina.num>=this.stats.stamina.max-5)s=false;utility.log(1,"Level Up Mode: ",this.InLevelUpMode());utility.log(1,"Stamina Avail: ",this.stats.stamina.num);utility.log(1,"Stamina Max: ",this.stats.stamina.max);utility.log(1,"KOBenable: ",s);utility.log(1,"KOB Bias Hours: ",n);G=monster.info[a.type].duration;utility.log(1,"Total Time for Monster: ",G);utility.log(1,"HP left: ",a.life);A=parseInt(c[0],
10)+parseInt(c[1],10)*0.0166;utility.log(1,"TimeLeft: ",A);z=A-n;if(G>=168)G-=gm.getItem("KOBDelayStart",48,hiddenVar);B=Math.round(z/G*1E3)/10;utility.log(1,"Percent Time Remaining: ",B);if(h&&a.damage>=h){a.color="red";a.over="max";w=true;utility.log(1,"KOB - max activated");t&&state.setItem("resetselectMonster",true)}else if(a.fortify!==-1&&a.fortify<config.getItem("MinFortToAttack",1)){a.color="purple";D=true;utility.log(1,"KOB - MinFort activated");t&&state.setItem("resetselectMonster",true)}else if(a.damage>=
o&&(config.getItem("AchievementMode",false)||monster.parseCondition("ach",a.conditions))){a.color="orange";a.over="ach";r=true;utility.log(1,"KOB - achievement reached");t&&a.damage<o&&state.setItem("resetselectMonster",true)}if(s&&!w&&!D&&r&&a.life<B){a.color="magenta";a.over="max";utility.log(1,"KOB - budget reached");if(t){state.setItem("resetselectMonster",true);utility.log(1,"This monster no longer a target due to kob")}}else if(!w&&!D&&!r)a.color="black"}else a.color="black";monster.setItem(a);
this.UpdateDashboard(true);schedule.check("battleTimer")&&window.setTimeout(function(){caap.SetDivContent("monster_mess","")},2E3)}else{utility.log(1,"Monster is dead or fled");a.color="grey";if(a.status!=="Complete"&&a.status!=="Collect Reward")a.status="Dead or Fled";state.setItem("resetselectMonster",true);monster.setItem(a)}}catch(I){utility.error("ERROR in CheckResults_viewFight: "+I)}},MonsterReview:function(){try{if(!schedule.check("monsterReview")||config.getItem("WhenMonster","Never")===
"Never"&&config.getItem("WhenBattle","Never")==="Never")return false;var b=state.getItem("monsterReviewCounter",-3),a="",c=(new Date).getTime();if(b===-3){state.setItem("monsterReviewCounter",b+1);return true}if(b===-2){if(this.stats.level>6){if(utility.NavigateTo("keep,battle_monster","tab_monster_list_on.gif")){state.setItem("reviewDone",false);return true}}else{utility.log(1,"Monsters: Unlock at level 7");state.setItem("reviewDone",true)}if(state.getItem("reviewDone",true))state.setItem("monsterReviewCounter",
b+=1);else return true}if(b===-1){if(this.stats.level>7){if(utility.NavigateTo(this.battlePage+",raid","tab_raid_on.gif")){state.setItem("reviewDone",false);return true}}else{utility.log(1,"Raids: Unlock at level 8");state.setItem("reviewDone",true)}if(state.getItem("reviewDone",true))state.setItem("monsterReviewCounter",b+=1);else return true}if(monster.records&&monster.records.length===0)return false;for(;b<monster.records.length;)if(monster.records[b]){if(monster.records[b].color==="grey"&&monster.records[b].life!==
-1){monster.records[b].life=-1;monster.records[b].fortify=-1;monster.records[b].strength=-1;monster.records[b].timeLeft="";monster.records[b].t2k=-1;monster.records[b].phase=""}c=monster.records[b].review?monster.records[b].review:(new Date(2009,0,1)).getTime();if(monster.records[b].status==="Complete"||!schedule.since(c,gm.getItem("MonsterLastReviewed",15,hiddenVar)*60)||state.getItem("monsterRepeatCount",0)>2){state.setItem("monsterReviewCounter",b+=1);state.setItem("monsterRepeatCount",0)}else{this.SetDivContent("monster_mess",
"Reviewing/sieging "+(b+1)+"/"+monster.records.length+" "+monster.records[b].name);a=monster.records[b].link;if(/href/.test(a)){a=a.split("'")[1];if((monster.records[b].conditions&&/:ac\b/.test(monster.records[b].conditions)||monster.records[b].type.match(/Raid/)&&config.getItem("raidCollectReward",false)||!monster.records[b].type.match(/Raid/)&&config.getItem("monsterCollectReward",false))&&monster.records[b].status==="Collect Reward"){if(general.Select("CollectGeneral"))return true;a+="&action=collectReward";
if(monster.records[b].name.indexOf("Siege")>=0)a+=monster.records[b].rix!==-1?"&rix="+monster.records[b].rix:"&rix=2";a=a.replace("&action=doObjective","");state.setItem("CollectedRewards",true)}else if(monster.records[b].conditions&&monster.records[b].conditions.match(":!s")||!config.getItem("raidDoSiege",true)&&monster.records[b].type.match(/Raid/)||!config.getItem("monsterDoSiege",true)&&!monster.records[b].type.match(/Raid/)&&monster.info[monster.records[b].type].siege||this.stats.stamina.num===
0)a=a.replace("&action=doObjective","");utility.log(1,"Reviewing "+(b+1)+"/"+monster.records.length+" "+monster.records[b].name);state.setItem("ReleaseControl",true);a=a.replace("http://apps.facebook.com/castle_age/","");a=a.replace("?","?twt2&");utility.log(9,"Link",a);utility.ClickAjax(a);state.setItem("monsterRepeatCount",state.getItem("monsterRepeatCount",0)+1);state.setItem("resetselectMonster",true);return true}}}else state.setItem("monsterReviewCounter",b+=1);schedule.setItem("monsterReview",
gm.getItem("monsterReviewMins",60,hiddenVar)*60,300);state.setItem("resetselectMonster",true);state.setItem("monsterReviewCounter",-3);utility.log(1,"Done with monster/raid review.");this.SetDivContent("monster_mess","");this.UpdateDashboard(true);if(state.getItem("CollectedRewards",false)){state.setItem("CollectedRewards",false);monster.flagReview()}return true}catch(d){utility.error("ERROR in MonsterReview: "+d);return false}},Monsters:function(){try{if(config.getItem("WhenMonster","Never")==="Never"){this.SetDivContent("monster_mess",
"Monster off");return false}if(config.getItem("WhenMonster","Never")==="Stay Hidden"&&this.NeedToHide()&&this.CheckStamina("Monster",1)){utility.log(1,"Stay Hidden Mode: We're not safe. Go battle.");this.SetDivContent("monster_mess","Not Safe For Monster. Battle!");return false}if(!schedule.check("NotargetFrombattle_monster"))return false;if(!this.InLevelUpMode()&&this.stats.stamina.num===state.getItem("MonsterStaminaReq",1)-1&&schedule.check("battleTimer")&&config.getItem("seedTime",0)>0){schedule.setItem("battleTimer",
300,config.getItem("seedTime",0));this.SetDivContent("monster_mess","Monster Delay Until "+schedule.display("battleTimer"));return false}if(!schedule.check("battleTimer"))if(this.stats.stamina.num<general.GetStaminaMax(config.getItem("IdleGeneral","Use Current"))){this.SetDivContent("monster_mess","Monster Delay Until "+schedule.display("battleTimer"));return false}var b="",a=state.getItem("targetFromfortify",""),c=monster.type(a),d=0,e=10,g=monster.getItem(a);if(c){if(!this.InLevelUpMode()&&config.getItem("PowerFortifyMax",
false)&&monster.info[c].staLvl)for(d=monster.info[c].staLvl.length-1;d>=0;d-=1)if(this.stats.stamina.max>=monster.info[c].staLvl[d])break;if(d>=0&&d!==null&&d!==undefined&&config.getItem("PowerAttackMax",false))e=monster.info[c].nrgMax[d]}utility.log(9,"Energy Required/Node",e,d);if(config.getItem("FortifyGeneral","Use Current")==="Orc King"){e*=5;utility.log(2,"Monsters Fortify:Orc King",e)}if(config.getItem("FortifyGeneral","Use Current")==="Barbarus"){e*=3;utility.log(2,"Monsters Fortify:Barbarus",
e)}if(a&&this.CheckEnergy(e,gm.getItem("WhenFortify","Energy Available",hiddenVar),"fortify_mess"))b="Fortify";else{a=state.getItem("targetFrombattle_monster","");c=monster.type(a);g=monster.getItem(a);if(a&&this.CheckStamina("Monster",state.getItem("MonsterStaminaReq",1))&&g.page==="battle_monster")b="Monster";else{schedule.setItem("NotargetFrombattle_monster",60);return false}}if(general.Select(b+"General"))return true;e="dragon_title_owner";if(c&&monster.info[c].alpha)e="nm_top";if($("div[style*='"+
e+"']").length){if(monster.ConfirmRightPage(a))return true;var f=null,j=["button_nm_p_attack.gif","attack_monster_button.jpg","event_attack1.gif","seamonster_attack.gif","event_attack2.gif","attack_monster_button2.jpg"],i=[];if(b==="Fortify"){i=["seamonster_fortify.gif","button_dispel.gif","attack_monster_button3.jpg"];g&&g.stunDo&&g.stunType!==""?i.unshift("button_nm_s_"+g.stunType):i.unshift("button_nm_s_");utility.log(1,"monster/button list",g,i)}else if(state.getItem("MonsterStaminaReq",1)===
1)i=j;else{var k=g.conditions;var l=e=0,p=false;if(config.getItem("UseTactics",false)&&this.stats.level>=50){p=true;e=config.getItem("TacticsThreshold",false)}if(k&&k.match(/:tac/i)&&this.stats.level>=50){p=true;e=monster.parseCondition("tac%",k)}if(p)l=g.fortify;if(e!==false&&l<e){utility.log(1,"Party health is below threshold value",l,e);p=false}if(p&&utility.CheckForImage("nm_button_tactics.gif")){utility.log(1,"Attacking monster using tactics buttons");i=["nm_button_tactics.gif"].concat(j)}else{utility.log(1,
"Attacking monster using regular buttons");i=["button_nm_p_power","button_nm_p_","power_button_","attack_monster_button2.jpg","event_attack2.gif","seamonster_power.gif","event_attack1.gif","attack_monster_button.jpg"].concat(j)}}d=0;if(!this.InLevelUpMode())if((b==="Fortify"&&config.getItem("PowerFortifyMax",false)||b!=="Fortify"&&config.getItem("PowerAttack",false)&&config.getItem("PowerAttackMax",false))&&monster.info[c].staLvl)for(d=monster.info[c].staLvl.length-1;d>=0;d-=1)if(this.stats.stamina.max>=
monster.info[c].staLvl[d])break;for(var o in i)if(i.hasOwnProperty(o))if(f=utility.CheckForImage(i[o],null,null,d))break;if(f){c="";c=b==="Fortify"?"Fortifying "+a:(state.getItem("MonsterStaminaReq",1)>=5?"Power":"Single")+" Attacking "+a;utility.log(1,c);this.SetDivContent("monster_mess",c);state.setItem("ReleaseControl",true);utility.Click(f,8E3);return true}else{utility.warn("No button to attack/fortify with.");schedule.setItem("NotargetFrombattle_monster",60);return false}}if(utility.NavigateTo("keep,battle_monster",
"tab_monster_list_on.gif"))return true;if(config.getItem("clearCompleteMonsters",false)&&monster.completeButton.battle_monster.button&&monster.completeButton.battle_monster.name){utility.Click(monster.completeButton.battle_monster.button);monster.deleteItem(monster.completeButton.battle_monster.name);monster.completeButton.battle_monster={};this.UpdateDashboard(true);utility.log(1,"Cleared a completed monster");return true}if((f=utility.CheckForImage("dragon_list_btn_"))&&!(f.parentNode.href.match("user="+
this.stats.FBID)||f.parentNode.href.match(/alchemy\.php/)))if(j=state.getItem("pageUserCheck","")){utility.log(1,"On another player's keep.",j);return utility.NavigateTo("keep,battle_monster","tab_monster_list_on.gif")}if(i=monster.engageButtons[a]){this.SetDivContent("monster_mess","Opening "+a);utility.Click(i);return true}else{schedule.setItem("NotargetFrombattle_monster",60);utility.warn('No "Engage" button for ',a);return false}}catch(h){utility.error("ERROR in Monsters: "+h);return false}},
demi:{ambrosia:{power:{total:0,max:0,next:0},daily:{num:0,max:0,dif:0}},malekus:{power:{total:0,max:0,next:0},daily:{num:0,max:0,dif:0}},corvintheus:{power:{total:0,max:0,next:0},daily:{num:0,max:0,dif:0}},aurora:{power:{total:0,max:0,next:0},daily:{num:0,max:0,dif:0}},azeron:{power:{total:0,max:0,next:0},daily:{num:0,max:0,dif:0}}},LoadDemi:function(){if(gm.getItem("demipoint.records","default")==="default")gm.setItem("demipoint.records",this.demi);else this.demi=gm.getItem("demipoint.records",this.demi);
utility.log(2,"Demi",this.demi);state.setItem("UserDashUpdate",true)},SaveDemi:function(){gm.setItem("demipoint.records",this.demi);utility.log(2,"Demi",this.demi);state.setItem("UserDashUpdate",true)},demiTable:{0:"ambrosia",1:"malekus",2:"corvintheus",3:"aurora",4:"azeron"},CheckResults_battle:function(){try{var b=null,a=[],c=true;if((b=$("#app46755028429_app_body img[src*='symbol_tiny_']").not("img[src*='rewards.jpg']"))&&b.length===5){b.each(function(){var e=$(this).parent().parent().next().text().replace(/\s/g,
"");if(e)a.push(e);else{c=false;utility.warn("Demi temp text problem",e)}});utility.log(2,"Points",a);if(c){this.demi.ambrosia.daily=this.GetStatusNumbers(a[0]);this.demi.malekus.daily=this.GetStatusNumbers(a[1]);this.demi.corvintheus.daily=this.GetStatusNumbers(a[2]);this.demi.aurora.daily=this.GetStatusNumbers(a[3]);this.demi.azeron.daily=this.GetStatusNumbers(a[4]);schedule.setItem("battle",gm.getItem("CheckDemi",6,hiddenVar)*3600,300);this.SaveDemi()}}else utility.warn("Demi symDiv problem",b);
return true}catch(d){utility.error("ERROR in CheckResults_battle: "+d);return false}},DemiPoints:function(){try{if(!config.getItem("DemiPointsFirst",false)||config.getItem("WhenMonster","Never")==="Never"||this.stats.level<9)return false;if(schedule.check("battle")){utility.log(5,"DemiPointsFirst battle page check");if(utility.NavigateTo(this.battlePage,"battle_on.gif"))return true}var b="",a=true;for(b in this.demi)if(this.demi.hasOwnProperty(b))if(this.demi[b].daily.dif>0){a=false;break}utility.log(5,
"DemiPointsDone",b,a);state.setItem("DemiPointsDone",a);return a?false:this.Battle("DemiPoints")}catch(c){utility.error("ERROR in DemiPoints: "+c);return false}},InLevelUpMode:function(){try{if(!gm.getItem("EnableLevelUpMode",true,hiddenVar)){state.setItem("newLevelUpMode",false);return false}if(!this.stats.indicators.enl||this.stats.indicators.enl.toString().match((new Date(2009,1,1)).getTime())){state.setItem("newLevelUpMode",false);return false}if(this.stats.indicators.enl-(new Date).getTime()<
3E4||this.stats.exp.dif<=config.getItem("LevelUpGeneralExp",0)){if(!state.getItem("newLevelUpMode",false)){state.setItem("newLevelUpMode",true);this.refreshMonstersListener()}return true}state.setItem("newLevelUpMode",false);return false}catch(b){utility.error("ERROR in InLevelUpMode: "+b);return false}},CheckStamina:function(b,a){try{utility.log(9,"CheckStamina",b,a);a||(a=1);var c=config.getItem("When"+b,"Never"),d=0,e="";if(c==="Never")return false;if(!this.stats.stamina||!this.stats.health){this.SetDivContent("battle_mess",
"Health or stamina not known yet.");return false}if(this.stats.health.num<10){this.SetDivContent("battle_mess","Need health to fight: "+this.stats.health.num+"/10");return false}if(config.getItem("waitSafeHealth",false)&&this.stats.health.num<12){this.SetDivContent("battle_mess","Unsafe. Need spare health to fight: "+this.stats.health.num+"/12");return false}if(c==="At X Stamina"){if(this.InLevelUpMode()&&this.stats.stamina.num>=a){this.SetDivContent("battle_mess","Burning stamina to level up");return true}c=
b+"Stamina";if(state.getItem("BurnMode_"+c,false)||this.stats.stamina.num>=config.getItem("X"+c,1)){if(this.stats.stamina.num<a||this.stats.stamina.num<=config.getItem("XMin"+c,0)){state.setItem("BurnMode_"+c,false);return false}state.setItem("BurnMode_"+c,true);return true}else state.setItem("BurnMode_"+c,false);this.SetDivContent("battle_mess","Waiting for stamina: "+this.stats.stamina.num+"/"+config.getItem("X"+c,1));return false}if(c==="At Max Stamina"){d=this.stats.stamina.max;e=config.getItem("IdleGeneral",
"Use Current");if(e!=="Use Current")d=general.GetStaminaMax(e);if(e!=="Use Current"&&!d){utility.log(1,"Changing to idle general to get Max Stamina");if(general.Select("IdleGeneral"))return true}if(this.stats.stamina.num>=d){this.SetDivContent("battle_mess","Using max stamina");return true}if(this.InLevelUpMode()&&this.stats.stamina.num>=a){this.SetDivContent("battle_mess","Burning all stamina to level up");return true}this.SetDivContent("battle_mess","Waiting for max stamina: "+this.stats.stamina.num+
"/"+d);return false}if(this.stats.stamina.num>=a)return true;this.SetDivContent("battle_mess","Waiting for more stamina: "+this.stats.stamina.num+"/"+a);return false}catch(g){utility.error("ERROR in CheckStamina: "+g);return false}},NeedToHide:function(){if(config.getItem("WhenMonster","Never")==="Never"){utility.log(1,"Stay Hidden Mode: Monster battle not enabled");return true}if(!state.getItem("targetFrombattle_monster","")){utility.log(1,"Stay Hidden Mode: No monster to battle");return true}return this.stats.health.num-
(this.stats.stamina.num-1)*gm.getItem("HidingRiskConstant",1.7,hiddenVar)<10&&this.stats.stamina.num*(5/3)>=5?false:true},ConsumePotion:function(b){try{if(!$(".statsTTitle").length){utility.log(1,"Going to keep for potions");if(utility.NavigateTo("keep"))return true}var a="app46755028429_consume_1",c=null,d=null;if(b==="stamina")a="app46755028429_consume_2";utility.log(1,"Consuming potion potion");if((c=$("form[id='"+a+"'] input[src*='potion_consume.gif']"))&&c.length)if(d=c.get(0))utility.Click(d);
else{utility.warn("Could not find consume button for",b);return false}else{utility.warn("Could not find consume form for",b);return false}return true}catch(e){utility.error("ERROR in ConsumePotion: "+e,b);return false}},AutoPotions:function(){try{if(!config.getItem("AutoPotions",true)||!schedule.check("AutoPotionTimerDelay"))return false;if(this.stats.exp.dif<=config.getItem("potionsExperience",20)){utility.log(1,"AutoPotions, ENL condition. Delaying 10 minutes");schedule.setItem("AutoPotionTimerDelay",
600);return false}if(this.stats.energy.num<this.stats.energy.max-10&&this.stats.potions.energy>=config.getItem("energyPotionsSpendOver",39)&&this.stats.potions.energy>config.getItem("energyPotionsKeepUnder",35))return this.ConsumePotion("energy");if(this.stats.stamina.num<this.stats.stamina.max-10&&this.stats.potions.stamina>=config.getItem("staminaPotionsSpendOver",39)&&this.stats.potions.stamina>config.getItem("staminaPotionsKeepUnder",35))return this.ConsumePotion("stamina");return false}catch(b){utility.error("ERROR in AutoPotion: "+
b);return false}},AutoAlchemy:function(){try{if(!config.getItem("AutoAlchemy",false))return false;if(!schedule.check("AlchemyTimer"))return false;if(!utility.NavigateTo("keep,alchemy","tab_alchemy_on.gif")){var b=null,a=null,c=null;if((a=$("#app46755028429_recipe_list"))&&a.length){if(a.attr("class")!=="show_items")if((c=a.find("div[id*='alchemy_item_tab']"))&&c.length)if(b=c.get(0)){utility.Click(b,5E3);return true}else{utility.warn("Cant find tab button",b);return false}else{utility.warn("Cant find item tab",
c);return false}}else{utility.warn("Cant find recipe list",a);return false}if(b=utility.CheckForImage("help_close_x.gif")){utility.Click(b,1E3);return true}var d=document.evaluate(".//div[@class='alchemyRecipeBack']",document.body,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(c=0;c<d.snapshotLength;c+=1){a=d.snapshotItem(c);if(nHtml.FindByAttrContains(a,"div","class","missing"))utility.log(5,"Skipping Recipe");else if(utility.CheckForImage("raid_hearts",a)&&!config.getItem("AutoAlchemyHearts",
false))utility.log(1,"Skipping Hearts");else if(b=nHtml.FindByAttrXPath(a,"input","@type='image'")){utility.Click(b,2E3);return true}else utility.warn("Cant Find Item Image Button")}schedule.setItem("AlchemyTimer",10800,300);return false}return true}catch(e){utility.error("ERROR in Alchemy: "+e);return false}},ImmediateBanking:function(){if(!config.getItem("BankImmed",false))return false;return this.Bank()},Bank:function(){try{if(config.getItem("NoBankAfterLvl",true)&&state.getItem("KeepLevelUpGeneral",
false))return false;var b=config.getItem("MaxInCash",-1),a=config.getItem("MinInCash",0);if(!b||b<0||this.stats.gold.cash<=a||this.stats.gold.cash<b||this.stats.gold.cash<10)return false;if(general.Select("BankingGeneral"))return true;var c=utility.CheckForImage("btn_stash.gif");if(!c)return utility.NavigateTo("keep");var d=nHtml.FindByAttrXPath(c.form,"input","@type='' or @type='text'");if(d)d.value=parseInt(d.value,10)-a;else{utility.warn("Cannot find box to put in number for bank deposit.");return false}utility.log(1,
"Depositing into bank");utility.Click(c);return true}catch(e){utility.error("ERROR in Bank: "+e);return false}},RetrieveFromBank:function(b){try{if(b<=0)return false;var a=utility.CheckForImage("btn_retrieve.gif");if(!a)return utility.NavigateTo("keep");var c=config.getItem("minInStore",0);if(!(c||c<=this.stats.gold.bank-b))return false;var d=nHtml.FindByAttrXPath(a.form,"input","@type='' or @type='text'");if(d)d.value=b;else{utility.warn("Cannot find box to put in number for bank retrieve.");return false}utility.log(1,
"Retrieving from bank: ",b);state.setItem("storeRetrieve","");utility.Click(a);return true}catch(e){utility.error("ERROR in RetrieveFromBank: "+e);return false}},Heal:function(){try{var b=0,a=0;this.SetDivContent("heal_mess","");b=config.getItem("MinToHeal",0);if(!b)return false;a=config.getItem("MinStamToHeal",0);if(a==="")a=0;if(!this.stats.health)return false;if(config.getItem("WhenBattle","Never")!=="Never"||config.getItem("WhenMonster","Never")!=="Never")if((this.InLevelUpMode()||this.stats.stamina.num>=
this.stats.stamina.max)&&this.stats.health.num<10){utility.log(1,"Heal");return utility.NavigateTo("keep,heal_button.gif")}if(this.stats.health.num>=this.stats.health.max||this.stats.health.num>=b)return false;if(this.stats.stamina.num<a){this.SetDivContent("heal_mess","Waiting for stamina to heal: "+this.stats.stamina.num+"/"+a);return false}utility.log(1,"Heal");return utility.NavigateTo("keep,heal_button.gif")}catch(c){utility.error("ERROR in Heal: "+c);return false}},AutoElite:function(){try{if(!config.getItem("AutoElite",
false))return false;if(!schedule.check("AutoEliteGetList")){!state.getItem("FillArmy",false)&&state.getItem(this.friendListType.giftc.name+"Requested",false)&&state.setItem(this.friendListType.giftc.name+"Requested",false);return false}utility.log(1,"Elite Guard cycle");var b=function(f){utility.log(1,"Elite Guard MergeMyEliteTodo list");var j=utility.TextToArray(config.getItem("EliteArmyList",""));if(j.length){utility.log(1,"Merge and save Elite Guard MyEliteTodo list");f=f.filter(function(i){return j.indexOf(i)<
0});$.merge(j,f);state.setItem("MyEliteTodo",j)}else{utility.log(1,"Save Elite Guard MyEliteTodo list");state.setItem("MyEliteTodo",f)}},a=state.getItem("MyEliteTodo",[]);if(!$.isArray(a)){utility.warn("MyEliteTodo list is not expected format, deleting",a);a=state.setItem("MyEliteTodo",[])}if(window.location.href.indexOf("party.php")){utility.log(1,"Checking Elite Guard status");var c=state.getItem("AutoEliteFew",false),d=$(".result_body").text().match(/YOUR Elite Guard is FULL/i);if(d||c&&state.getItem("AutoEliteEnd",
"")==="NoArmy"){if(d){utility.log(1,"Elite Guard is FULL");a.length&&b(a)}else if(c&&state.getItem("AutoEliteEnd","")==="NoArmy"){utility.log(1,"Not enough friends to fill Elite Guard");state.setItem("AutoEliteFew",false)}utility.log(1,"Set Elite Guard AutoEliteGetList timer");schedule.setItem("AutoEliteGetList",21600,300);state.setItem("AutoEliteEnd","Full");utility.log(1,"Elite Guard done");return false}}if(a.length){if(schedule.check("AutoEliteReqNext")){utility.log(1,"Elite Guard has a MyEliteTodo list, shifting User ID");
var e=a.shift();utility.log(1,"Add Elite Guard ID: ",e);utility.ClickAjax("party.php?twt=jneg&jneg=true&user="+e);utility.log(1,"Elite Guard sent request, saving shifted MyEliteTodo");state.setItem("MyEliteTodo",a);schedule.setItem("AutoEliteReqNext",7);if(!a.length){utility.log(1,"Army list exhausted");state.setItem("AutoEliteEnd","NoArmy")}}}else{utility.log(1,"Elite Guard no MyEliteTodo cycle");c=false;if(state.getItem(this.friendListType.giftc.name+"Requested",false)&&state.getItem(this.friendListType.giftc.name+
"Responded",false)===true){utility.log(1,"Elite Guard received 0 friend ids");if(utility.TextToArray(config.getItem("EliteArmyList","")).length){utility.log(1,"Elite Guard has some defined friend ids");c=true}else{schedule.setItem("AutoEliteGetList",21600,300);utility.log(1,"Elite Guard has 0 defined friend ids");state.setItem("AutoEliteEnd","Full");utility.log(1,"Elite Guard done");return false}}this.GetFriendList(this.friendListType.giftc);d=[];if(state.getItem(this.friendListType.giftc.name+"Responded",
false)!==true)d=state.getItem(this.friendListType.giftc.name+"Responded",[]);if(d.length||this.stats.army.capped<=1||c){utility.log(1,"Elite Guard received a new friend list");b(d);state.setItem(this.friendListType.giftc.name+"Responded",[]);state.setItem(this.friendListType.giftc.name+"Requested",false);a=state.getItem("MyEliteTodo",[]);if(a.length===0){utility.log(1,"WARNING! Elite Guard friend list is 0");state.setItem("AutoEliteFew",true);schedule.setItem("AutoEliteGetList",21600,300)}else if(a.length<
50){utility.log(1,"WARNING! Elite Guard friend list is fewer than 50: ",a.length);state.setItem("AutoEliteFew",true)}}}utility.log(1,"Release Elite Guard cycle");return true}catch(g){utility.error("ERROR in AutoElite: "+g);return false}},PassiveGeneral:function(){if(config.getItem("IdleGeneral","Use Current")!=="Use Current")if(general.Select("IdleGeneral"))return true;return false},AutoIncome:function(){if(config.getItem("NoIncomeAfterLvl",true)&&state.getItem("KeepLevelUpGeneral",false))return false;
if(this.stats.gold.payTime.minutes<1&&this.stats.gold.payTime.ticker.match(/[0-9]+:[0-9]+/)&&config.getItem("IncomeGeneral","Use Current")!=="Use Current"){general.Select("IncomeGeneral");return true}return false},CheckResults_army:function(){if(config.getItem("AutoGift",false)){if($("a[href*='reqs.php#confirm_46755028429_0']").length){utility.log(1,"We have a gift waiting!");state.setItem("HaveGift",true)}else{utility.log(1,"No gifts waiting.");state.setItem("HaveGift",false)}schedule.setItem("ajaxGiftCheck",
gm.getItem("CheckGiftMins",15,hiddenVar)*60,300)}for(var b=$('div[style="padding: 0pt 0pt 10px 0px; overflow: hidden; float: left; width: 240px; height: 50px;"]').find('a[text="Ignore"]'),a=0;a<b.length;a+=1){var c="<br /><a title='This link can be used to collect the gift when it has been lost on Facebook. !!If you accept a gift in this manner then it will leave an orphan request on Facebook!!' href='"+b[a].href.replace("ignore","acpt")+"'>Lost Accept</a>";$(c).insertAfter($('div[style="padding: 0pt 0pt 10px 0px; overflow: hidden; float: left; width: 240px; height: 50px;"]').find("a[href="+
b[a].href+"]"))}},SortObject:function(b,a,c){var d=[],e={},g=0;if(typeof c==="undefined")c=false;for(g in b)b.hasOwnProperty(g)&&d.push(g);d.sort(a);for(g=0;g<d.length;g+=1)e[d[g]]=c&&typeof b[d[g]]==="object"?this.SortObject(b[d[g]],a,c):b[d[g]];return e},News:function(){try{if($("#app46755028429_battleUpdateBox").length){var b=0,a=0,c=0,d=0,e=0,g=0,f=0,j,i=[],k={};$("#app46755028429_battleUpdateBox .alertsContainer .alert_content").each(function(p,o){var h,m=$(o).text().replace(/,/g,"");h=$(o).prev().text();
h.regex(/([0-9]+) days/i);h.regex(/([0-9]+) hours/i);h.regex(/([0-9]+) minutes/i);h.regex(/([0-9]+) seconds/i);var t=h=0,s=0,n=0;Date.now();if(m.regex(/You were killed/i))g+=1;else{h=$("a:eq(0)",o).attr("href").regex(/user=([0-9]+)/i);k[h]=k[h]||{name:$("a:eq(0)",o).text(),win:0,lose:0};if(m.regex(/Victory!/i)){d+=1;k[h].lose+=1;h=m.regex(/([0-9]+) experience/i);t=m.regex(/([0-9]+) Battle Points!/i);s=m.regex(/([0-9]+) War Points!/i);n=m.regex(/\$([0-9]+)/i)}else{e+=1;k[h].win+=1;h=0-m.regex(/([0-9]+) experience/i);
t=0-m.regex(/([0-9]+) Battle Points!/i);s=0-m.regex(/([0-9]+) War Points!/i);n=0-m.regex(/\$([0-9]+)/i)}b+=h;a+=t;c+=s;f+=n}});if(d||e){i.push("You were challenged <strong>"+(d+e)+"</strong> times,<br>winning <strong>"+d+"</strong> and losing <strong>"+e+"</strong>.");i.push("You "+(b>=0?'gained <span class="positive">':'lost <span class="negative">')+this.makeCommaValue(Math.abs(b))+"</span> experience points.");i.push("You "+(f>=0?'gained <span class="positive">':'lost <span class="negative">')+
'<b class="gold">$'+this.makeCommaValue(Math.abs(f))+"</b></span>.");i.push("You "+(a>=0?'gained <span class="positive">':'lost <span class="negative">')+this.makeCommaValue(Math.abs(a))+"</span> Battle Points.");i.push("You "+(c>=0?'gained <span class="positive">':'lost <span class="negative">')+this.makeCommaValue(Math.abs(c))+"</span> War Points.");i.push("");k=this.SortObject(k,function(p,o){return k[o].win+k[o].lose/100-(k[p].win+k[p].lose/100)});for(j in k)if(k.hasOwnProperty(j))i.push('<strong title="'+
j+'">'+k[j].name+"</strong> "+(k[j].win?'beat you <span class="negative">'+k[j].win+"</span> time"+(k[j].win>1?"s":""):"")+(k[j].lose?(k[j].win?" and ":"")+'was beaten <span class="positive">'+k[j].lose+"</span> time"+(k[j].lose>1?"s":""):"")+".");if(g)i.push("You died "+(g>1?g+" times":"once")+"!");$("#app46755028429_battleUpdateBox .alertsContainer").prepend('<div style="padding: 0pt 0pt 10px;"><div class="alert_title">Summary:</div><div class="alert_content">'+i.join("<br>")+"</div></div>")}}return true}catch(l){utility.error("ERROR in News: "+
l);return false}},CheckResults_index:function(b){config.getItem("NewsSummary",true)&&this.News();if(config.getItem("AutoGift",false)){if(b&&/Send Gifts to Friends/.test(b)){utility.log(1,"We have a gift waiting!");state.setItem("HaveGift",true)}else{utility.log(1,"No gifts waiting.");state.setItem("HaveGift",false)}schedule.setItem("ajaxGiftCheck",gm.getItem("CheckGiftMins",15,hiddenVar)*60,300)}},CheckResults_gift_accept:function(){gifting.queue.sent();gifting.collected()},GiftExceedLog:true,AutoGift:function(){try{var b=
null,a="",c="",d="",e,g;if(!config.getItem("AutoGift",false))return false;e=gifting.popCheck();if(typeof e==="boolean")return e;if(gifting.gifts.length()<=2)if(utility.NavigateTo("army,gift","tab_gifts_on.gif"))return true;g=gifting.collecting();if(typeof g==="boolean")return g;if(gifting.queue.collectOnly())return false;if(!schedule.check("NoGiftDelay"))return false;if(!schedule.check("MaxGiftsExceeded")){if(this.GiftExceedLog){utility.log(1,"Gifting limit exceeded, will try later");this.GiftExceedLog=
false}return false}d=gifting.queue.chooseGift();if(gifting.queue.length()&&d){if(utility.NavigateTo("army,gift","tab_gifts_on.gif"))return true;if(c=gifting.gifts.getImg(d)){utility.NavigateTo("gift_more_gifts.gif");if((b=$("#app46755028429_giftContainer img[class='imgButton']:first"))&&b.length){a=utility.getHTMLPredicate(b.attr("src"));if(a!==c){utility.log(2,"images",a,c);return utility.NavigateTo(c)}utility.log(1,"Gift selected")}}else utility.log(1,"Unknown gift, using first",d,c);if(gifting.queue.chooseFriend(5))if((b=
$("form[id*='req_form_'] input[name='send']"))&&b.length){utility.Click(b.get(0));return true}else{utility.warn("Send button not found!");return false}else{utility.warn("No friends chosen!");return false}}if(utility.isEmpty(gifting.getCurrent()))return false;return true}catch(f){utility.error("ERROR in AutoGift: "+f);return false}},ImmediateAutoStat:function(){if(!config.getItem("StatImmed",false)||!config.getItem("AutoStat",false))return false;return caap.AutoStat()},IncreaseStat:function(b,a,c){try{utility.log(9,
"Attribute: "+b+"   Adjust: "+a);b=b.toLowerCase();var d=null,e=null,g=0,f=0,j=0,i=0,k=0,l=0,p=0,o=0,h="";e=$("#app46755028429_AjaxLoadIcon");if(!e.length||e.css("display")!=="none"){utility.warn("Unable to find AjaxLoadIcon or page not loaded: Fail");return"Fail"}if(b==="stamina"&&this.stats.points.skill<2)if(config.getItem("StatSpendAll",false)){utility.log(1,"Stamina requires 2 upgrade points: Next");return"Next"}else{utility.log(1,"Stamina requires 2 upgrade points: Save");state.setItem("statsMatch",
false);return"Save"}switch(b){case "energy":d=nHtml.FindByAttrContains(c,"a","href","energy_max");break;case "stamina":d=nHtml.FindByAttrContains(c,"a","href","stamina_max");break;case "attack":d=nHtml.FindByAttrContains(c,"a","href","attack");break;case "defense":d=nHtml.FindByAttrContains(c,"a","href","defense");break;case "health":d=nHtml.FindByAttrContains(c,"a","href","health_max");break;default:throw"Unable to match attribute: "+b;}if(!d){utility.warn("Unable to locate upgrade button: Fail ",
b);return"Fail"}h=o=a;g=this.stats.level;f=parseInt(d.parentNode.parentNode.childNodes[3].firstChild.data.replace(RegExp("[^0-9]","g"),""),10);j=parseInt(nHtml.FindByAttrContains(c,"a","href","energy_max").parentNode.parentNode.childNodes[3].firstChild.data.replace(RegExp("[^0-9]","g"),""),10);i=parseInt(nHtml.FindByAttrContains(c,"a","href","stamina_max").parentNode.parentNode.childNodes[3].firstChild.data.replace(RegExp("[^0-9]","g"),""),10);if(g>=10){k=parseInt(nHtml.FindByAttrContains(c,"a","href",
"attack").parentNode.parentNode.childNodes[3].firstChild.data.replace(RegExp("[^0-9]","g"),""),10);l=parseInt(nHtml.FindByAttrContains(c,"a","href","defense").parentNode.parentNode.childNodes[3].firstChild.data.replace(RegExp("[^0-9]","g"),""),10);p=parseInt(nHtml.FindByAttrContains(c,"a","href","health_max").parentNode.parentNode.childNodes[3].firstChild.data.replace(RegExp("[^0-9]","g"),""),10)}utility.log(9,"Energy="+j+" Stamina="+i+" Attack="+k+" Defense="+l+" Heath="+p);if(config.getItem("AutoStatAdv",
false)){o=eval(a);h="("+a+")="+o}if(o>f){utility.log(1,"Status Before ["+b+"="+f+"]  Adjusting To ["+h+"]");utility.Click(d);return"Click"}return"Next"}catch(m){utility.error("ERROR in IncreaseStat: "+m);return"Error"}},AutoStatCheck:function(){try{var b=0,a=4,c="",d=0,e=0,g=0,f=0,j=false;if(!config.getItem("AutoStat",false)||!this.stats.points.skill)return false;if(config.getItem("AutoStatAdv",false)){b=5;a=9}for(e=b;e<=a;e+=1){c=config.getItem("Attribute"+e,"").toLowerCase();if(c!==""){if(this.stats.level<
10)if(c==="attack"||c==="defense"||c==="health")continue;if(c==="stamina"&&this.stats.points.skill<2)if(config.getItem("StatSpendAll",false))continue;else{j=false;break}g=d=config.getItem("AttrValue"+e,0);if(config.getItem("AutoStatAdv",false))g=eval(d);f=c==="attack"||c==="defense"?this.stats[c]:this.stats[c].num;if(g>f){j=true;break}}}state.setItem("statsMatch",j);return true}catch(i){utility.error("ERROR in AutoStatCheck: "+i);return false}},AutoStat:function(){try{if(!config.getItem("AutoStat",
false)||!this.stats.points.skill)return false;if(!state.getItem("statsMatch",true)){if(state.getItem("autoStatRuleLog",true)){utility.log(1,"User should possibly change their stats rules");state.setItem("autoStatRuleLog",false)}return false}var b=null,a=0,c=4,d="",e="",g=0,f=0,j="";b=$("div[class*='keep_attribute_section']").get(0);if(!b){utility.NavigateTo("keep");return true}if(config.getItem("AutoStatAdv",false)){a=5;c=9}for(f=a;f<=c;f+=1){d="Attribute"+f;e=config.getItem(d,"");if(e==="")utility.log(9,
d+" is blank: continue");else{if(this.stats.level<10)if(e==="Attack"||e==="Defense"||e==="Health"){utility.log(1,"Characters below level 10 can not increase Attack, Defense or Health: continue");continue}g=config.getItem("AttrValue"+f,0);j=this.IncreaseStat(e,g,b);switch(j){case "Next":utility.log(9,d+" : next");continue;case "Click":utility.log(9,d+" : click");return true;default:utility.log(9,d+" return value: "+j);return false}}}utility.log(1,"No rules match to increase stats");state.setItem("statsMatch",
false);return false}catch(i){utility.error("ERROR in AutoStat: "+i);return false}},AutoCollectMA:function(){try{if(!config.getItem("AutoCollectMA",false)||!schedule.check("AutoCollectMATimer")||this.stats.level<10)return false;utility.log(1,"Collecting Master and Apprentice reward");caap.SetDivContent("idle_mess","Collect MA Reward");var b=utility.CheckForImage("ma_view_progress_main"),a=utility.CheckForImage("ma_main_learn_more");if(!b&&!a){utility.log(1,"Going to home");if(utility.NavigateTo("index"))return true}if(b){utility.Click(b);
this.SetDivContent("idle_mess","Collected MA Reward");utility.log(1,"Collected Master and Apprentice reward")}if(!b&&a){this.SetDivContent("idle_mess","No MA Rewards");utility.log(1,"No Master and Apprentice rewards")}window.setTimeout(function(){caap.SetDivContent("idle_mess","")},5E3);schedule.setItem("AutoCollectMATimer",86400,300);utility.log(1,"Collect Master and Apprentice reward completed");return true}catch(c){utility.error("ERROR in AutoCollectMA: "+c);return false}},friendListType:{facebook:{name:"facebook",
url:"http://apps.facebook.com/castle_age/army.php?app_friends=false&giftSelection=1"},gifta:{name:"gifta",url:"http://apps.facebook.com/castle_age/gift.php?app_friends=a&giftSelection=1"},giftb:{name:"giftb",url:"http://apps.facebook.com/castle_age/gift.php?app_friends=b&giftSelection=1"},giftc:{name:"giftc",url:"http://apps.facebook.com/castle_age/gift.php?app_friends=c&giftSelection=1"}},GetFriendList:function(b,a){try{utility.log(1,"Entered GetFriendList and request is for: ",b.name);if(a){state.setItem(b.name+
"Requested",false);state.setItem(b.name+"Responded",[])}if(state.getItem(b.name+"Requested",false))utility.log(1,"Already requested GetFriendList for: ",b.name);else{utility.log(1,"Getting Friend List: ",b.name);state.setItem(b.name+"Requested",true);$.ajax({url:b.url,error:function(d,e){state.setItem(b.name+"Requested",false);utility.log(1,"GetFriendList("+b.name+"): ",e)},success:function(d,e){try{utility.log(1,"GetFriendList.ajax splitting data");d=d.split('<div class="unselected_list">');if(d.length<
2)throw"Could not locate 'unselected_list'";d=d[1].split('</div><div class="selected_list">');if(d.length<2)throw"Could not locate 'selected_list'";utility.log(1,"GetFriendList.ajax data split ok");var g=[];$("<div></div>").html(d[0]).find("input").each(function(){g.push($(this).val())});utility.log(1,"GetFriendList.ajax saving friend list of: ",g.length);g.length?state.setItem(b.name+"Responded",g):state.setItem(b.name+"Responded",true);utility.log(1,"GetFriendList("+b.name+"): ",e)}catch(f){state.setItem(b.name+
"Requested",false);utility.error("ERROR in GetFriendList.ajax: "+f)}}})}return true}catch(c){utility.error("ERROR in GetFriendList("+b.name+"): "+c);return false}},addFriendSpamCheck:0,AddFriend:function(b){try{var a=function(d,e){if(caap.addFriendSpamCheck>0)caap.addFriendSpamCheck-=1;utility.log(1,"AddFriend("+b+"): ",e)};$.ajax({url:"http://apps.facebook.com/castle_age/party.php?twt=jneg&jneg=true&user="+b+"&lka="+b+"&etw=9&ref=nf",error:a,success:a});return true}catch(c){utility.error("ERROR in AddFriend("+
b+"): "+c);return false}},AutoFillArmy:function(b,a){try{if(!state.getItem("FillArmy",false))return false;var c=state.getItem("ArmyCount",0);if(c===0){this.SetDivContent("idle_mess","Filling Army");utility.log(1,"Filling army")}if(state.getItem(b.name+"Responded",false)===true||state.getItem(a.name+"Responded",false)===true){this.SetDivContent("idle_mess",'<span style="font-weight: bold;">Fill Army Completed</span>');utility.log(1,"Fill Army Completed: no friends found");window.setTimeout(function(){caap.SetDivContent("idle_mess",
"")},5E3);state.setItem("FillArmy",false);state.setItem("ArmyCount",0);state.setItem("FillArmyList",[]);state.setItem(b.name+"Responded",false);state.setItem(a.name+"Responded",false);state.setItem(b.name+"Requested",[]);state.setItem(a.name+"Requested",[]);return true}var d=state.getItem("FillArmyList",[]);if(!d.length){this.GetFriendList(b);this.GetFriendList(a)}var e=state.getItem(b.name+"Responded",[]);utility.log(3,"gifList: ",e);var g=state.getItem(a.name+"Responded",[]);utility.log(3,"facebookList: ",
g);if(e.length&&g.length||d.length){if(!d.length){var f=g.filter(function(i){return e.indexOf(i)>=0});utility.log(3,"diffList: ",f);d=state.setItem("FillArmyList",f);state.setItem(b.name+"Responded",false);state.setItem(a.name+"Responded",false);state.setItem(b.name+"Requested",[]);state.setItem(a.name+"Requested",[])}g=5;if(d.length<5)g=d.length;else if(d.length-c<5)g=d.length-c;g-=this.addFriendSpamCheck;for(f=0;f<g;f+=1){this.AddFriend(d[c]);c+=1;this.addFriendSpamCheck+=1}this.SetDivContent("idle_mess",
"Filling Army, Please wait..."+c+"/"+d.length);utility.log(1,"Filling Army, Please wait..."+c+"/"+d.length);state.setItem("ArmyCount",c);if(c>=d.length){this.SetDivContent("idle_mess",'<span style="font-weight: bold;">Fill Army Completed</span>');window.setTimeout(function(){caap.SetDivContent("idle_mess","")},5E3);utility.log(1,"Fill Army Completed");state.setItem("FillArmy",false);state.setItem("ArmyCount",0);state.setItem("FillArmyList",[])}}return true}catch(j){utility.error("ERROR in AutoFillArmy: "+
j);this.SetDivContent("idle_mess",'<span style="font-weight: bold;">Fill Army Failed</span>');window.setTimeout(function(){caap.SetDivContent("idle_mess","")},5E3);state.setItem("FillArmy",false);state.setItem("ArmyCount",0);state.setItem("FillArmyList",[]);state.setItem(b.name+"Responded",false);state.setItem(a.name+"Responded",false);state.setItem(b.name+"Requested",[]);state.setItem(a.name+"Requested",[]);return false}},AjaxGiftCheck:function(){try{if(!config.getItem("AutoGift",false)||!schedule.check("ajaxGiftCheck"))return false;
utility.log(2,"Performing AjaxGiftCheck");$.ajax({url:"http://apps.facebook.com/castle_age/army.php",error:function(a,c){utility.error("AjaxGiftCheck.ajax",c)},success:function(a){try{utility.log(2,"AjaxGiftCheck.ajax: Checking data.");if($(a).find("a[href*='reqs.php#confirm_46755028429_0']").length){utility.log(1,"AjaxGiftCheck.ajax: We have a gift waiting!");state.setItem("HaveGift",true)}else{utility.log(1,"AjaxGiftCheck.ajax: No gifts waiting.");state.setItem("HaveGift",false)}utility.log(2,"AjaxGiftCheck.ajax: Done.")}catch(c){utility.error("ERROR in AjaxGiftCheck.ajax: "+
c)}}});schedule.setItem("ajaxGiftCheck",gm.getItem("CheckGiftMins",15,hiddenVar)*60,300);utility.log(2,"Completed AjaxGiftCheck");return true}catch(b){utility.error("ERROR in AjaxGiftCheck: "+b);return false}},Idle:function(){if(state.getItem("resetselectMonster",false)){utility.log(1,"resetselectMonster");monster.select(true);state.setItem("resetselectMonster",false)}if(this.CheckGenerals())return true;if(general.GetAllStats())return true;if(this.CheckKeep())return true;if(this.CheckAchievements())return true;
if(this.AutoCollectMA())return true;if(this.AjaxGiftCheck())return true;if(this.ReconPlayers())return true;if(this.CheckOracle())return true;if(this.CheckBattleRank())return true;if(this.CheckWarRank())return true;if(this.CheckSymbolQuests())return true;if(this.CheckSoldiers())return true;if(this.CheckItem())return true;if(this.CheckMagic())return true;if(this.CheckCharacterClasses())return true;this.AutoFillArmy(this.friendListType.giftc,this.friendListType.facebook);this.UpdateDashboard();state.setItem("ReleaseControl",
true);return true},ReconRecordArray:[],ReconRecord:function(){this.data={userID:0,nameStr:"",rankStr:"",rankNum:0,warRankStr:"",warRankNum:0,levelNum:0,armyNum:0,deityNum:0,invadewinsNum:0,invadelossesNum:0,duelwinsNum:0,duellossesNum:0,defendwinsNum:0,defendlossesNum:0,statswinsNum:0,statslossesNum:0,goldNum:0,aliveTime:(new Date(2009,0,1)).getTime(),attackTime:(new Date(2009,0,1)).getTime(),selectTime:(new Date(2009,0,1)).getTime()}},LoadRecon:function(){this.ReconRecordArray=gm.getItem("recon.records",
"default");if(this.ReconRecordArray==="default"){this.ReconRecordArray=[];gm.setItem("recon.records",this.ReconRecordArray)}state.setItem("ReconDashUpdate",true)},SaveRecon:function(){gm.setItem("recon.records",this.ReconRecordArray);state.setItem("ReconDashUpdate",true)},ReconPlayers:function(){try{if(!config.getItem("DoPlayerRecon",false))return false;if(this.stats.stamina.num<=0)return false;if(!schedule.check("PlayerReconTimer"))return false;this.SetDivContent("idle_mess","Player Recon: In Progress");
utility.log(1,"Player Recon: In Progress");$.ajax({url:"http://apps.facebook.com/castle_age/battle.php",error:function(a,c){utility.error("ReconPlayers2.ajax",c)},success:function(a){try{var c=0;utility.log(2,"ReconPlayers.ajax: Checking data.");$(a).find("img[src*='symbol_']").not("[src*='symbol_tiny_']").each(function(){var e=new caap.ReconRecord,g=$(this).parent().parent().parent().parent().parent(),f=[],j="",i=RegExp("(.+)\\s*\\(Level ([0-9]+)\\)\\s*Battle: ([A-Za-z ]+) \\(Rank ([0-9]+)\\)\\s*War: ([A-Za-z ]+) \\(Rank ([0-9]+)\\)\\s*([0-9]+)",
"i"),k=/(.+)\s*\(Level ([0-9]+)\)\s*Battle: ([A-Za-z ]+) \(Rank ([0-9]+)\)\s*([0-9]+)/i,l=gm.getItem("LimitTargets",100,hiddenVar);f=0;var p=null;p=config.getItem("ReconPlayerRank",99);var o=config.getItem("ReconPlayerLevel",999),h=config.getItem("ReconPlayerARBase",999);j=f=0;var m=true;if(g.length){if((f=g.find("a:first").attr("href").match(/user=([0-9]+)/))&&f.length===2)e.data.userID=parseInt(f[1],10);for(f=0;f<caap.ReconRecordArray.length;f+=1)if(caap.ReconRecordArray[f].userID===e.data.userID){e.data=
caap.ReconRecordArray[f];caap.ReconRecordArray.splice(f,1);utility.log(2,"UserRecord exists. Loaded and removed.",e);break}if((f=$(this).attr("src").match(/symbol_([0-9])\.jpg/))&&f.length===2)e.data.deityNum=parseInt(f[1],10);j=$.trim(g.text());if(j.length){if(caap.battles.Freshmeat.warLevel){f=i.exec(j);if(!f){f=k.exec(j);caap.battles.Freshmeat.warLevel=false}}else{f=k.exec(j);if(!f){f=i.exec(j);caap.battles.Freshmeat.warLevel=true}}if(f){e.data.aliveTime=(new Date).getTime();e.data.nameStr=$.trim(f[1]);
e.data.levelNum=parseInt(f[2],10);e.data.rankStr=f[3];e.data.rankNum=parseInt(f[4],10);if(caap.battles.Freshmeat.warLevel){e.data.warRankStr=f[5];e.data.warRankNum=parseInt(f[6],10);e.data.armyNum=parseInt(f[7],10)}else e.data.armyNum=parseInt(f[5],10);if(e.data.levelNum-caap.stats.level>o){utility.log(2,"Level above reconLevel max",o,e);m=false}else if(caap.stats.rank.battle-e.data.rankNum>p){utility.log(2,"Rank below reconRank min",p,e);m=false}else{f=caap.stats.level/e.data.levelNum;j=h*f;if(j<=
0){utility.log(2,"Recon unable to calculate army ratio",h,f);m=false}else if(e.data.armyNum>caap.stats.army.capped*j){utility.log(2,"Army above armyRatio adjustment",j,e);m=false}}if(m){for(;caap.ReconRecordArray.length>=l;){p=caap.ReconRecordArray.shift();utility.log(2,"Entry limit matched. Deleted an old record",p)}utility.log(2,"UserRecord",e);caap.ReconRecordArray.push(e.data);c+=1}}else utility.warn("Recon can not parse target text string",j)}else utility.warn("Can't find txt in $tempObj",g)}else utility.warn("$tempObj is empty")});
caap.SaveRecon();caap.SetDivContent("idle_mess","Player Recon: Found:"+c+" Total:"+caap.ReconRecordArray.length);utility.log(1,"Player Recon: Found:"+c+" Total:"+caap.ReconRecordArray.length);window.setTimeout(function(){caap.SetDivContent("idle_mess","")},5E3);utility.log(2,"ReconPlayers.ajax: Done.",caap.ReconRecordArray)}catch(d){utility.error("ERROR in ReconPlayers.ajax: "+d)}}});schedule.setItem("PlayerReconTimer",gm.getItem("PlayerReconRetry",60,hiddenVar),60);return true}catch(b){utility.error("ERROR in ReconPlayers:"+
b);return false}},actionDescTable:{AutoIncome:"Awaiting Income",AutoStat:"Upgrade Skill Points",MaxEnergyQuest:"At Max Energy Quest",PassiveGeneral:"Setting Idle General",Idle:"Idle Tasks",ImmediateBanking:"Immediate Banking",Battle:"Battling Players",MonsterReview:"Review Monsters/Raids",ImmediateAutoStat:"Immediate Auto Stats",AutoElite:"Fill Elite Guard",AutoPotions:"Auto Potions",AutoAlchemy:"Auto Alchemy",AutoBless:"Auto Bless",AutoGift:"Auto Gifting",DemiPoints:"Demi Points First",Monsters:"Fighting Monsters",
Heal:"Auto Healing",Bank:"Auto Banking",Lands:"Land Operations"},CheckLastAction:function(b){var a=state.getItem("LastAction","none");this.actionDescTable[b]?this.SetDivContent("activity_mess","Activity: "+this.actionDescTable[b]):this.SetDivContent("activity_mess","Activity: "+b);if(a!==b){utility.log(1,"Changed from doing "+a+" to "+b);state.setItem("LastAction",b)}},masterActionList:{0:"AutoElite",1:"Heal",2:"ImmediateBanking",3:"ImmediateAutoStat",4:"MaxEnergyQuest",5:"MonsterReview",6:"DemiPoints",
7:"Monsters",8:"Battle",9:"Quests",10:"Bank",11:"PassiveGeneral",12:"Lands",13:"AutoBless",14:"AutoStat",15:"AutoGift",16:"AutoPotions",17:"AutoAlchemy",18:"Idle"},actionsList:[],MakeActionsList:function(){try{if(this.actionsList&&this.actionsList.length===0){utility.log(1,"Loading a fresh Action List");var b="",a=[],c=0,d=gm.getItem("actionOrder","",hiddenVar);if(d!==""){utility.log(1,"Trying user defined Action Order");a=d.split(",");for(b in this.masterActionList)if(this.masterActionList.hasOwnProperty(b)){c+=
1;utility.log(9,"Counting Action List",c)}else{utility.warn("Error Getting Master Action List length!");utility.warn("Skipping 'action' from masterActionList: ",b)}}else{utility.log(1,"Building the default Action Order");for(b in this.masterActionList)if(this.masterActionList.hasOwnProperty(b)){c=a.push(b);utility.log(9,"Action Added",b)}else{utility.warn("Error Building Default Action Order!");utility.warn("Skipping 'action' from masterActionList: ",b)}}var e=a.length;if(e===0)throw"Action Order Array is empty! "+
(d===""?"(Default)":"(User)");e<c&&utility.warn("Warning! Action Order Array has fewer orders than default!");e>c&&utility.warn("Warning! Action Order Array has more orders than default!");utility.log(8,"Building Action List ...");for(b=0;b!==e;b+=1){c="";if(d!==""){c=this.masterActionList[parseInt(a[b],16)];utility.log(9,"("+b+") Converted user defined hex pair to action",c)}else{c=this.masterActionList[a[b]];utility.log(9,"("+b+") Converted Master Action List entry to an action",c)}if(c.length>
0&&typeof c==="string"){this.actionsList.push(c);utility.log(9,"Added action to the list",c)}else{utility.warn("Error! Skipping actionItem");utility.warn("Action Item("+b+"): ",c)}}d!==""&&utility.log(1,"Get Action List: "+this.actionsList)}return true}catch(g){utility.error("ERROR in MakeActionsList: "+g);this.actionsList=["AutoElite","Heal","ImmediateBanking","ImmediateAutoStat","MaxEnergyQuest","MonsterReview","DemiPoints","Monsters","Battle","Quests","Bank","PassiveGeneral","Lands","AutoBless",
"AutoStat","AutoGift","AutoPotions","AutoAlchemy","Idle"];return false}},ErrorCheck:function(){if(window.location.href.indexOf("/common/error.html")>=0){utility.log(1,"detected error page, waiting to go back to previous page.");window.setTimeout(function(){window.history.go(-1)},3E4);return true}if($("#try_again_button").length){utility.log(1,"detected Try Again message, waiting to reload");window.setTimeout(function(){window.history.go(0)},3E4);return true}return false},MainLoop:function(){utility.waitMilliSecs=
5E3;if(!this.ErrorCheck()){if(window.location.href.indexOf("apps.facebook.com/reqs.php")>=0||window.location.href.indexOf("filter=app_46755028429")>=0)gifting.collect();else{var b=$("a[class*='undo_link']");if(b&&b.length){utility.Click(b.get(0));utility.log(1,"Undoing notification")}if(!config.getItem("Disabled",false))if(this.pageLoadOK){state.setItem("NoWindowLoad",0);if(state.getItem("caapPause","none")!=="none"){this.caapDivObject.css({background:config.getItem("StyleBackgroundDark","#fee"),
opacity:config.getItem("StyleOpacityDark",1)});this.caapTopObject.css({background:config.getItem("StyleBackgroundDark","#fee"),opacity:config.getItem("StyleOpacityDark",1)})}else{if(schedule.since("clickedOnSomething",45)&&this.waitingForDomLoad){utility.log(1,"Clicked on something, but nothing new loaded.  Reloading page.");this.ReloadCastleAge()}if(this.AutoIncome())this.CheckLastAction("AutoIncome");else{this.MakeActionsList();b=this.actionsList.slice();utility.log(9,"Action List",b);state.getItem("ReleaseControl",
false)?state.setItem("ReleaseControl",false):b.unshift(state.getItem("LastAction","Idle"));utility.log(9,"Action List2",b);for(var a in b)if(b.hasOwnProperty(a)){utility.log(8,"Action",b[a]);if(this[b[a]]()){this.CheckLastAction(b[a]);break}}}}}else{a=state.getItem("NoWindowLoad",0);if(a===0){schedule.setItem("NoWindowLoadTimer",Math.min(Math.pow(2,a-1)*15,3600));state.setItem("NoWindowLoad",1)}else if(schedule.check("NoWindowLoadTimer")){schedule.setItem("NoWindowLoadTimer",Math.min(Math.pow(2,a-
1)*15,3600));state.setItem("NoWindowLoad",a+1);this.ReloadCastleAge()}utility.log(1,"Page no-load count: ",a);this.pageLoadOK=this.GetStats()}}this.WaitMainLoop()}},WaitMainLoop:function(){this.waitForPageChange=true;utility.setTimeout(function(){caap.waitForPageChange=false;caap.MainLoop()},utility.waitMilliSecs*(1+Math.random()*0.2))},ReloadCastleAge:function(){if(!config.getItem("Disabled")&&state.getItem("caapPause")==="none")window.location.href="http://apps.facebook.com/castle_age/index.php?bm=1"},
ReloadOccasionally:function(){var b=gm.getItem("ReloadFrequency",8,hiddenVar);if(!b||b<8)b=8;utility.setTimeout(function(){if(schedule.since("clickedOnSomething",300)){utility.log(1,"Reloading if not paused after inactivity");caap.ReloadCastleAge()}caap.ReloadOccasionally()},6E4*b+b*6E4*Math.random())}};utility.log(1,"Starting CAAP ... waiting page load");
utility.setTimeout(function(){utility.error("DOM onload timeout!!! Releading ...",window.location.href);window.location.href=window.location.href},18E4);
$(function(){var b=0,a=false,c="";c=[];var d;utility.log(1,"Full page load completed");utility.clearTimeouts();if(!caap.ErrorCheck()){if((d=$("#navAccountName"))&&d.length)if(c=d.attr("href")){b=c.regex(/id=([0-9]+)/i);if(utility.isNum(b)&&b>0){caap.stats.FBID=b;a=true}else if((c=$("script").text().match(/."user.":(\d+),/))&&c.length===2){b=parseInt(c[1],10);if(utility.isNum(b)&&b>0){caap.stats.FBID=b;a=true}}}if(!a){utility.error("No Facebook UserID!!! Reloading ...",b,window.location.href);window.location.href=
window.location.href}config.load();schedule.load();state.load();caap.LoadStats();caap.stats.FBID=b;caap.stats.account=d.text();utility.logLevel=gm.getItem("DebugLevel",utility.logLevel,hiddenVar);gifting.init();state.setItem("clickUrl",window.location.href);schedule.setItem("clickedOnSomething",0);css.AddCSS();if(utility.is_firefox)devVersion?caap.devUpdate():caap.releaseUpdate();if(devVersion){if(state.getItem("LastVersion",0)!==caapVersion||state.getItem("LastDevVersion",0)!==devVersion){state.setItem("LastVersion",
caapVersion);state.setItem("LastDevVersion",devVersion)}}else if(state.getItem("LastVersion",0)!==caapVersion){state.setItem("LastVersion",caapVersion);state.setItem("LastDevVersion",0)}if(window.location.href.indexOf("facebook.com/castle_age/")>=0){state.setItem("caapPause","none");state.setItem("ReleaseControl",true);utility.setTimeout(function(){caap.init()},200)}caap.waitMilliSecs=8E3;caap.WaitMainLoop();caap.ReloadOccasionally()}});
